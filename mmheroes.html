<!DOCTYPE HTML>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <title>MM Heroes</title>
    <style type="text/css">
        body {
            background: black;
            font: 12pt 'lucida console','menlo',monospace;
            line-height: 11px;
        }

        div#bug {
            width: 70px;
            height: 40px;
            position: absolute;
            top: 0px;
            right: 0px;
            background: #c0c0c0;
            padding: 10px;
            font: 8pt 'tahoma',sans-serif;
        }

        #screen { border-collapse: collapse; }
        #screen td {
            width: 10px;
            height: 16px;
            text-align: center;
            vertical-align: middle;
            padding: 0px;
            border: 0px;
        }

        .bg0 {background: #000}
        .bg1 {background: #000080}
        .bg2 {background: #008000}
        .bg3 {background: #008080}
        .bg4 {background: #800000}
        .bg5 {background: #800080}
        .bg6 {background: #808000}
        .bg7 {background: #C0C0C0}

        .fg0  {color: #000}
        .fg1  {color: #000080}
        .fg2  {color: #008000}
        .fg3  {color: #008080}
        .fg4  {color: #800000}
        .fg5  {color: #800080}
        .fg6  {color: #808000}
        .fg7  {color: #C0C0C0}
        .fg8  {color: #404040}
        .fg9  {color: #00f}
        .fg10 {color: #0f0}
        .fg11 {color: #0ff}
        .fg12 {color: #f00}
        .fg13 {color: #f0f}
        .fg14 {color: #ff0}
        .fg15 {color: #fff}
    </style>
<script type="text/javascript" src="https://code.jquery.com/jquery.min.js"></script>
<script type="text/javascript">

let local_user_name = '';

/* 0xC8, size 0x44; offsets: [6]
0        0x0C8    subject_professor_names
0x11    0x0D9    subject_titles
0x32    0x0FA
0x34    0x0FC
0x36    0x0FE    subject_tasks
0x38    0x100
0x3A    0x102    subject_exam_days
0x3C    0x104    subject_exam_min_time
0x3E    0x106    subject_exam_max_time
0x40    0x108    subject_exam_places
0x43    0x10B    subject_professor_sex 1=male
*/
let subjects = [];

/* 0x478, sizes 0x1E, 5; offsets: [6][6]
0    0x478    from
2    0x47A    to
4    0x47C    where
*/
let timesheet = [];
/*{sasha_has: 1, hero_has: 0} [3]
[i + 0x52E] // is_sasha_has_synopsis
[i + 0x55C] // synopsis_presences
*/
let synopsis = [];
/*
[i * 2 + 0x532] // subject_tasks_done
[i * 2 + 0x544] // subject_pass_day
[i * 2 + 0x550] // subject_knowledges
[i + 0x53E] // byte exam_passed [6]
*/
let hero = {
    subject: [],
    garlic: 0, // 25498
    has_mmheroes_disk: 0, // 2549B
    has_inet: 0, // 2549E
    is_invited: 0, // 25496
    inception: 0, // 254A0
    is_working_in_terkom: 0,
    got_stipend: 0,
    has_ticket: 0,
    knows_djug: 0,

    brain: 0,
    stamina: 0,
    charizma: 0,
    health: 0,
    exams_left: 6
};
/*
0x6A4, size 0x54, offsets: {str:, num:, color:} [16]
0        string
0x51    number
0x53    color
*/
let dialog = [undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined];
/*
0x3B2, size 0x23, offsets: [5]
0        0x3B2    name
0x21    0x3D3    score
*/
let top_gamers = [];
/*
0x676, size 3, offsets: [12]
0    0x676    current_subject
2    0x678    place

0x32C, size 2
0x344, size 2
*/
let classmates = [];

let terkom_has_places; // 2549D
let klimov_timesheet_was_modified; // 25494

/*
not known vars, seems not affects gameplay

word_2559A
word_256CE
word_256D0
asc_256D2

byte_2549F
byte_254A4
*/
let word_2559A, word_256CE, word_256D0, asc_256D2, byte_2549F, byte_254A4;

// [i * 0x11 + 2] // four_letters_places
let places = [
    {title: '----'},
    {title: 'ПУНК '},
    {title: 'ПОМИ '},
    {title: 'Компы'},
    {title: 'Общага'},
    {title: 'Мавзолей'}
];

// 0x74, size 7
let days = ['22.5', '23.5', '24.5', '25.5', '26.5', '27.5'];
// 0x260, size 0x11
let classmate_names = [
    'Коля',
    'Паша',
    'Diamond',
    'RAI',
    'Миша',
    'Серж',
    'Саша',
    'NiL',
    'Кузьменко В.Г.',
    'DJuG',
    'Эндрю',
    'Гриша'
];

let Kolya = 0, Pasha = 1, Diamond = 2, Rai = 3, Misha = 4, Serzg = 5, Sasha = 6, Nil = 7, Kuzmenko = 8, Djug = 9, Endryu = 10, Grisha = 11;

// 0x9E, size 7
let subject_short_titles = [
    'АиТЧ',
    'МатАн',
    'ГиТ',
    'Инф',
    'ИнЯз',
    'Физ-ра'
];

let Algebra = 0, Matan = 1, GiT = 2, Infa = 3, English = 4, Fizra = 5;

let dialog_case_count;
let current_color;
let is_end;
let is_god_mode;

let time_of_day, day_of_week, current_place, death_cause;

let current_subject;
let last_subject;

// My little and buggy implementation of pascal
let Screen = [];
let ScreenColor = [];
let PositionR = 0, PositionC = 0;

let first_run = true;

let _color = [
    '#000', '#000080', '#008000', '#008080', '#800000', '#800080', '#808000', '#C0C0C0',
    '#404040', '#00f', '#0f0', '#0ff', '#f00', '#f0f', '#ff0', '#fff'
];

const aSkazanoJeNetSv = '"Сказано же, нет свободных компов!"';
const aIzviniParenSvo = '"Извини, парень, свободных кумпутеров нет.';
const aPoidiPoucisPok = 'Пойди поучись пока."';
const aTiSidisZaSvobo = 'Ты сидишь за свободным компом';
const aVTerexovskoiKo = 'в тереховской "конторе".';
const aCtoDelatBudem = 'Что делать будем?';
const aSidetIZarabati = 'Сидеть и зарабатывать деньги';
const aPoigratVMmhe_0 = 'Поиграть в MMHEROES';
const aPosidetCasokVI = 'Посидеть часок в Inet\'e';
const aViitiOtsudaNaS = 'Выйти отсюда на "свежий воздух"';
const aTebeNakapalo = 'Тебе накапало ';
const aRub__0 = ' руб.';
const aSgorelNaRabote = 'Сгорел на работе.';
const aUxodim___ = 'Уходим ...';
const aPoNeizvestnoiP = 'По неизвестной причине, в помещении ТЕРКОМА';
const aMmheroesNeOkaz = 'MMHEROES не оказывают никакого метафизического воздействия';
const aNaOkrujausiiMi = 'на окружающий мир...';
const aOglqdevsisVo_0 = 'Оглядевшись вокруг, ты обнаруживаешь,';
const aCtoVseTovarisi = 'что все товарищи, здесь собравшиеся,';
const aRubqtsqVMmhero = 'РУБЯТСЯ В MMHEROES!';
const aVozmojnoOniVse = 'Возможно, они все пытаются халявить,';
const aPitautsqIgratP = 'пытаются играть по "тривиальному" алгоритму,';
const aKotoriiSrabati = 'который срабатывает, увы, далеко, не всегда...';
const aVotZdorovoMiSi = 'Вот здорово - мы сидим, а денежки-то идут!';
const aRabociiDenZako = 'Рабочий день закончился, все по домам.';

const aMmheroes_hi = 'mmheroes.hi';
const aKolq_0 = 'Коля';
const aSasa_0 = 'Саша';
const aAndru_0 = 'Эндрю';
const aPasa_0 = 'Паша';
const aGrisa_0 = 'Гриша';

const aPozdravlqu = '********************** ПОЗДРАВЛЯЮ! ***************************';
const aTiPopalVSkrija = 'Ты попал в скрижали Мат-Меха! Сейчас тебя будут увековечивать!';
const aNeBoisqAtoNeBo = 'Не бойся, это не больно.';
const aKakTebqZovutGe = 'Как тебя зовут, герой? ';
const aNeXocesUvekove = 'Не хочешь увековечиваться - не надо!';
const aNuVotIVse_ = 'Ну, вот и все.';

const aDzin = 'ДЗИНЬ!';
const aDddzzzzziiiiii = 'ДДДЗЗЗЗЗИИИИИИННННННЬ !!!!';
const aDdddddzzzzzzzz = 'ДДДДДДЗЗЗЗЗЗЗЗЗЗЗЗЗИИИИИИИИИИННННННННННННЬ !!!!!!!!!!';
const aTiProsipaesSqO = 'Ты просыпаешься от звонка будильника ';
const aGoMaqV800_ = '-го мая в 8:00. ';
const aNeojidannoTiOs = 'Неожиданно ты осознаешь, что началась зачетная неделя,';
const aATvoqGotovnost = 'а твоя готовность к этому моменту практически равна нулю.';
const aNatqgivaqNaSeb = 'Натягивая на себя скромное одеяние студента,';
const aTiVsmatrivaesS = 'ты всматриваешься в заботливо оставленное соседом на стене';
const aRaspisanieKogd = 'расписание: когда и где можно найти искомого препода ?';

let Replay = {
    data: {
        on: 0,
        rnds: [], rnds_up: [], rnds_stack: [], rnds_i: 0,
        keys: [], keys_count: 0, keys_i: 0,
        dialogs: [], dialogs_i: 0,
        strs: [], strs_i: 0,
        clrscr_count: 0, clrscr_i: 0,
        start: false, end: false,
        wait_for_dialog: false
    },

    is_on: function() { return this.data.on; },
    is_start: function() { return this.data.start; },
    is_end: function() { return this.data.end; },
    start: function() { this.data.start = true; this.data.end = false; },
    stop: function() { this.data.start = false; this.data.end = true; },

    check_last_cls: function() { ++this.data.clrscr_i; return this.data.clrscr_i >= this.data.clrscr_count; },
    record_cls: function() { ++this.data.clrscr_count; },
    can_skip_output: function() { return this.data.on && this.data.clrscr_i < this.data.clrscr_count; },

    next_rnd: function() { return this.data.rnds[this.data.rnds_i++]; },
    record_rnd: function(res, up) { this.data.rnds.push(res); this.data.rnds_up.push(up); /*this.data.rnds_stack.push(get_stack());*/ },

    next_key: function() {
        console.log('next_key');

        let result = this.data.keys_i >= this.data.keys_count - this.data.keys.length ?
            this.data.keys[this.data.keys_i - (this.data.keys_count - this.data.keys.length)] :
            32;

        ++this.data.keys_i;
        return result;
    },
    record_key: function(res) {
        console.log('record_key');

        if (this.data.wait_for_dialog) {
            this.data.keys.push(res);
        }
        ++this.data.keys_count;
    },

    next_dialog: function() { return this.data.dialogs[this.data.dialogs_i++]; },
    record_dialog: function(res) {
        this.data.keys_count -= this.data.keys.length;
        this.data.keys = [];
        this.data.dialogs.push(res);
    },
    wait_dialog: function(arg) { this.data.wait_for_dialog = arg; },

    next_string: function() { return this.data.strs[this.data.strs_i++]; },
    record_string: function(res) { this.data.strs.push(res); },

    keys_remains: function() {
        return this.data.keys_i < this.data.keys_count;
    },

    dialogs_remains: function() {
        return this.data.dialogs_i < this.data.dialogs.length;
    },

    strs_remains: function() {
        return this.data.strs_i < this.data.strs.length;
    },

    last: function() {
        return !this.keys_remains() && !this.dialogs_remains() && !this.strs_remains();
    },

    turn_off: function() {
        this.data.on = 0; this.data.rnds_i = 0; this.data.keys_i = 0; this.data.dialogs_i = 0; this.data.strs_i = 0; this.data.clrscr_i = 0;
        console.log('replay now off');
    },
    turn_on: function() {
        this.data.on = 1; this.data.rnds_i = 0; this.data.keys_i = 0; this.data.dialogs_i = 0; this.data.strs_i = 0; this.data.clrscr_i = 0;
        console.log('replay now ON');
    },

    restart: function() {
        console.log('Replay.restart');
        this.data.on = 0;
        this.data.rnds = []; this.data.rnds_up = []; this.data.rnds_stack = []; this.data.rnds_i = 0;
        this.data.keys = []; this.data.keys_count = 0; this.data.keys_i = 0;
        this.data.dialogs = []; this.data.dialogs_i = 0;
        this.data.strs = []; this.data.strs_i = 0;
        this.data.clrscr_count = this.data.clrscr_i = 0;
        this.data.wait_for_dialog = false;
    }
};

function get_user_name() {
    if (local_user_name === '' && window.localStorage && window.localStorage.nick) {
        local_user_name = window.localStorage.nick;
    }
    return local_user_name;
}

function set_user_name(name) {
    local_user_name = name;
    if (window.localStorage) {
        window.localStorage.nick = name;
    }
}

function send_replay(vars) {
    if (!Replay.is_on()) {
        if (vars === undefined)
            vars = {};

        vars.data = JSON.stringify(Replay.data);
        vars.day = day_of_week;

        /*$.ajax({url: '/-/mmheroes/api',
            type: 'post',
            data: {
                api: 'put',
                nick: get_user_name(),
                data: vars
            },
            success: console.log,
            error: alyarme
        });*/
    }
}

function get_top() {
    if (!Replay.is_on()) {
        /*$.ajax({url: '/-/mmheroes/api',
            data: {
                api: 'get',
                nick: get_user_name()
            },
            success: data => {
                console.log(data);
                top_gamers = JSON.parse(data);
            },
            error: alyarme
        });*/
    }
}

function _init_vars() {
    let init_subjects = (prof_name, subject, a3, a4, tasks, a6, exam_days, exam_min_time, exam_max_time, exam_places, prof_sex) => {
        subjects.push({
            professor: {
                name: prof_name,
                sex: prof_sex
            },
            title: subject,
            exam_days: exam_days,
            exam_min_time: exam_min_time,
            exam_max_time: exam_max_time,
            exam_places: exam_places,
            tasks: tasks,
            member0xFA: a3,
            member0xFC: a4,
            member0x100: a6
        });
    };

    subjects = [];
    init_subjects('Всемирнов М.А.', 'Алгебра и Т.Ч.', 10, 17, 12, 3, 4, 2, 4, [1,1,2], 1);
    init_subjects('Дубцов Е.С.', 'Мат. Анализ', 8, 14, 10, 2, 4, 2, 3, [1,1,1], 1);
    init_subjects('Подкорытов С.С.', 'Геометрия и Топология', 4, 8, 3, 3, 2, 1, 3, [1,2,2], 1);
    init_subjects('Климов А.А.', 'Информатика', 5, 6, 2, 3, 2, 1, 2, [3,3,3], 1);
    init_subjects('Влащенко Н.П.', 'English', 7, 10, 3, 1, 2, 2, 2, [1,1,1], 0);
    init_subjects('Альбинский Е.Г.', 'Физ-ра', 7, 20, 1, 1, 2, 1, 1, [1,1,1], 1);

    timesheet = [];
    for (let i = 0; i < 6; ++i) {
        timesheet.push([]);
        for (let j = 0; j < 6; ++j) {
            timesheet[i].push({
                from: 0,
                to: 0,
                where: 0
            });
        }
    }

    synopsis = [];
    for (let i = 0; i < 3; ++i)
        synopsis.push({sasha_has: 1, hero_has: 0});

    hero.subject = [];
    for (let i = 0; i < 6; ++i)
        hero.subject.push({
            knowledge: 0,
            passed: 0,
            pass_day: -1,
            tasks_done: 0
        });

    classmates = [];
    for (let i = 0; i < 12; ++i)
        classmates.push({
            current_subject: -1,
            place: 0,
            member0x32C: [0,0,0, 4, 2, 0,0, 6, 0,0,0,0][i],
            member0x344: [0,0,0, 8, 0, 0,0, 8, 0,0,0,0][i]
        });
}

function _upper_bound(cont, val) {
    for (let i = 0; i < cont.length; ++i) {
        if (cont[i] > val) {
            return i;
        }
    }
    return cont.length;
}

function idiv(x, y) {
    return Math.floor(x / y);
}

function WhereY() {
    return PositionR;
}
function Randomize() {}

function __CrtInit() {
    for (let i = 0; i < 25; ++i) {
        Screen.push([]);
        ScreenColor.push([]);
        for (let j = 0; j < 80; ++j) {
            Screen[i].push(' ');
            ScreenColor[i].push(0x07);
        }
    }
}

function TextColor(col) {
    current_color = current_color & 0xF0 | col;
}

function Delay(pause) {
    let start = new Date().getTime();
    while (new Date().getTime - start < pause);
}

function alyarme(str) {
    let d = Replay.data;
    console.log(str + '\r\n\r\n' + get_stack() + '\r\n\r\n' + JSON.stringify(d));
}

function get_stack() {
    try {
        throw Error();
    } catch (e) {
        return e.stack;
    }
}

function get_stack_before(func) {
    let s = get_stack().split('\n');
    for (let i = s.length - 1; i >= 0; --i) {
        if (s[i].indexOf(func) != -1) {
            return s[i + 1];
        }
    }
}

function _update_key(code) {
    if (Replay.is_on() && Replay.is_start()) {
        Replay.record_key(code);
        if (!Replay.is_end()) {
            Main();
        }
    }
}

function ClrScr() {
    PositionC = 0;
    PositionR = 0;

    if (Replay.is_on()) {
        if (!Replay.check_last_cls()) {
            return;
        }
    } else {
        Replay.record_cls();
    }

    for (let i = 0; i < 25; ++i) {
        for (let j = 0; j < 80; ++j) {
            Screen[i][j] = ' ';
            ScreenColor[i][j] = 0x07;
        }
    }
}

function _update_screen() {
    let html = '';
    html += '<table id="screen">';
    for (let i = 0; i < 25; ++i) {
        html += '<tr>';
        for (let j = 0; j < 80; ++j) {
            html += '<td class="fg' + (ScreenColor[i][j] & 0xF) + ' bg' + (ScreenColor[i][j] >> 4) + '">' +
                Screen[i][j] + '</td>';
        }
        html += '</tr>';
    }
    html += '</table>';

    document.getElementById('content').innerHTML = html;
}

function write(str) {
    if (Replay.can_skip_output() || str === undefined) {
        return;
    }
    if (PositionR >= 25) {
        alyarme('write at pos ' + PositionR + ',' + PositionC);
    }
    str = '' + str;
    for (let i = 0; i < str.length; ++i) {
        Screen[PositionR][PositionC] = str.charAt(i);
        ScreenColor[PositionR][PositionC] = current_color;
        ++PositionC;
    }
}

function Random(up) {
    if (Replay.is_on()) {
        let rec_up = Replay.data.rnds_up[Replay.data.rnds_i];

        console.log('replay ' + Replay.data.rnds_i + ', hero.health = ' + hero.health + '; from ' + get_stack_before('Random'));

        let res = Replay.next_rnd();
        if (rec_up != up || up && res >= up || !up && res > 0) {
            alyarme('Replay: Random(' + up + ') = rnds[' + (Replay.data.rnds_i - 1) + '] = ' + res + ', rec_up = ' + rec_up);
        }
        return res;
    } else {
        let res = Math.floor(Math.random() * up);
        if (up && res >= up || !up && res > 0) {
            alyarme('Random(' + up + ') = ' + res);
        }
        if (Replay.data.rnds.length == 78) {
            alyarme('78th');
        }

        console.log('record ' + Replay.data.rnds.length + ' num ' + res + ', up ' + up + ', hero.health = ' + hero.health);

        Replay.record_rnd(res, up);
        return res;
    }
}

function ReadKey_on() {
    // Возвращаем последний нажатый кей, в следующий раз снова придется прерываться
    let result = false;
    if (Replay.keys_remains()) {
        result = Replay.next_key();
    }
    if (Replay.last()) {
        Replay.turn_off();
    }
    return result;
}

function ReadKey_off() {
    // Апдейтим экран только когда уходим в режим ожидания
    _update_screen();
    // Когда в следующий раз вызовется Main, он будет работать в режиме реплея, пока не кончатся клавиши
    Replay.turn_on();
    throw 42;
}

function ReadKey() {
    if (Replay.is_on()) {
        let result = ReadKey_on();
        if (result !== false) {
            return result;
        }
    }
    ReadKey_off();
}

function readln() {
    if (Replay.is_on()) {
        let res = false;
        if (Replay.strs_remains()) {
            let res = Replay.next_string();
        }
        if (Replay.last()) {
            Replay.turn_off();
        }
        if (res !== false) {
            return res;
        }
    }
    _update_screen();
    let res = prompt('Enter string:', get_user_name());
    Replay.record_string(res);
    return res;
}

function dialog_run(x, y) {
    if (Replay.is_on()) {
        let result = false;
        if (Replay.dialogs_remains()) {
            result = Replay.next_dialog();
        }
        if (Replay.last()) {
            Replay.turn_off();
        }
        if (result !== false) {
            return result;
        }
    }
    Replay.wait_dialog(true);

    let current_selection = 0;
    dialog_show(x, y);

    console.log(dialog);
    console.log(dialog_case_count);

    while (1) {
        current_color = 112;
        GotoXY(x, y + current_selection);
        write(dialog[current_selection].str);
        let key = ReadKey();

        console.log('dialog_run rcvd ' + key);

        current_color = dialog[current_selection].color;
        GotoXY(x, y + current_selection);
        write(dialog[current_selection].str);

        if (key == 13) {
            current_color = 7;
            let result = dialog[current_selection].num;
            Replay.record_dialog(result);
            Replay.wait_dialog(false);
            return result;
        } else if (key == 38) { // up
            if (current_selection == 0) {
                current_selection = dialog_case_count - 1;
            } else {
                --current_selection;
            }
        } else if (key == 40) { // down
            if (current_selection == dialog_case_count - 1) {
                current_selection = 0;
            } else {
                ++current_selection;
            }
        }
    }
}

function Main() {
    Replay.start();
    try {
        PROGRAM();
    } catch (e) {
        if (e != 42) {
            console.dir(e);
            alert(e + '\r\n' + e.stack);
        }
        return;
    }
    Replay.stop();
}

function _color_to_html_fg(col) {
    return _color[col & 0xF];
}

function _color_to_html_bg(col) {
    return _color[col >> 4];
}

function _crlf() {
    ++PositionR;
    PositionC = 0;
}

function writeln(str) {
    if (str != undefined)
        write(str);
    _crlf();
}

function GotoXY(x, y) {
    PositionR = y - 1;
    PositionC = x - 1;
}

function Assign(f, file) {}
function Reset(f, mode) {}
function Rewrite(f, mode) {}
function IOResult() { return 1; }
function Read(f) {}
function Close(f) {}

const Trunc = Math.floor;
const Round = Math.round;

function jnz(a, b) { return a != b; }
function jl(a, b) { return a < b; }
function jle(a, b) { return a <= b; }
function jg(a, b) { return a > b; }
function jge(a, b) { return a >= b; }
function jb(a, b) { return a < b; }
function jnb(a, b) { return a >= b; }
function jbe(a, b) { return a <= b; }
function ja(a, b) { return a > b; }
function jna(a, b) { return a <= b; }
function jae(a, b) { return a >= b; }

let aGamma3_14 = 'gamma3.14';

let aXocesPoprobova = 'Хочешь попробовать еще?';
let aDaDaDa = 'ДА!!! ДА!!! ДА!!!';
let aNet___Net___Ne = 'Нет... Нет... Не-э-эт...';

function prompt_for_new_game() {
    ClrScr();
    writeln(aXocesPoprobova);
    dialog_start();
    dialog_case(aDaDaDa, -1);
    dialog_case(aNet___Net___Ne, -2);
    let result = dialog_run(1, 4) == -2;
    ClrScr();
    return result;
}

function PROGRAM() {
    _init_vars();

    __CrtInit();

    dialog_case_count = 0;
    Randomize();

    do {
        if (!Replay.is_on()) {
            read_top_gamers();
            Replay.restart();
        }

        if (first_run) {
            show_intro_screen();
            first_run = false;
        }

        init_game();
        show_dzin_and_timesheet();

        do {
            scene_router();
            check_exams_left_count();
        } while (is_end == 0);

        game_end();
    } while (prompt_for_new_game() == 0);
    show_disclaimer();
    write_top_gamers();
}

function show_dzin_and_timesheet() {
    ClrScr();
    TextColor(10);
    writeln(aDzin);
    Delay(0x1F4);
    TextColor(0x0E);
    writeln(aDddzzzzziiiiii);
    Delay(0x2BC);
    TextColor(0x0C);
    writeln(aDdddddzzzzzzzz);
    Delay(0x3E8);
    TextColor(7);
    write(aTiProsipaesSqO);
    write(0x16);
    writeln(aGoMaqV800_);
    writeln(aNeojidannoTiOs);
    writeln(aATvoqGotovnost);
    writeln(aNatqgivaqNaSeb);
    writeln(aTiVsmatrivaesS);
    writeln(aRaspisanieKogd);
    wait_for_key();
    ClrScr();
    show_timesheet();
    wait_for_key();
    ClrScr();
}

let aNowhere_at_tur = 'nowhere_at_turn';

function scene_router() {
    if (current_place == 2) {
        if (current_subject != -1) {
            scene_exam();
        } else {
            scene_pomi();
        }
    } else if (current_place == 1) {
        if (current_subject != -1) {
            scene_exam();
        } else {
            scene_punk();
        }
    } else if (current_place == 5) {
        scene_mausoleum();
    } else if (current_place == 4) {
        scene_obschaga();
    } else if (current_place == 3) {
        if (current_subject != -1) {
            scene_exam();
        } else {
            scene_kompy();
        }
    } else if (current_place == 0) {
        bug_report(aNowhere_at_tur);
    }
}

let aLegceLbomKolot = 'Легче лбом колоть орехи,';
let aCemUcitSqNaMat = 'чем учиться на МАТ-МЕХе.';

function game_end_death() {
    send_replay({
        death_cause: death_cause
    });
    current_color = 0x0C;
    writeln(aLegceLbomKolot);
    writeln(aCemUcitSqNaMat);
    current_color = 0x0D;
    writeln(death_cause);
    wait_for_key();
}

let aUfffffVoVsqkom = 'Уффффф! Во всяком случае, ты еще живой.';
let aYesTiSdelalAto = '********* Yes! Ты сделал это! *********';
let aUTebqNetCelix = 'У тебя нет целых ';
let aZacetov = ' зачетов!';
let aTiOtcislen = 'ТЫ ОТЧИСЛЕН!';
let aNetDvuxZacetov = 'Нет двух зачетов - плохо.';
let aGovorqtUMexani = 'Говорят, у механиков жизнь проще...';
let aZrqGovorqtXalq = '- Зря говорят, ХАЛЯВЫ НЕ БУДЕТ!';
let aNetOdnogoZacet = 'Нет одного зачета.';
let aNicegoOtAtogoE = 'Ничего, от этого еще никто не помирал.';
let aPozdravlquTiMo = 'Поздравляю: ты можешь считать себя настоящим героем Мат-Меха!';
let aUspesnoiTebeSe = 'Успешной тебе сессии !';
let aUTebqNetZaceta = 'У тебя нет зачета по алгебре!';
let aVsemirnovDokan = 'Всемирнов доканал тебя на сессии.';
let aEstestvennoAto = 'Естественно, это повлияло на твои оценки.';
let aUTebqNetDopusk = 'У тебя нет допуска по матану!';
let aUTebqNetZace_0 = 'У тебя нет зачета по геометрии!';
let aKakTebqUgorazd = 'Как тебя угораздило?';
let aKSessiiTiGotov = 'К сессии ты "готовился", "работая" в ТЕРКОМе.';
let aTiResilBolSeNi = 'Ты решил больше никогда так не делать.';
let aTvoqStipuxa = 'Твоя стипуха - ';
let aRub_ = ' руб.';
let aVZanacke = 'В заначке ';
let aDaTiEseIGodNet = 'Да ты еще и GOD! Нет, тебе в таблицу рекордов нельзя.';
let aTebqOstaviliBe = 'Тебя оставили без стипухи.';

function game_end_alive() {
    if (hero.exams_left > 0) {
        colored_output(0x0D, aUfffffVoVsqkom);
    } else {
        colored_output(0x0F, aYesTiSdelalAto);
    }

    writeln();
    writeln();

    if (hero.exams_left >= 3) {
        colored_output(0x0C, aUTebqNetCelix);
        colored_output_white(hero.exams_left);
        colored_output(0x0C, aZacetov);
        writeln();
        colored_output(0x0D, aTiOtcislen);

        send_replay();

        wait_for_key();
        return;
    } else if (hero.exams_left == 2) {
        colored_output_ln(0x0E, aNetDvuxZacetov);
        colored_output_ln(0x0E, aGovorqtUMexani);
        colored_output_ln(0x0E, aZrqGovorqtXalq);
    } else if (hero.exams_left == 1) {
        colored_output_ln(10, aNetOdnogoZacet);
        colored_output_ln(10, aNicegoOtAtogoE);
    } else if (hero.exams_left == 0) {
        colored_output_ln(0x0F, aPozdravlquTiMo);
        colored_output_ln(0x0F, aUspesnoiTebeSe);
    }

    let score = 0;
    for (let subj = 0; subj <= 5; ++subj) {
        if (hero.subject[subj].pass_day != -1) {
            score +=
                idiv((6 - hero.subject[subj].pass_day) *
                (subjects[subj].tasks + subjects[subj].member0xFA) * 2, 3);
        }
    }


    if (!hero.subject[Algebra].passed) {
        current_color = 0x0C;
        writeln();
        writeln(aUTebqNetZaceta);
        writeln(aVsemirnovDokan);
        writeln(aEstestvennoAto);
        current_color = 7;

        score -= (subjects[Algebra].tasks - hero.subject[Algebra].tasks_done) * 4;
        if (score < 0) {
            score = 0;
        }
    }

    if (!hero.subject[Matan].passed) {
        current_color = 0x0C;
        writeln();
        writeln(aUTebqNetDopusk);
        score = idiv(score * 2, 3);
        current_color = 7;
    }

    if (!hero.subject[GiT].passed) {
        current_color = 0x0C;
        writeln();
        writeln(aUTebqNetZace_0);
        writeln(aKakTebqUgorazd);
        score = idiv(score * 2, 3);
        current_color = 7;
    }

    if (hero.is_working_in_terkom) {
        current_color = 0x0C;
        writeln();
        writeln(aKSessiiTiGotov);
        writeln(aTiResilBolSeNi);
        score = idiv(score * 2, 3);
        current_color = 7;
    }

    writeln();

    if (score <= 0) {
        writeln(aTebqOstaviliBe);
    } else {
        write(aTvoqStipuxa);
        colored_output_white(score);
        writeln(aRub_);
        write(aVZanacke);
        TextColor(0x0F);
        write(hero.money);
        TextColor(7);
        writeln(aRub_);
        writeln();

        if (is_god_mode) {
            score = 0;
            hero.money = 0;
            writeln(aDaTiEseIGodNet);
        } else {
            update_top_gamers(score + hero.money);
        }
    }
    wait_for_key();
}

let aNamPonqtenAtot = '                                                Нам понятен этот смех';
let aNePopavsixNaM = '                                                Не попавших на Мат-Мех';
let aNadpisNaPa = '                                                  (надпись на парте)';
let aHHEeeRrOEeeSsM = ' H H  EEE  RR    O   EEE  SS       M   M  A   A TTTTT       M   M  EEE  X   X';
let aHHERROOESMmMmA = ' H H  E    R R  O O  E   S         MM MM  AAAAA   T         MM MM    E   X X';
let aHhhEeRrOOEeSOf = ' HHH  EE   RR   O O  EE   S    OF  M M M  A   A   T    &&&  M M M   EE    X';
let aHHERROOESMMAAT = ' H H  E    R R  O O  E     S       M   M   A A    T         M   M    E   X X';
let aHHEeeRROEeeSsM = ' H H  EEE  R R   O   EEE SS        M   M    A     T         M   E  EEE  X   X';
let aGeroiMataIMexa = '                             ГЕРОИ МАТА И МЕХА ;)';
let aPCrwmmDevelopm = '(P) CrWMM Development Team, 2001.';
let aVersiq = 'Версия ';
let aZaglqniteNaNas = 'Загляните на нашу страничку: mmheroes.chat.ru !';

function show_intro_screen() {
    ClrScr();
    TextColor(8);
    writeln(aNamPonqtenAtot);
    writeln(aNePopavsixNaM);
    writeln(aNadpisNaPa);
    writeln();
    writeln();
    writeln();
    TextColor(0x0F);
    writeln(aHHEeeRrOEeeSsM);
    writeln(aHHERROOESMmMmA);
    writeln(aHhhEeRrOOEeSOf);
    writeln(aHHERROOESMMAAT);
    writeln(aHHEeeRROEeeSsM);
    writeln();
    writeln();
    TextColor(0x0C);
    writeln(aGeroiMataIMexa);
    writeln();
    writeln();
    TextColor(0x0B);
    writeln(aPCrwmmDevelopm);
    write(aVersiq);
    write(aGamma3_14);
    writeln('.');
    writeln(aZaglqniteNaNas);
    wait_for_key();
    ClrScr();
}

function game_end() {
    ClrScr();
    if (hero.health <= 0) {
        game_end_death();
    } else {
        game_end_alive();
    }
}

let aDisclaimer = 'DISCLAIMER';
let a1_VsePersonaji = '1.) Все персонажи реальны. Эта программа является лишь неким отражением';
let aMneniqEeAvtora = '    мнения ее автора об окружающей действительности.';
let aAvtorNeStavilC = '    Автор не ставил цели оценить чью-либо линию поведения.';
let a2_PoctiVseSobi = '2.) Почти все события реальны. Естественно, многие из них';
let aPredstavleniVN = '    представлены в несколько аллегорическом виде.';
let a3_VseSovpadeni = '3.) Все совпадения с другими реальными зачетными неделями,';
let aProvedennimiKe = '    проведенными кем-либо в каком-либо ВУЗе, лишь подчеркивают';
let aRealisticnostV = '    реалистичность взглядов автора на реальность.';
let a_EsliViNasliVD = '*.) Если вы нашли в данной программе ошибку (любую, включая опечатки),';
let aVasiKommentari = '    Ваши комментарии будут очень полезны.';
let aAvtorNeNesetOt = 'Автор не несет ответственность за психическое состояние игрока.';

function show_disclaimer() {
    ClrScr();
    TextColor(10);
    writeln(aDisclaimer);
    writeln();
    TextColor(9);
    writeln(a1_VsePersonaji);
    writeln(aMneniqEeAvtora);
    writeln(aAvtorNeStavilC);
    writeln();
    writeln(a2_PoctiVseSobi);
    writeln(aPredstavleniVN);
    writeln();
    writeln(a3_VseSovpadeni);
    writeln(aProvedennimiKe);
    writeln(aRealisticnostV);
    writeln();
    writeln();
    TextColor(0x0C);
    writeln(a_EsliViNasliVD);
    writeln(aVasiKommentari);
    writeln();
    TextColor(8);
    writeln(aAvtorNeNesetOt);
    wait_for_key();
    ClrScr();
}

function goto_kompy_to_obschaga() {
    current_subject = -1;
    current_place = 4;
}

let aNeSmogRasstatS = 'Не смог расстаться с компьютером.';

function goto_kompy_to_punk() {
    current_place = 1;
    current_subject = -1;
    decrease_health(2, aNeSmogRasstatS);
}

let aZdraviiSmislPo = 'Здравый смысл подсказывает тебе, что в такое время';
let aTiTamNikogoUje = 'ты там никого уже не найдешь.';
let aNeBudemZrqTrat = 'Не будем зря тратить здоровье на поездку в ПОМИ.';
let aVAlektrickeNas = 'В электричке нашли бездыханное тело.';
let aDenegUTebqNetP = 'Денег у тебя нет, пришлось ехать зайцем...';
let aTebqZaloviliKo = 'Тебя заловили контролеры!';
let aVisadiliVKrasn = 'Высадили в Красных зорях, гады!';
let aKontroleriJizn = 'Контролеры жизни лишили.';
let aUfDoexal = 'Уф, доехал!';
let aExatZaicem = 'Ехать зайцем';
let aCestnoZaplatit = 'Честно заплатить 10 руб. за билет в оба конца';

function goto_kompy_to_pomi() {
    ClrScr();
    show_header_stats();
    GotoXY(1, 8);
    if (time_of_day > 20) {
        writeln(aZdraviiSmislPo);
        writeln(aTiTamNikogoUje);
        writeln(aNeBudemZrqTrat);
        wait_for_key();
        return;
    }

    decrease_health(Random(10), aVAlektrickeNas);
    current_place = 2;

    if (hero.money < 10) {
        writeln(aDenegUTebqNetP);

        if (hero.charizma < Random(10)) {
            writeln(aTebqZaloviliKo);
            writeln(aVisadiliVKrasn);
            hero.health -= 0xA;
            if (hero.health <= 0) {
                is_end = 1;
                death_cause = aKontroleriJizn;
            }
            hour_pass();
        } else {
            writeln(aUfDoexal);
        }
    } else {
        dialog_start();
        dialog_case(aExatZaicem, -1);
        dialog_case(aCestnoZaplatit, -2);
        let result = dialog_run(1, 0x0C);
        if (result == -1) {
            if (hero.charizma < Random(10)) {
                GotoXY(1, 0x0F);
                writeln(aTebqZaloviliKo);
                writeln(aVisadiliVKrasn);
                hour_pass();
            } else {
                GotoXY(1, 0x0F);
                writeln(aUfDoexal);
            }
        } else if (result == -2) {
            hero.money -= 10;
            hero.has_ticket = 1;
        }
    }
    wait_for_key();
    hour_pass();
}

let aKlimovA_a_Sidi = 'Климов А.А. сидит и тоскует по халявному Inet\'у.';
let a___ = '...';

function goto_klimov() {
    if (Random(2) == 0) {
        ClrScr();
        TextColor(7);
        writeln(aKlimovA_a_Sidi);
        writeln(a___);
        ReadKey();
        ClrScr();
    }
    current_subject = 3;
}

let aUmerPoPutiVMav = 'Умер по пути в мавзолей.';

function goto_kompy_to_mausoleum() {
    current_subject = -1;
    current_place = 5;
    decrease_health(2, aUmerPoPutiVMav);
}

let aDzin_0 = 'ДЗИНЬ!';
let aDddzzzzziiii_0 = 'ДДДЗЗЗЗЗИИИИИИННННННЬ !!!!';
let aDdddddzzzzzz_0 = 'ДДДДДДЗЗЗЗЗЗЗЗЗЗЗЗЗИИИИИИИИИИННННННННННННЬ !!!!!!!!!!';
let aNeojidannoTi_0 = 'Неожиданно ты осознаешь, что началась зачетная неделя,';
let aATvoqGotovno_0 = 'а твоя готовность к этому моменту практически равна нулю.';
let aNatqgivaqNaS_0 = 'Натягивая на себя скромное одеяние студента,';
let aTiVsmatrivae_0 = 'ты всматриваешься в заботливо оставленное соседом на стене';
let aRaspisanieKo_0 = 'расписание: когда и где можно найти искомого препода ?';
let aStop = '!!!!!! СТОП! !!!!!!';
let aCtoToTakoeTiUj = 'ЧТО-ТО ТАКОЕ ТЫ УЖЕ ВИДЕЛ!!!';
let aOglqdevsisVokr = 'Оглядевшись вокруг, ты осознаешь, что, вроде бы,';
let aAkstraordinarn = 'экстраординарного не произошло. Ты просто играешь в компьютерную';
let aIgruNeSamogoLu = 'игру не самого лучшего качества, в которой тебе вдруг предложили...';
let aSigratVAtuSamu = 'СЫГРАТЬ В ЭТУ САМУЮ ИГРУ! [...]';
let aRazdvoenieLojn = 'Раздвоение ложной личности.';
let aNeKajdiiSposob = 'Не каждый способен пережить такое потрясение.';
let aPostepennoKTeb = 'Постепенно к тебе приходит осознание того, что';
let aNaSamomDeleVse = 'на самом деле, все это - компьютерная игра, и, следовательно,';
let aAtiSobitiqProi = 'эти события происходят только в твоем воображении.';
let aVovremqViidqIz = 'Вовремя выйдя из странного трансцендентального состояния,';
let aTiObnarujivaes = 'ты обнаруживаешь себя в компьютерном классе Мат-Меха.';
let aPravdaMirVokru = 'Правда, мир вокруг тебя, похоже, несколько иной,';
let aNejeliOnBilCas = 'нежели он был час минут назад...';

function play_mmheroes() {
    ++hero.inception;
    ClrScr();
    TextColor(10);
    writeln(aDzin_0);
    Delay(0x1F4);
    TextColor(0x0E);
    writeln(aDddzzzzziiii_0);
    Delay(0x2BC);
    TextColor(0x0C);
    writeln(aDdddddzzzzzz_0);
    Delay(0x3E8);
    TextColor(7);
    writeln(aNeojidannoTi_0);
    writeln(aATvoqGotovno_0);
    writeln(aNatqgivaqNaS_0);
    writeln(aTiVsmatrivae_0);
    writeln(aRaspisanieKo_0);
    wait_for_key();
    ClrScr();
    TextColor(0x0F);
    writeln(aStop);
    writeln();
    writeln(aCtoToTakoeTiUj);
    writeln(aOglqdevsisVokr);
    writeln(aAkstraordinarn);
    writeln(aIgruNeSamogoLu);
    writeln(aSigratVAtuSamu);
    ReadKey();

    if (hero.stamina + hero.brain - hero.inception * 5 < 8) {
        decrease_health(0x64, aRazdvoenieLojn);
    }

    hour_pass();

    if (hero.health <= 0) {
        return;
    }

    writeln();
    TextColor(0x0E);
    writeln(aNeKajdiiSposob);
    writeln(aPostepennoKTeb);
    writeln(aNaSamomDeleVse);
    writeln(aAtiSobitiqProi);
    writeln(aVovremqViidqIz);
    writeln(aTiObnarujivaes);
    writeln(aPravdaMirVokru);
    writeln(aNejeliOnBilCas);
    inception_reinit_timesheet();
    wait_for_key();
}

let aUxTiTiNaselPro = 'Ух ты! Ты нашел програмку, которая нужна для Климова!';

function surf_inet()  {
    if (is_god_mode || Random(hero.brain) > 6 && hero.subject[Infa].tasks_done < hero.subject[Infa].tasks) {
        GotoXY(1, 0x14);
        TextColor(0x0B);
        writeln(aUxTiTiNaselPro);
        ++hero.subject[Infa].tasks_done;
    } else if (Random(3) == 0 && hero.brain < 5) {
        ++hero.brain;
    }
    wait_for_key();
    hour_pass();
}

let aKlassZakrivaet = 'Класс закрывается. Пошли домой!';
let aUmerPoPutiDomo = 'Умер по пути домой. Бывает.';
let aTiVKompUternom = 'Ты в компьютерном классе. Что делать?';
let aKlimovA_a_ = 'Климов А.А.';
let aPoitiVObsagu = 'Пойти в общагу';
let aPokinutKlass = 'Покинуть класс';
let aPoexatVPomi = 'Поехать в ПОМИ';
let aPoitiVMavzolei = 'Пойти в мавзолей';
let aProvesti1CasVI = 'Провести 1 час в Inet\'е';
let aPoigratVMmhero = 'Поиграть в MMHEROES';
let aSMenqXvatit = 'С меня хватит!';

function scene_kompy() {
    show_header_stats();
    TextColor(7);
    GotoXY(1, 8);

    if (time_of_day > 20) {
        writeln(aKlassZakrivaet);
        wait_for_key();
        current_subject = -1;
        current_place = 4;
        decrease_health(Random(5), aUmerPoPutiDomo);
        return;
    }

    writeln(aTiVKompUternom);

    dialog_start();
    if (is_professor_here(Infa)) {
        dialog_case_colored(aKlimovA_a_, -1, 0x0E);
    }
    dialog_case(aPoitiVObsagu, -2);
    dialog_case(aPokinutKlass, -3);
    dialog_case(aPoexatVPomi, -4);
    dialog_case(aPoitiVMavzolei, -5);
    if (hero.has_inet) {
        dialog_case(aProvesti1CasVI, -11);
    }
    for (let i = 0; i <= 0xB; ++i) {
        if (classmates[i].place == 3) {
            dialog_case_colored(classmate_names[i], i, 0xE);
        }
    }
    if (hero.has_mmheroes_disk) {
        dialog_case(aPoigratVMmhero, -10);
    }
    dialog_case_colored(aSMenqXvatit, -6, 9);

    show_short_today_timesheet(10);

    let res = dialog_run(1, 10);
    let arr = {
        1: goto_klimov,
        2: goto_kompy_to_obschaga,
        3: goto_kompy_to_punk,
        4: goto_kompy_to_pomi,
        5: goto_kompy_to_mausoleum,
        6: request_exit,
        10: play_mmheroes,
        11: surf_inet
    };
    if (arr[-res] !== undefined) {
        arr[-res]();
    } else if (res >= 0 && res <= 0xB) {
        talk_with_classmate(res);
    }
}

let aUmerPoPutiNaFa = 'Умер по пути на факультет.';

function goto_mausoleum_to_punk() {
    decrease_health(3, aUmerPoPutiNaFa);
    current_subject = -1;
    current_place = 1;
}

function goto_mausoleum_to_obschaga() {
    current_subject = -1;
    current_place = 4;
}

let aViberiSebeSpos = 'Выбери себе способ "культурного отдыха".';
let aStakanKoliZa4R = 'Стакан колы за 4 р.';
let aSup6R_VseUdovo = 'Суп, 6 р. все удовольствие';
let a05PivaZa8R_ = '0,5 пива за 8 р.';
let aRasslablqtSqBu = 'Расслабляться будем своими силами.';
let aNetOtdixatAtoQ = 'Нет, отдыхать - это я зря сказал.';
let aPivnoiAlkogoli = 'Пивной алкоголизм, батенька...';

function rest_in_mausoleum() {
    ClrScr();
    show_header_stats();
    GotoXY(1, 8);
    writeln(aViberiSebeSpos);
    show_short_today_timesheet(0x0B);

    dialog_start();
    if (hero.money >= 4) {
        dialog_case(aStakanKoliZa4R, -2);
    }
    if (hero.money >= 6) {
        dialog_case(aSup6R_VseUdovo, -3);
    }
    if (hero.money >= 8) {
        dialog_case(a05PivaZa8R_, -1);
    }
    dialog_case(aRasslablqtSqBu, -4);
    dialog_case(aNetOtdixatAtoQ, 0);
    let res = dialog_run(1, 0x0B);

    if (res == -1) {
        hero.money -= 8;
        if (Random(3) == 0) {
            --hero.brain;
        }
        if (Random(3) == 0) {
            ++hero.charizma;
        }
        if (Random(2) == 0) {
            ++hero.stamina;
        }
        hero.health += Random(hero.charizma);
        if (hero.brain <= 0) {
            hero.health = 0;
            is_end = 1;
            death_cause = aPivnoiAlkogoli;
        }
    } else if (res == -2) {
        hero.money -= 4;
        hero.health += Random(hero.charizma) + 3;
    } else if (res == -3) {
        hero.money -= 6;
        hero.health += Random(hero.charizma) + 5;
    } else if (res == -4) {
        hero.health += Random(hero.charizma);
    } else if (res == 0) {
        return;
    }

    hour_pass();
}

let aTiVMavzolee_Ct = 'Ты в мавзолее. Что делать?';
let aIdtiVPunk = 'Идти в ПУНК';
let aPoexatVPomi_0 = 'Поехать в ПОМИ';
let aIdtiVObsagu = 'Идти в общагу';
let aOtdixat = 'Отдыхать';
let aSMenqXvatit_0 = 'С меня хватит!';

function scene_mausoleum() {
    show_header_stats();
    TextColor(7);
    GotoXY(1, 8);
    writeln(aTiVMavzolee_Ct);

    dialog_start();
    dialog_case(aIdtiVPunk, -1);
    dialog_case(aPoexatVPomi_0, -5);
    dialog_case(aIdtiVObsagu, -2);
    dialog_case(aOtdixat, -3);
    for (let i = 0; i <= 0xB; ++i) {
        if (classmates[i].place == 5) {
            dialog_case_colored(classmate_names[i], i, 0xE);
        }
    }
    dialog_case_colored(aSMenqXvatit_0, -4, 9);

    show_short_today_timesheet(10);

    let res = dialog_run(1, 10);
    if (res == -1) {
        goto_mausoleum_to_punk();
    } else if (res == -2) {
        goto_mausoleum_to_obschaga();
    } else if (res == -3) {
        rest_in_mausoleum();
    } else if (res == -4) {
        request_exit();
    } else if (res == -5) {
        goto_punk_or_mausoleum_to_pomi();
    } else if (res >= 0 && res <= 0xB) {
        talk_with_classmate(res);
    }

}

let aKCemuGotovitSq = 'К чему готовиться?';
let aK = ' (к)';
let aNiKCemu = 'Ни к чему';
let aVospolZuusKons = 'Воспользуюсь конспектом';
let aBuduUcitSqKakU = 'Буду учиться, как умею';
let aZaucilsq_ = 'Заучился.';
let aZubrejkaDoDobr = 'Зубрежка до добра не доводит!';

function botva() {
    ClrScr();
    show_header_stats();
    TextColor(7);
    GotoXY(1, 8);
    writeln(aKCemuGotovitSq);

    dialog_start();
    for (let i = 0; i <= 5; ++i) {
        dialog_case(subjects[i].title + (i <= 2 && synopsis[i].hero_has ? aK : ''), i);
    }
    dialog_case(aNiKCemu, -1);

    show_short_today_timesheet(10);

    let subj = dialog_run(1, 10);
    if (subj == -1) {
        return;
    }

    let use_synopsis = 0;
    if (subj <= 2 && synopsis[subj].hero_has) {
        dialog_start();
        dialog_case(aVospolZuusKons, -1);
        dialog_case(aBuduUcitSqKakU, -2);
        use_synopsis = dialog_run(1, 0x12) == -1;
    }

    let var_6 = subj == 5 ? hero.stamina : hero.brain;
    if (var_6 <= 0) {
        return;
    }

    hero.subject[subj].knowledge +=
        (time_of_day < 19 ? var_6 : idiv(var_6 * 2, 3)) -
        Random(idiv(var_6, 2)) +
        Random(idiv(hero.health, 0x12)) +
        (use_synopsis ? 0xA : 0);

    if (hero.subject[subj].knowledge < 0) {
        alert(hero.subject[subj].knowledge);
    }

    let health_penalty;
    if (hero.stamina > 0) {
        health_penalty = 0xA - Random(hero.stamina);
    } else {
        health_penalty = Random(hero.stamina) + 0xA;
    }
    if (health_penalty < 0 || use_synopsis) {
        health_penalty = 0;
    }
    if (time_of_day > 21 || time_of_day < 4) {
        health_penalty += 0x0C;
    }
    decrease_health(health_penalty, aZaucilsq_);

    if (hero.subject[subj].knowledge > 0x2D) {
        decrease_health(10, aZubrejkaDoDobr);
    }

    if (!is_end) {
        hour_pass();
    }
}

let aUmerPoPutiNa_0 = 'Умер по пути на факультет.';

function goto_obschaga_to_punk() {
    current_place = 1;
    current_subject = -1;
    decrease_health(3, aUmerPoPutiNa_0);
}

let aZdraviiSmisl_0 = 'Здравый смысл подсказывает тебе, что в такое время';
let aTiTamNikogoU_0 = 'ты там никого уже не найдешь.';
let aNeBudemZrqTr_0 = 'Не будем зря тратить здоровье на поездку в ПОМИ.';
let aVAlektrickeN_0 = 'В электричке нашли бездыханное тело.';
let aDenegUTebqNe_0 = 'Денег у тебя нет, пришлось ехать зайцем...';
let aTebqZalovili_0 = 'Тебя заловили контролеры!';
let aVisadiliVKra_0 = 'Высадили в Красных зорях, гады!';
let aKontroleriJi_0 = 'Контролеры жизни лишили.';
let aUfDoexal_0 = 'Уф, доехал!';
let aExatZaicem_0 = 'Ехать зайцем';
let aCestnoZaplat_0 = 'Честно заплатить 10 руб. за билет в оба конца';

function goto_obschaga_to_pomi() {
    ClrScr();
    show_header_stats();
    GotoXY(1, 8);

    if (time_of_day > 20) {
        ClrScr();
        writeln(aZdraviiSmisl_0);
        writeln(aTiTamNikogoU_0);
        writeln(aNeBudemZrqTr_0);
        wait_for_key();
        return;
    }

    decrease_health(Random(10), aVAlektrickeN_0);
    current_place = 2;

    if (hero.money < 10) {

        writeln(aDenegUTebqNe_0);
        if (hero.charizma < Random(10)) {
            writeln(aTebqZalovili_0);
            writeln(aVisadiliVKra_0);
            hero.health -= 0xA;
            if (hero.health <= 0) {
                death_cause = aKontroleriJi_0;
            }
            hour_pass();
        } else {
            writeln(aUfDoexal_0);
        }

    } else {
        dialog_start();
        dialog_case(aExatZaicem_0, -1);
        dialog_case(aCestnoZaplat_0, -2);
        let res = dialog_run(1, 0x0C);

        if (!jnz(res, -1)) {
            if (hero.charizma < Random(10)) {
                GotoXY(1, 0x0F);
                writeln(aTebqZalovili_0);
                writeln(aVisadiliVKra_0);
                hour_pass();
            } else {
                GotoXY(1, 0x0F);
                writeln(aUfDoexal_0);
            }
        } else if (!jnz(res, -2)) {
            hero.money -= 10;
            hero.has_ticket = 1;
        }

    }

    wait_for_key();
    hour_pass();
}

let aUmerPoPutiVM_0 = 'Умер по пути в мавзолей.';

function goto_obschaga_to_mausoleum() {
    current_subject = -1;
    current_place = 5;
    decrease_health(3, aUmerPoPutiVM_0);
}

function see_timesheet() {
    ClrScr();
    show_timesheet();
    wait_for_key();
    ClrScr();
}

let aTebqCegoToNeTq = 'Тебя чего-то не тянет по-спать...';

function try_sleep() {
    if (time_of_day > 3 && time_of_day < 20) {
        GotoXY(1, 0x16);
        writeln(aTebqCegoToNeTq);
        wait_for_key();
    } else {
        goto_sleep();
    }
}

function clamp0(arg_2) {
    return arg_2 < 0 ? 0 : arg_2;
}

let aKTebeLomitsqSo = 'К тебе ломится сосед и приглашает тебя ';
let aNaSvoiDenRojde = 'на свой День Рожденья.';
let aNaDiskotekuVSa = 'на дискотеку в "Шайбе".';
let aPoigratVMafiu_ = 'поиграть в мафию.';
let aPoQuakat_ = 'по-Quakать.';
let aUguQSeicas = '"Угу, я сейчас!!!"';
let aNeIzviniMneGot = '"Не, извини, мне готовиться надо..."';
let aPosliOttqgivat = '"Пошли оттягиваться!"';
let aNuIZrq = '"Ну и зря!"';

function invite_from_neighbor() {
    write(aKTebeLomitsqSo);
    writeln([aNaSvoiDenRojde, aNaDiskotekuVSa, aPoigratVMafiu_, aPoQuakat_][Random(4)]);

    dialog_start();
    dialog_case(aUguQSeicas, -1);
    dialog_case(aNeIzviniMneGot, -2);
    let res = dialog_run(1, 10);

    if (res == -1) {

        GotoXY(1, 0x0E);
        writeln(aPosliOttqgivat);

        for (let var_2 = 2, var_6 = Random(3) + 4; var_2 <= var_6; ++var_2) {
            hour_pass();
            let subj = random_from_to(0, 5);
            hero.subject[subj].knowledge -=
                Random(Math.round(Math.sqrt(hero.subject[subj].knowledge * 2.0)));

            // #warning
            if (hero.subject[subj].knowledge < 0) {
                alert(hero.subject[subj].knowledge);
            }

            if (hero.charizma > Random(0x19)) {
                hero.health += Random(5) + 1;
            }
        }

        ++hero.charizma;

        if (hero.brain < 2) {
            hero.brain = Random(3) + 2;
        }

    } else if (res == -2) {
        GotoXY(1, 0x0E);
        writeln(aNuIZrq);
        hero.charizma -= Random(2) + 1;
    }

    wait_for_key();
    ClrScr();
}

let aTebqNeumolimoK = 'Тебя неумолимо клонит ко сну ...';
let aTiVObsage_CtoD = 'Ты в общаге. Что делать?';
let aGotovitSq = 'Готовиться';
let aPosmotretRaspi = 'Посмотреть расписание';
let aOtdixat_0 = 'Отдыхать';
let aLecSpat = 'Лечь спать';
let aPoitiNaFakulTe = 'Пойти на факультет';
let aPoexatVPomi_1 = 'Поехать в ПОМИ';
let aPoitiVMavzol_0 = 'Пойти в мавзолей';
let aSMenqXvatit_1 = 'С меня хватит!';
let aCtoDelat = 'ЧТО ДЕЛАТЬ ???';

function scene_obschaga() {
    show_header_stats();
    TextColor(7);
    GotoXY(1, 8);

    if (23 - idiv(Math.max(0, 0x32 - hero.health), 0xC) < time_of_day || time_of_day < 4) {
        writeln(aTebqNeumolimoK);
        wait_for_key();
        goto_sleep();
        return;
    } else if (time_of_day > 0x11 && Random(10) < 3 && !hero.is_invited) {
        hero.is_invited = 1;
        invite_from_neighbor();
        return;
    }

    writeln(aTiVObsage_CtoD);
    dialog_start();
    dialog_case(aGotovitSq, -1);
    dialog_case(aPosmotretRaspi, -2);
    dialog_case(aOtdixat_0, -3);
    dialog_case(aLecSpat, -4);
    dialog_case(aPoitiNaFakulTe, -5);
    dialog_case(aPoexatVPomi_1, -6);
    dialog_case(aPoitiVMavzol_0, -7);
    dialog_case_colored(aSMenqXvatit_1, -8, 9);
    dialog_case_colored(aCtoDelat, -9, 9);
    show_short_today_timesheet(10);

    let res = dialog_run(1, 10);
    if (res == -1) {
        botva();
    } else if (res == -2) {
        see_timesheet();
    } else if (res == -3) {
        rest_in_obschaga();
    } else if (res == -4) {
        try_sleep();
    } else if (res == -5) {
        goto_obschaga_to_punk();
    } else if (res == -6) {
        goto_obschaga_to_pomi();
    } else if (res == -7) {
        goto_obschaga_to_mausoleum();
    } else if (res == -8) {
        request_exit();
    } else if (res == -9) {
        request_help(1);
    }
}

function show_char_description(character, description) {
    TextColor(0x0E);
    write(character);
    TextColor(7);
    writeln(description);
}

function output_colored_string(s) {
    for (let i = 1; i <= s.length; ++i) {
        let c = s.charCodeAt(i - 1);
        if (c >= 0 && c <= 0x0F) {
            TextColor(c);
        } else {
            write(s.substr(i - 1, 1));
        }
    }
    writeln();
}

let aACtoVoobseDela = ' А что вообще делать? ';
let aObAkrane       = ' Об экране            ';
let aKudaIZacemXodi = ' Куда и зачем ходить? ';
let aOPrepodavatelq = ' О преподавателях     ';
let aOPersonajax    = ' О персонажах         ';
let aObAtoiProgramm = ' Об этой программе    ';
let aSpasiboNicego  = ' Спасибо, ничего      ';
let aCtoTebqInteres = 'Что тебя интересует?';

function select_help_page() {
    dialog_start();
    dialog_case(aACtoVoobseDela, -1);
    dialog_case(aObAkrane, -10);
    dialog_case(aKudaIZacemXodi, -2);
    dialog_case(aOPrepodavatelq, -3);
    dialog_case(aOPersonajax, -4);
    dialog_case(aObAtoiProgramm, -5);
    dialog_case(aSpasiboNicego, -100);

    GotoXY(1, 0x0E);
    TextColor(7);
    writeln(aCtoTebqInteres);

    let res = dialog_run(1, 0x0F);
    if (res == -1) {
        help_page = 1;
    } else if (res == -2) {
        help_page = 3;
    } else if (res == -3) {
        help_page = 4;
    } else if (res == -4) {
        help_page = 5;
    } else if (res == -5) {
        help_page = 6;
    } else if (res == -10) {
        help_page = 2;
    } else if (res == -100) {
        help_page = 0;
    }
}

let aEstVsego6Dnei_ = '\x07Есть всего \x0E6 дней\x07. За это время надо успеть получить \x0E6 зачетов\x07.';
let aCtobiPolucitZa = 'Чтобы получить \x0Eзачет\x07, можно успешно сдать сколько-то \x0Eзаданий\x07.';
let aCtobiSdatNesko = 'Чтобы сдать несколько заданий, можно чего-то знать и \x0Eприйти к преподу\x07.';
let aCtobiCegoToZna = 'Чтобы чего-то знать, можно \x0Eготовиться\x07.';
let aPrepodavatelei = 'Преподавателей надо искать по \x0Eрасписанию\x07.';
let aPokaGotovisSqI = 'Пока готовишься или сдаешь, \x0Eсамочуствие\x07 ухудшается.';
let aCtobiUlucsitSa = 'Чтобы улучшить самочуствие, можно \x0Eотдыхать\x07.';
let aVsqkieDopolnit = 'Всякие \x0Eдополнительные персонажи\x07 могут помогать, а могут мешать.';
let aAlTernativnieV = '\x0CАльтернативные варианты есть почти везде, но они тоже чего-то стоят\x07.';

function help_overview() {
    output_colored_string(aEstVsego6Dnei_);
    output_colored_string(aCtobiPolucitZa);
    output_colored_string(aCtobiSdatNesko);
    output_colored_string(aCtobiCegoToZna);
    output_colored_string(aPrepodavatelei);
    output_colored_string(aPokaGotovisSqI);
    output_colored_string(aCtobiUlucsitSa);
    output_colored_string(aVsqkieDopolnit);
    output_colored_string(aAlTernativnieV);
}

let aVLevomVerxnemU = '\x07В левом верхнем углу - игровые \x0Eдата\x07 и \x0Eвремя\x07,';
let aTvoeSostoqnieZ = '\x07твое состояние (\x0Eздоровье\x07, \x0Eкачества\x07), \x0Eденьги\x07.';
let aVPravomVerxnem = '\x07В правом верхнем углу - твои \x0Eнавыки\x07 по предметам.';
let aNavikiOcenivau = '\x07Навыки оцениваются двояко: по \x0E"общей шкале"\x07 (число)';
let aIPoSkaleTrebov = '\x07и по \x0Eшкале требований конкретного преподавателя\x07 ("оценка").';
let aNijeNavikovMin = '\x07Ниже навыков - мини-расписание на этот день + сданные задачи.';
let aPolnoeRaspisan = '\x07Полное расписание можно посмотреть в общаге (выбрать в меню).';
let aNakonecSlevaVN = '\x07Наконец, слева в нижней половине экрана - текущее меню.';
let aSostoqnieNavik = ' \x0AСОСТОЯНИЕ     \x0FНАВЫКИ';
let aSituaciq = ' \x0EСИТУАЦИЯ';
let aMenuRaspisanie = ' \x0BМЕНЮ          \x0CРАСПИСАНИЕ';

function help_screen() {
    output_colored_string(aVLevomVerxnemU);
    output_colored_string(aTvoeSostoqnieZ);
    output_colored_string(aVPravomVerxnem);
    output_colored_string(aNavikiOcenivau);
    output_colored_string(aIPoSkaleTrebov);
    output_colored_string(aNijeNavikovMin);
    output_colored_string(aPolnoeRaspisan);
    output_colored_string(aNakonecSlevaVN)
    writeln();
    output_colored_string(aSostoqnieNavik);
    output_colored_string(aSituaciq);
    output_colored_string(aMenuRaspisanie);
    writeln();
}

let aVObsageTiGotov = '\x07В \x0Eобщаге\x07 ты готовишься и отдыхаешь.';
let aNaFakulTetePun = 'На \x0Eфакультете(~=ПУНК)\x07 ты бегаешь по преподам и ищешь приятелей.';
let aCtobiPopastVKo = 'Чтобы попасть в \x0Eкомпьюетрный класс\x07, надо прийти на факультет.';
let aVKompUternomKl = 'В компьютерном классе ты сдаешь зачет по информатике и ищешь друзей.';
let aMavzoleiAtoTak = '\x0EМавзолей\x07 - это такая столовая. Там ты отдыхаешь и ищешь приятелей.';
let aPomiPeterburgs = '\x0EПОМИ\x07 - Петербургское Отделение Математического Института РАН.';
let aVPomiTiBudesIs = 'В ПОМИ ты будешь искать преподов и приятелей.';
let aVPomiNadoExatN = 'В ПОМИ надо ехать на электричке, это занимает \x0E1 час\x07.';
let aEsliExatZaicem = 'Если ехать зайцем - то может оказаться, что и \x0E2 часа\x07.';
let aKromeTogoPoezd = 'Кроме того, \x0Cпоездка отнимает и здоровье тоже\x07.';

function help_places() {
    output_colored_string(aVObsageTiGotov);
    output_colored_string(aNaFakulTetePun);
    output_colored_string(aCtobiPopastVKo);
    output_colored_string(aVKompUternomKl);
    output_colored_string(aMavzoleiAtoTak);
    output_colored_string(aPomiPeterburgs);
    output_colored_string(aVPomiTiBudesIs);
    output_colored_string(aVPomiNadoExatN);
    output_colored_string(aEsliExatZaicem);
    output_colored_string(aKromeTogoPoezd);
}

let aVsemirnovM_a_A = 'Всемирнов М.А., алгебра';
let aOcenSerEzniiIV = ' - очень серьезный и весьма строгий.';
let aDubcovE_s_Mata = 'Дубцов Е.С., матан';
let aNeOcenStrogiiI = ' - не очень строгий и с некоторой халявой.';
let aPodkoritovS_s_ = 'Подкорытов С.С., геометрия';
let aZamesaetDutkev = ' - замещает Дуткевича Ю.Г.. Почти без проблем.';
let aKlimovA_a_Info = 'Климов А.А., информатика';
let aBezProblemNoTr = ' - без проблем, но трудно найти.';
let aVlasenkoN_p_En = 'Влащенко Н.П., English';
let aBezProblemNoSN = ' - без проблем, но с некоторым своеобразием.';
let aAlBinskiiE_g_F = 'Альбинский Е.Г., Физ-ра';
let aBezProblemNoOt = ' - без проблем, но от физ-ры сильно устаешь.';

function help_professors() {
    show_char_description(aVsemirnovM_a_A, aOcenSerEzniiIV);
    show_char_description(aDubcovE_s_Mata, aNeOcenStrogiiI);
    show_char_description(aPodkoritovS_s_, aZamesaetDutkev);
    show_char_description(aKlimovA_a_Info, aBezProblemNoTr);
    show_char_description(aVlasenkoN_p_En, aBezProblemNoSN);
    show_char_description(aAlBinskiiE_g_F, aBezProblemNoOt);
}

let aDiamond = 'Diamond';
let aAvtorIgriGeroi = ' - автор игры "Герои Мата и Меха" (MMHEROES), знает всё о ее "фичах".';
let aMisa = 'Миша';
let aKogdaToAlFaTes = ' - когда-то альфа-тестер; понимает в стратегии получения зачетов.';
let aSerj = 'Серж';
let aEseOdinAksAlFa = ' - еще один экс-альфа-тестер и просто хороший товарищ.';
let aPasa = 'Паша';
let aStarosta_Samii = ' - староста. Самый нужный в конце семестра человек.';
let aRai = 'RAI';
let aProstoiStudent = ' - простой студент. Не любит, когда кто-то НЕ ХОЧЕТ ему помогать.';
let aAndru = 'Эндрю';
let aToJeStudent_Mo = ' - тоже студент. Можно попробовать обратиться к нему за помощью.';
let aSasa = 'Саша';
let aEseOdinStudent = ' - еще один студент; подробно и разборчиво конспектирует лекции.';
let aNil = 'NiL';
let aDevuskaIzVolNo = ' - девушка из вольнослушателей. Часто эксплуатирует чужие мозги.';
let aKolq = 'Коля';
let aStudentBolSoiL = ' - студент, большой любитель алгебры и выпивки.';
let aGrisa = 'Гриша';
let aStudentPofigis = ' - студент-пофигист. Любит пиво и халяву.';
let aKuzMenkoV_g_ = 'Кузьменко В.Г.';
let aPrepodaetInfor = ' - преподает информатику у другой половины 19-й группы.';
let aDjug = 'DJuG';
let aUgadaiteKto = ' - угадайте, кто ;)';

function help_characters() {
    show_char_description(aDiamond, aAvtorIgriGeroi);
    show_char_description(aMisa, aKogdaToAlFaTes);
    show_char_description(aSerj, aEseOdinAksAlFa);
    show_char_description(aPasa, aStarosta_Samii);
    show_char_description(aRai, aProstoiStudent);
    show_char_description(aAndru, aToJeStudent_Mo);
    show_char_description(aSasa, aEseOdinStudent);
    show_char_description(aNil, aDevuskaIzVolNo);
    show_char_description(aKolq, aStudentBolSoiL);
    show_char_description(aGrisa, aStudentPofigis);
    show_char_description(aKuzMenkoV_g_, aPrepodaetInfor);
    show_char_description(aDjug, aUgadaiteKto);
}

let aCrwmmDevelopme = '\x0FCrWMM Development Team:\x07';
let aDmitriiPetrovA = '\x0EДмитрий Петров (aka Diamond)\x07 - автор идеи, главный программист';
let aKonstantinBule = '\x0EКонстантин Буленков \x07- портирование';
let aVanqPavlikTest = '\x0EВаня Павлик \x07- тестирование, веб-страничка';
let aAlekseiRumqnce = '\x0EАлексей Румянцев (aka RAI) \x07- retired веб-мастер';
let aMnenieAvtorovN = '\x07Мнение авторов не всегда совпадает с высказываниями персонажей.';
let aEsliZapustitMm = '\x0BЕсли запустить \x0Fmmheroes\x0B с хоть каким параметром, у тебя будет возможность';
let aVibratLicniiPr = 'выбрать личный профиль своего "героя"; например,';
let aMmheroesZ11 = '           \x0Ammheroes z#11';
let aPoqvitsqMenusk = '\x0BПоявится менюшка, в которой все и так ясно.';

function help_about() {
    output_colored_string(aCrwmmDevelopme);
    writeln();
    output_colored_string(aDmitriiPetrovA);
    output_colored_string(aKonstantinBule);
    output_colored_string(aVanqPavlikTest);
    output_colored_string(aAlekseiRumqnce);
    output_colored_string(aMnenieAvtorovN);
    writeln();
    output_colored_string(aEsliZapustitMm);
    output_colored_string(aVibratLicniiPr);
    output_colored_string(aMmheroesZ11);
    output_colored_string(aPoqvitsqMenusk);
}

function request_help(page) {
    help_page = page;
    while (help_page) {
        ClrScr();
        [help_overview, help_screen, help_places, help_professors, help_characters, help_about][help_page - 1]();
        select_help_page();
    }
}

function goto_punk_to_obschaga() {
    current_subject = -1;
    current_place = 4;
}

let aZdraviiSmisl_1 = 'Здравый смысл подсказывает тебе, что в такое время';
let aTiTamNikogoU_1 = 'ты там никого уже не найдешь.';
let aNeBudemZrqTr_1 = 'Не будем зря тратить здоровье на поездку в ПОМИ.';
let aVAlektrickeN_1 = 'В электричке нашли бездыханное тело.';
let aDenegUTebqNe_1 = 'Денег у тебя нет, пришлось ехать зайцем...';
let aTebqZalovili_1 = 'Тебя заловили контролеры!';
let aVisadiliVKra_1 = 'Высадили в Красных зорях, гады!';
let aKontroleriJi_1 = 'Контролеры жизни лишили.';
let aUfDoexal_1 = 'Уф, доехал!';
let aExatZaicem_1 = 'Ехать зайцем';
let aCestnoZaplat_1 = 'Честно заплатить 10 руб. за билет в оба конца';

function goto_punk_or_mausoleum_to_pomi() {
    ClrScr();
    show_header_stats();
    GotoXY(1, 8);

    if (time_of_day > 20) {
        writeln(aZdraviiSmisl_1);
        writeln(aTiTamNikogoU_1);
        writeln(aNeBudemZrqTr_1);
        wait_for_key();
        return;
    }

    hero.health -= Random(10);
    if (hero.health <= 0) {
        is_end = 1;
        death_cause = aVAlektrickeN_1;
    }

    current_place = 2;

    if (hero.money < 10) {
        writeln(aDenegUTebqNe_1);
        if (hero.charizma < Random(10)) {
            writeln(aTebqZalovili_1);
            writeln(aVisadiliVKra_1);
            hero.health -= 0xA;
            if (hero.health <= 0) {
                is_end = 1;
                death_cause = aKontroleriJi_1;
            }
            hour_pass();
        } else {
            writeln(aUfDoexal_1);
        }
    } else {
        dialog_start();
        dialog_case(aExatZaicem_1, -1);
        dialog_case(aCestnoZaplat_1, -2);
        let res = dialog_run(1, 0x0C);

        if (res == -1) {
            if (hero.charizma < Random(10)) {
                GotoXY(1, 0x0F);
                writeln(aTebqZalovili_1);
                writeln(aVisadiliVKra_1);
                hour_pass();
            } else {
                GotoXY(1, 0x0F);
                writeln(aUfDoexal_1);
            }
        } else if (res == -2) {
            hero.money -= 10;
            hero.has_ticket = 1;
        }

    }
    wait_for_key();
    hour_pass();
}

let aBolsaqRasscita = 'Болшая, рассчитанная на поток аудитория кажется забитой народом.';
let aZdesPrisutstvu = 'Здесь присутствуют не только твои одногруппники,';
let aNoIKakieToNeOc = 'но и какие-то не очень знакомые тебе люди';
let aKajetsqPriklad = '(кажется, прикладники со второго курса).';
let aZaStolomOkoloD = 'За столом около доски сидит М. А. Всемирнов';
let aIPrinimaetZace = 'и принимает зачет у студентов.';
let aTiResaesNeTerq = 'Ты решаешь не терять времени даром и присоединиться к остальным.';
let aTiZaxodisVNebo = 'Ты заходишь в небольшую аудиторию, забитую народом.';
let aOkoloDoskiSidi = 'Около доски сидит весьма своеобразный преподаватель.';
let aSieSvoebrazieP = 'Сие своебразие проявляется, в первую очередь, значком';
let aSNadpisUNeStre = 'с надписью: "НЕ СТРЕЛЯЕЙТЕ В ПРЕПОДА - ОБУЧАЕТ КАК УМЕЕТ".';
let aAViKKomu = '"А вы к кому? Максим Александрович в аудитории напротив!"';
let aPoxojeTiNeTuda = 'Похоже, ты не туда попал. Ты извиняешься и идешь к Всемирнову.';
let a____0 = '...';

function show_intro_algebra() {
    ClrScr();
    TextColor(10);

    if (ja(Random(3), 0)) {
        writeln(aBolsaqRasscita);
        writeln(aZdesPrisutstvu);
        writeln(aNoIKakieToNeOc);
        writeln(aKajetsqPriklad);
        writeln(aZaStolomOkoloD);
        writeln(aIPrinimaetZace);
        writeln(aTiResaesNeTerq);
    } else {
        writeln(aTiZaxodisVNebo);
        writeln(aOkoloDoskiSidi);
        writeln(aSieSvoebrazieP);
        writeln(aSNadpisUNeStre);
        writeln(aAViKKomu);
        writeln(aPoxojeTiNeTuda);
    }

    writeln(a____0);
    ReadKey();
    ClrScr();
}

let aVObicnoiGruppo = 'В обычной "групповой" аудитории сидят около 15 человек.';
let aVCentreIxVnima = 'В центре их внимания находится Е.С. Дубцов,';
let aPrinimausiiZac = 'принимающий зачет по матанализу.';
let aTiPolucaesZada = 'Ты получаешь задание и садишься за свободную парту.';
let a____1 = '...';

function show_intro_matan() {
    ClrScr();
    TextColor(0x0B);
    writeln(aVObicnoiGruppo);
    writeln(aVCentreIxVnima);
    writeln(aPrinimausiiZac);
    writeln(aTiPolucaesZada);
    writeln(a____1);
    ReadKey();
    ClrScr();
}

let aNebolSaqPolupu = 'Небольшая, полупустая аудитория.';
let aIDoskaISteniIP = 'И доска, и стены, и, похоже, даже пол';
let aIspisaniRazlic = 'исписаны различными геометрическими утверждениями.';
let aVCentreVsegoAt = 'В центре всего этого хаоса находится';
let aIliSkoreePosto = '(или, скорее, постоянно перемещается)';
let aPodkoritovMlad = 'Подкорытов-младший.';
let aTiRaduesSqCtoS = 'Ты радуешься, что смог застать его на факультете!';
let a____2 = '...';

function show_intro_git() {
    ClrScr();
    TextColor(9);
    writeln(aNebolSaqPolupu);
    writeln(aIDoskaISteniIP);
    writeln(aIspisaniRazlic);
    writeln(aVCentreVsegoAt);
    writeln(aIliSkoreePosto);
    writeln(aPodkoritovMlad);
    writeln(aTiRaduesSqCtoS);
    writeln(a____2);
    hero.health += 5
    ReadKey();
    ClrScr();
}

let aNaTretEmAtajeU = 'На третьем этаже учебного корпуса Мат-Меха';
let aVOdnoiIzAudito = 'в одной из аудиторий, закрепленных за кафедрой иностранных языков,';
let aRaspolojilasN_ = 'расположилась Н.П. Влащенко.';
let aSteniKabinetaV = 'Стены кабинета выглядят как-то странно.';
let aRqdomSNebolSoi = 'Рядом с небольшой доской висит изображение Эйфелевой башни,';
let aCutDalSeStrann = 'чуть дальше - странное изображение,';
let aObladauseeNepo = 'обладающее непостижимым метафизическим смыслом.';
let aPoxojeSeicasTi = 'Похоже, сейчас ты будешь сдавать зачет по английскому.';
let a____3 = '...';

function show_intro_english() {
    ClrScr();
    TextColor(0x0E);
    writeln(aNaTretEmAtajeU);
    writeln(aVOdnoiIzAudito);
    writeln(aRaspolojilasN_);
    writeln(aSteniKabinetaV);
    writeln(aRqdomSNebolSoi);
    writeln(aCutDalSeStrann);
    writeln(aObladauseeNepo);
    writeln(aPoxojeSeicasTi);
    writeln(a____3);
    ReadKey();
    ClrScr();
}

let aAlBinskiiProvo = 'Альбинский проводит лекцию о пользе бега';
let aDlqNarodnogoXo = 'для народного хозяйства.';
let aDlqLicnoiJizni = 'для личной жизни.';
let aDlqNaucnoiRabo = 'для научной работы.';
let aDlqKommunistic = 'для коммунистического строительства.';
let aDlqUcebiIDosug = 'для учебы и досуга.';
let aDlqSpaseniqOtK = 'для спасения от контроллеров.';
let aPoxojeOnKakVse = 'Похоже, он, как всегда, немного увлекся.';
let aNemnogoVNasemS = 'Немного в нашем случае - 1 час.';

function show_intro_fizra_lecture() {
    writeln(aAlBinskiiProvo);
    writeln([aDlqNarodnogoXo, aDlqLicnoiJizni, aDlqNaucnoiRabo, aDlqKommunistic, aDlqUcebiIDosug, aDlqSpaseniqOtK][Random(6)]);
    ++timesheet[day_of_week][Fizra].to;
    writeln();
    writeln(aPoxojeOnKakVse);
    writeln(aNemnogoVNasemS);
    writeln();
    hour_pass();
}

let aAlBinskiiProsi = 'Альбинский просит тебя замерить пульс.';
let aNazvavPervoePr = 'Назвав первое пришедшее в замученную математикой голову число,';
let aTiOtpravlqesSq = 'ты отправляешься мотать круги в парке,';
let aVKotoromVoobse = 'в котором, вообще-то, "запрещены спортивные мероприятия".';
let a____4 = '...';

function show_intro_fizra() {
    ClrScr();
    TextColor(0x0F);
    if (Random(3) == 0) {
        show_intro_fizra_lecture();
    }
    writeln(aAlBinskiiProsi);
    writeln(aNazvavPervoePr);
    writeln(aTiOtpravlqesSq);
    writeln(aVKotoromVoobse);
    writeln(a____4);
    ReadKey();
    ClrScr();
}

function goto_exam_with_intro(exam) {
    if (exam == 0) {
        show_intro_algebra();
    } else if (exam == 1) {
        show_intro_matan();
    } else if (exam == 2) {
        show_intro_git();
    } else if (exam == 4) {
        show_intro_english();
    } else if (exam == 5) {
        show_intro_fizra();
    }
}

let aTiSeicasNaFaku = 'Ты сейчас на факультете. К кому идти?';
let aNiKKomu = 'Ни к кому';

function select_professor_punk() {
    show_header_stats();
    TextColor(7);
    GotoXY(1, 8);
    writeln(aTiSeicasNaFaku);

    dialog_start();
    for (let i = 0; i <= 5; ++i) {
        if (is_professor_here(i)) {
            dialog_case(subjects[i].professor.name, i);
        }
    }
    dialog_case(aNiKKomu, -1);
    current_subject = dialog_run(1, 10);

    if (Random(2) == 0) {
        goto_exam_with_intro(current_subject);
    }
}

let aUmerPoPutiVM_1 = 'Умер по пути в мавзолей.';

function goto_punk_to_mausoleum() {
    current_subject = -1;
    current_place = 5;
    decrease_health(3, aUmerPoPutiVM_1);
}

let aUpalSLestniciU = 'Упал с лестницы у главного входа.';

function goto_punk_to_kompy() {
    current_place = 3;
    current_subject = -1;
    decrease_health(2, aUpalSLestniciU);
}

let aIk = ' <йк> ';

function output_ik_string(s) {
    let terkom_line = [10, 14, 0x10, 0x12];
    let iks = 5 - _upper_bound(terkom_line, time_of_day);

    for (let i = 1; i <= s.length; ++i) {
        if (s[i - 1] == ' ' && Random(iks) == 0) {
            write(aIk);
            --iks;
            if (iks < 1) {
                iks = 2;
            }
        } else {
            write(s[i - 1]);
        }
    }

}

function sub_15B3A() {
    let var_2;

    if (!jnz(terkom_has_places, 0)) {
        ClrScr();
        show_header_stats();
        GotoXY(1, 8);
        TextColor(0x0B);
        output_ik_string(aSkazanoJeNetSv);
        writeln();
        wait_for_key();
        ClrScr();
        return;
    }

    if (!jbe(Random(3), 0)) {
        ClrScr();
        show_header_stats();
        GotoXY(1, 8);
        TextColor(10);
        output_ik_string(aIzviniParenSvo);
        writeln();
        output_ik_string(aPoidiPoucisPok);
        writeln();
        terkom_has_places = 0;
        wait_for_key();
        ClrScr();
        return;
    }


    do {
        ClrScr();
        show_header_stats();
        GotoXY(1, 8);
        writeln(aTiSidisZaSvobo);
        writeln(aVTerexovskoiKo);
        writeln(aCtoDelatBudem);
        dialog_start();
        dialog_case(aSidetIZarabati, -1);

        if (hero.has_mmheroes_disk != 0) {
            dialog_case(aPoigratVMmhe_0, -10);
        }

        if (hero.has_inet != 0) {
            dialog_case(aPosidetCasokVI, -11);
        }

        dialog_case(aViitiOtsudaNaS, -2);
        show_short_today_timesheet(8);

        let ax = dialog_run(1, 0x0C);
        if (ax == -1) {

            var_2 = Random(Random(hero.charizma + hero.brain)) + 1;

            while (!jle(var_2, 4)) {
                var_2 = Random(var_2 - 3) + 2;
            }

            TextColor(7);
            GotoXY(1, 0x13);
            output_ik_string(aTebeNakapalo);
            TextColor(0x0F);

            write(var_2);

            TextColor(7);
            writeln(aRub__0);

            hero.money += var_2;
            decrease_health(Random(var_2 * 2), aSgorelNaRabote);
            wait_for_key();
            hour_pass();

        } else if (!jnz(ax, -2)) {
            GotoXY(1, 0x11);
            output_ik_string(aUxodim___);
            writeln();
            wait_for_key();
            ClrScr();
            return;
        } else if (ax != -10) {
            ClrScr();
            TextColor(0x0B);
            output_ik_string(aPoNeizvestnoiP);
            writeln();
            output_ik_string(aMmheroesNeOkaz);
            writeln();
            output_ik_string(aNaOkrujausiiMi);
            writeln();
            ReadKey();
            output_ik_string(aOglqdevsisVo_0);
            writeln();
            output_ik_string(aCtoVseTovarisi);
            writeln();
            writeln(aRubqtsqVMmhero);
            output_ik_string(aVozmojnoOniVse);
            writeln();
            output_ik_string(aPitautsqIgratP);
            writeln();
            output_ik_string(aKotoriiSrabati);
            writeln();
            writeln();
            wait_for_key();
            ClrScr();
        } else if (ax == -11) {

            GotoXY(1, 0x13);
            writeln(aVotZdorovoMiSi);

            var_2 = Random(Random(hero.charizma + hero.brain)) + 1;

            while (!jle(var_2, 4)) {
                var_2 = Random(var_2 - 3) + 2;
            }

            TextColor(7);
            GotoXY(1, 0x14);
            output_ik_string(aTebeNakapalo);
            TextColor(0x0F);
            write(var_2);
            TextColor(7);
            writeln(aRub__0);
            hero.money += var_2;
            wait_for_key();
            hour_pass();

        }

    } while (!jg(time_of_day, 0x12));

    GotoXY(1, 0x14);
    output_ik_string(aRabociiDenZako);
    wait_for_key();
}

let aCtoBratBudem = 'Что брать будем?';
let aCaiZa2R_ = 'Чай за 2 р.';
let aKeksZa4R_ = 'Кекс за 4 р.';
let aCaiIVipecku6R_ = 'Чай и выпечку, 6 р.';
let aProstoPosijuSP = 'Просто посижу с приятелями.';
let aQVoobseZrqSuda = 'Я вообще зря сюда зашел.';

function sub_15F9B() {
    ClrScr();
    show_header_stats();
    GotoXY(1, 8);
    writeln(aCtoBratBudem);
    show_short_today_timesheet(0x0B);
    dialog_start();

    if (!jl(hero.money, 2)) {
        dialog_case(aCaiZa2R_, -1);
    }

    if (!jl(hero.money, 4)) {
        dialog_case(aKeksZa4R_, -2);
    }

    if (!jl(hero.money, 6)) {
        dialog_case(aCaiIVipecku6R_, -3);
    }

    dialog_case(aProstoPosijuSP, -4);
    dialog_case(aQVoobseZrqSuda, 0);
    let ax = dialog_run(1, 0x0B);

    if (!jnz(ax, -1)) {
        hero.money -= 2;
        hero.health += Random(hero.charizma) + 2;
    } else if (!jnz(ax, -2)) {
        hero.money -= 4;
        hero.health += Random(hero.charizma) + 4;
    } else if (!jnz(ax, -3)) {
        hero.money -= 6;
        hero.health += Random(hero.charizma) + 7;
    } else if (!jnz(ax, -4)) {
        hero.health += Random(hero.charizma);
    } else if (!jnz(ax, 0)) {
        return;
    }

    hour_pass();
}

let aTiNaFakulTete_ = 'Ты на факультете. Что делать?';
let aIdtiKPrepodu = 'Идти к преподу';
let aPosmotretNaBao = 'Посмотреть на баобаб';
let aPoitiVObsagu_0 = 'Пойти в общагу';
let aPoexatVPomi_2 = 'Поехать в ПОМИ';
let aPoitiVMavzol_1 = 'Пойти в мавзолей';
let aPoitiVKompUter = 'Пойти в компьютерный класс';
let aSxoditVKafe = 'Сходить в кафе';
let aPoitiVTerkomPo = 'Пойти в ТЕРКОМ, поработать';
let aSMenqXvatit_2 = 'С меня хватит!';

function scene_punk() {
    show_header_stats();
    TextColor(7);
    show_short_today_timesheet(10);
    GotoXY(1, 8);
    writeln(aTiNaFakulTete_);
    dialog_start();
    dialog_case(aIdtiKPrepodu, -1);
    dialog_case(aPosmotretNaBao, -2);
    dialog_case(aPoitiVObsagu_0, -3);
    dialog_case(aPoexatVPomi_2, -4);
    dialog_case(aPoitiVMavzol_1, -5);

    if (!jge(time_of_day, 0x14)) {
        dialog_case(aPoitiVKompUter, -7);
    }

    if (!jl(time_of_day, 10) && !jg(time_of_day, 0x12)) {
        dialog_case(aSxoditVKafe, -12);
    }


    for (let var_2 = 0; var_2 <= 0xB; ++var_2) {
        if (!jnz(classmates[var_2].place, 1)) {
            if (!jnz(classmates[var_2].current_subject, -1)) {
                dialog_case_colored(classmate_names[var_2], var_2, 0xE);
            }
        }

    }

    if (hero.is_working_in_terkom != 0 && !jg(time_of_day, 0x12)) {
        dialog_case(aPoitiVTerkomPo, -10);
    }

    dialog_case_colored(aSMenqXvatit_2, -6, 9);

    let res = dialog_run(1, 10);

    if (res == -1) {
        select_professor_punk();
    } else if (res == -2) {
        show_top_gamers();
    } else if (res == -3) {
        goto_punk_to_obschaga();
    } else if (res == -4) {
        goto_punk_or_mausoleum_to_pomi();
    } else if (res == -5) {
        goto_punk_to_mausoleum();
    } else if (res == -6) {
        request_exit();
    } else if (res == -7) {
        goto_punk_to_kompy();
    } else if (res == -10) {
        sub_15B3A();
    } else if (res == -12) {
        sub_15F9B();
    } else if (!jl(res, 0) && !jg(res, 0x0B)) {
        talk_with_classmate(res);
    }
}

let aMalenKiiKabine = 'Маленький кабинет в ПОМИ заполнен людьми.';
let aIKakNiStrannoP = 'И, как ни странно, почти все они хотят одного и того же.';
let aPoxojeTiTojeXo = 'Похоже, ты тоже хочешь именно этого -';
let aRazdelatSqNako = 'РАЗДЕЛАТЬСЯ НАКОНЕЦ С ЗАЧЕТОМ ПО АЛГЕБРЕ!';
let a____5 = '...';

function sub_163B7() {
    ClrScr();
    TextColor(0x0C);
    writeln(aMalenKiiKabine);
    writeln(aIKakNiStrannoP);
    writeln(aPoxojeTiTojeXo);
    writeln(aRazdelatSqNako);
    writeln(a____5);
    ReadKey();
    ClrScr();
}

let aVNebolSomPomis = 'В небольшом ПОМИшном кабинете собралось человек 10 студентов.';
let aKromeNixVKomna = 'Кроме них, в комнате ты видишь Подкорытова-младшего,';
let aATakjePolnogoS = 'а также - полного седоволосого лысеющего господина,';
let aIzdausegoXarak = 'издающего характерные пыхтящие звуки.';
let aTiNadeesSqCtoV = 'Ты надеешься, что все это скоро кончится...';
let a____6 = '...';

function sub_1653F() {
    ClrScr();
    writeln(aVNebolSomPomis);
    writeln(aKromeNixVKomna);
    writeln(aATakjePolnogoS);
    writeln(aIzdausegoXarak);
    writeln(aTiNadeesSqCtoV);
    writeln(a____6);
    ReadKey();
    ClrScr();
}

function sub_165D9(arg_0) {
    if (arg_0 == 0) {
        sub_163B7();
    } else if (arg_0 == 2) {
        sub_1653F();
    }
}

let aTiSeicasVPomi_ = 'Ты сейчас в ПОМИ. К кому идти?';
let aNiKKomu_0 = 'Ни к кому';

function sub_16622() {
    show_header_stats();
    TextColor(7);
    GotoXY(1, 8);
    writeln(aTiSeicasVPomi_);
    dialog_start();

    for (let var_2 = 0; var_2 <= 5; ++var_2) {
        if (is_professor_here(var_2) != 0) {
            dialog_case(subjects[var_2].professor.name, var_2);
        }
    }

    dialog_case(aNiKKomu_0, -1);
    current_subject = dialog_run(1, 10);

    if (!jnz(Random(2), 0)) {
        sub_165D9(current_subject);
    }
}

let aCtoBratBudem_0 = 'Что брать будем?';
let aKofeZa2R_ = 'Кофе за 2 р.';
let aKorjZa4R_ = 'Корж за 4 р.';
let aKofeIVipecku6R = 'Кофе и выпечку, 6 р.';
let aNicegoProstoPr = 'Ничего, просто просидеть здесь часок.';
let aSovsemNicego_B = 'Совсем ничего. Бывает.';

function sub_1673E() {
    ClrScr();
    show_header_stats();
    GotoXY(1, 8);
    writeln(aCtoBratBudem_0);
    show_short_today_timesheet(10);
    dialog_start();

    if (!jl(hero.money, 2)) {
        dialog_case(aKofeZa2R_, -1);
    }

    if (!jl(hero.money, 4)) {
        dialog_case(aKorjZa4R_, -2);
    }

    if (!jl(hero.money, 6)) {
        dialog_case(aKofeIVipecku6R, -3);
    }

    dialog_case(aNicegoProstoPr, -4);
    dialog_case(aSovsemNicego_B, 0);

    let ax = dialog_run(1, 10);
    if (ax == -1) {
        hero.money -= 2;
        hero.health += Random(hero.charizma) + 3;
    } else if (ax == -2) {
        hero.health += Random(hero.charizma) + 6;
    } else if (ax == -3) {
        hero.money -= 6;
        hero.health += Random(hero.charizma) + 10;
    } else if (ax == -4) {
        hero.health += Random(hero.charizma);
    } else if (ax == 0) {
        return;
    }

    hour_pass();
}

let aEdemVPunkBilet = 'Едем в ПУНК, билета нет. Будем покупать билет (5 рублей)?';
let aDaBudem = 'Да, будем';
let aNetNeBudem = 'Нет, не будем';
let aVAlektrickeN_2 = 'В электричке нашли бездыханное тело.';
let aEdemZaicem___ = 'Едем зайцем... ';
let aKontroleriPoim = 'Контролеры поймали! Высадили в Красных Зорях!';
let aKontroleriJi_2 = 'Контролеры жизни лишили.';

function sub_16914() {
    if (!hero.has_ticket && hero.money >= 5) {
        ClrScr();
        show_header_stats();
        show_short_today_timesheet(10);
        GotoXY(1, 8);
        TextColor(0x0E);
        writeln(aEdemVPunkBilet);
        dialog_start();
        dialog_case(aDaBudem, -1);
        dialog_case(aNetNeBudem, -2);
        let ax = dialog_run(1, 10);

        if (!jnz(ax, -1)) {
            hero.money -= 5
            hero.has_ticket = 1;
        }
    }

    decrease_health(Random(10), aVAlektrickeN_2);
    current_place = 1;

    if (!hero.has_ticket) {
        GotoXY(1, 0x16);
        write(aEdemZaicem___);

        if (hero.charizma < Random(10)) {
            writeln(aKontroleriPoim);
            decrease_health(10, aKontroleriJi_2);
        }

        wait_for_key();
        hour_pass();
    }

    hour_pass();
    hero.has_ticket = 0;
}

let aTiVPomi_CtoDel = 'Ты в ПОМИ. Что делать?';
let aIdtiKPrepodu_0 = 'Идти к преподу';
let aPosmotretNaDos = 'Посмотреть на доску объявлений';
let aPoitiVKafe = 'Пойти в кафе';
let aPoexatVPunk = 'Поехать в ПУНК';
let aSMenqXvatit_3 = 'С меня хватит!';

function scene_pomi() {
    show_header_stats();
    TextColor(7);
    GotoXY(1, 8);
    writeln(aTiVPomi_CtoDel);
    dialog_start();
    dialog_case(aIdtiKPrepodu_0, -1);
    dialog_case(aPosmotretNaDos, -2);
    dialog_case(aPoitiVKafe, -3);
    dialog_case(aPoexatVPunk, -4);

    for (let var_2 = 0; var_2 <= 0xB; ++var_2) {
        if (!jnz(classmates[var_2].place, 2) && !jnz(classmates[var_2].current_subject, -1)) {
            dialog_case_colored(classmate_names[var_2], var_2, 0xE);
        }
    }

    dialog_case_colored(aSMenqXvatit_3, -5, 9);
    show_short_today_timesheet(10);
    let res = dialog_run(1, 10);

    if (res == -1) {
        sub_16622();
    } else if (res == -2) {
        show_top_gamers();
    } else if (res == -3) {
        sub_1673E();
    } else if (res == -4) {
        sub_16914();
    } else if (res == -5) {
        request_exit();
    } else if (!jl(res, 0) && !jg(res, 0x0B)) {
        talk_with_classmate(res);
    }
}

function read_top_gamers()  {
    /*get_top();

    let var_82;
    let var_80;

    Assign(var_80, aMmheroes_hi);
    Reset(var_80, 0x23);

    if (IOResult() != 0) {
        top_gamers[0].name = aKolq_0; // по 0x20 байт на каждую строку
        top_gamers[0].score = 0x190;
        top_gamers[1].name = aSasa_0;
        top_gamers[1].score = 0x118;
        top_gamers[2].name = aAndru_0;
        top_gamers[2].score = 0x0B4;
        top_gamers[3].name = aPasa_0;
        top_gamers[3].score = 0x64;
        top_gamers[4].name = aGrisa_0;
        top_gamers[4].score = 0x14;
        return;
    }
    for (var_82 = 0; var_82 <= 4; ++var_82) {
        top_gamers[var_82] = Read(var_80);
    }
    Close(var_80);*/
}

function update_top_gamers(score) {
    let var_108;
    let var_106;
    let my_place = -1;

    /*
    for (let i = 4; i >= 0; --i) {
        if (top_gamers[i].score >= score) {
            my_place = i;
            break;
        }
    }

    if (my_place == 4) {
        return;
    }
    */

    TextColor(0x0F);
    writeln(aPozdravlqu);
    writeln(aTiPopalVSkrija);
    writeln(aNeBoisqAtoNeBo);
    writeln();
    write(aKakTebqZovutGe);
    TextColor(10);
    let my_name = readln();

    if (my_name.length == 0) {
        TextColor(0x0F);
        writeln();
        writeln(aNeXocesUvekove);
        return;
    }

    set_user_name(my_name);

    /*
    ++my_place;
    if (my_place <= 3) {
        for (let i = 3; i >= my_place; --i) {
            top_gamers[i + 1] = top_gamers[i];
        }
    }

    top_gamers[my_place] = {name: my_name, score: score};
    */

    send_replay({score: score});

    writeln();
    TextColor(0x0F);
    writeln(aNuVotIVse_);
    writeln();
}

let aMmheroes_hi_0 = 'mmheroes.hi';

function write_top_gamers() {
/*
    let var_82;
    let var_80;

    Assign(var_80, aMmheroes_hi_0);
    Rewrite(var_80, 0x23);

    for (var_82 = 0; var_82 <= 4; ++var_82) {
        Write(var_80, top_gamers[var_82]);
    }

    Close(var_80);
*/
}

let asc_16F8F = '******                                           ******';
let asc_16FC7 = '      *********                         *********';
let asc_16FF9 = '               *************************';
let aVotImenaTexKto = 'Вот имена тех, кто прошел это наводящее ужас испытание:';
let aGeroiZarabotal = '    ГЕРОЙ            ЗАРАБОТАЛ';
let aRub__1 = ' руб.';

function show_top_gamers() {
    ClrScr();
    TextColor(0x0F);
    writeln(asc_16F8F);
    writeln(asc_16FC7);
    writeln(asc_16FF9);
    TextColor(0x0E);
    writeln(aVotImenaTexKto);
    writeln();
    writeln(aGeroiZarabotal);

    for (let i = 0; i < top_gamers.length; ++i) {
        TextColor(0x0F);
        GotoXY(4, i + 7)
        write(top_gamers[i].name);
        GotoXY(0x19, i + 7);
        write(top_gamers[i].score);
        write(aRub__1);

    }

    GotoXY(1, 0x14);
    TextColor(7);
    wait_for_key();
}

let aZaderjivaetsqE = ' задерживается еще на час.';
let aUxodit_ = ' уходит.';

function sub_171C4() {
    if (hero.health <= 0) {
        return;
    }

    ClrScr();
    show_header_stats();
    GotoXY(1, 0x17);
    TextColor(0x0C);

    if (subjects[current_subject].member0xFA * 5 + time_of_day * 6 < hero.charizma * 3 + Random(0x3C) + 0x14) {

        write(subjects[current_subject].professor.name);
        write(aZaderjivaetsqE);
        timesheet[day_of_week][current_subject].to = time_of_day + 1;
    } else {
        write(subjects[current_subject].professor.name);
        write(aUxodit_);
        current_subject = -1;

    }

    wait_for_key();
}

let aUviPomiUjeZakr = 'Увы, ПОМИ уже закрыто, поэтому придется ехать домой...';
let aTiVPitereNaBal = 'Ты в Питере, на Балтийском вокзале.';
let aKudaNapravlqem = 'Куда направляемся?';
let aDomoiVPunk = 'Домой, в ПУНК!';
let aXocuVPomi = 'Хочу в ПОМИ!';
let aXorosoBiletEst = 'Хорошо, билет есть...';
let aTebqZalovili_2 = 'Тебя заловили контролеры!';
let aVisadiliVKra_2 = 'Высадили в Красных зорях, гады!';
let aKontroleriJi_3 = 'Контролеры жизни лишили.';
let aUfDoexal___ = 'Уф, доехал...';

function sub_173B6() {
    let var_1;

    ClrScr();
    if (time_of_day > 20) {
        TextColor(0x0E);
        writeln(aUviPomiUjeZakr);
        var_1 = 4;
    } else {
        show_header_stats();
        current_subject = -1;
        GotoXY(1, 0x0C);
        TextColor(0x0B);
        writeln(aTiVPitereNaBal);
        writeln(aKudaNapravlqem);
        show_short_today_timesheet(0x0C);
        dialog_start();
        dialog_case(aDomoiVPunk, -1);
        dialog_case(aXocuVPomi, -2);
        var_1 = dialog_run(1, 0x0F) == -1 ? 1 : 2;
    }

    if (var_1 == 1) {
        GotoXY(1, 0x14);
        if (hero.has_ticket) {
            writeln(aXorosoBiletEst);
        } else if (hero.charizma < Random(10)) {
            writeln(aTebqZalovili_2);
            writeln(aVisadiliVKra_2);
            decrease_health(10, aKontroleriJi_3);
            hour_pass();
            current_place = 1;
            wait_for_key();
            ClrScr();
        } else {
            writeln(aUfDoexal___);
        }
        hour_pass();
    }

    current_place = var_1;
}

let aVsemirnovPrini = 'Всемирнов принимает зачет даже в электричке!';
let aMucaesSq___ = 'Мучаешься ...';
let aZamucil = ' замучил';
let aA = 'а';
let a_ = '.';
let aTvoiMuceniqBil = 'Твои мучения были напрасны.';
let aTebeZacliEse = 'Тебе зачли еще ';

function sub_175A6() {
    let var_106;
    let var_6;
    let var_4;
    let var_2;

    ClrScr();
    show_header_stats();
    GotoXY(1, 0x0E);
    writeln(aVsemirnovPrini);
    TextColor(0x0D);
    writeln(aMucaesSq___);
    TextColor(7);
    writeln();

    var_6 = idiv((hero.subject[current_subject].knowledge - subjects[current_subject].member0xFA + Random(hero.brain)) * 3, 4);

    if (!jg(hero.health, 5)) {
        var_6 -= Random(5 - hero.health);
    }

    if (!jle(var_6, 0)) {
        var_6 = Round(Math.sqrt(var_6) / subjects[current_subject].member0x100);
    } else {
        var_6 = 0;
    }

    if (!jle(hero.subject[current_subject].tasks_done + var_6, subjects[current_subject].tasks)) {
        var_6 = subjects[current_subject].tasks - hero.subject[current_subject].tasks_done;
    }

    var_2 = Random(hero.stamina) - Random(subjects[current_subject].member0xFA);
    if (!jle(var_2, 0)) {
        var_2 = 0;
    }

    hero.subject[current_subject].knowledge += var_2;
    if (hero.subject[current_subject].knowledge < 0) {
        hero.subject[current_subject].knowledge = 0;
    }

    var_4 = Random(idiv(hero.stamina * 2, 3)) - subjects[current_subject].member0xFC;
    if (!jle(var_4, 0)) {
        var_4 = 0;
    }

    hero.health += var_4;
    if (hero.health <= 0) {
        is_end = 1;
        death_cause = subjects[current_subject].professor.name + aZamucil;
        if (!jnz(subjects[current_subject].professor.sex, 0)) {
            death_cause += aA;
        }
        death_cause += a_;
    } else {

        GotoXY(1, 0x15);

        if (var_6 == 0) {
            colored_output(0x0C, aTvoiMuceniqBil);
        } else {
            colored_output(10, aTebeZacliEse);
            colored_output_white(var_6);
            TextColor(10);
            zadanie_in_case(var_6);
            write('!');
            TextColor(7);
        }

        hero.subject[current_subject].tasks_done += var_6;
        wait_for_key();
        hour_pass();
    }

    sub_173B6();
}

let aM_a_Vsemirnov = 'М.А. Всемирнов :';
let aNetSegodnqQBol = '"Нет, сегодня я больше никому ничего не засчитаю..."';
let aUslisavAtuFraz = 'Услышав эту фразу, ты осознаешь беспочвенность своих мечтаний';
let aOSdaceZacetaPo = 'о сдаче зачета по алгебре в электричке.';
let aEstNadejdaCtoV = 'Есть надежда, что в электричке удастся что-то еще решить.';
let aPravdaZacetnoi = 'Правда, зачетной ведомости с собой туда не взять...';
let aDenegUTebqNe_2 = 'Денег у тебя нет, пришлось ехать зайцем...';
let aTebqZalovili_3 = 'Тебя заловили контролеры!';
let aVisadiliVKra_3 = 'Высадили в Красных зорях, гады!';
let aKontroleriJi_4 = 'Контролеры жизни лишили.';
let aExatZaicem_2 = 'Ехать зайцем';
let aCestnoZaplat_2 = 'Честно заплатить 10 руб. за билет в оба конца';
let aKontrolleriKon = 'Контроллеры, контроллеры, контроллеры...';
let aISoVsemirnovim = 'И со Всемирновым ты ничего не успел...';

function sub_17AA2() {
    ClrScr();
    show_header_stats();
    GotoXY(1, 0x0C);

    if (!jle(time_of_day, 0x14)) {
        TextColor(7);
        write(aM_a_Vsemirnov);
        TextColor(0x0F);
        writeln(aNetSegodnqQBol);
        TextColor(0x0E);
        writeln(aUslisavAtuFraz);
        writeln(aOSdaceZacetaPo);
        wait_for_key();
        current_subject = -1;
        return;
    }

    TextColor(7);
    writeln(aEstNadejdaCtoV);
    writeln(aPravdaZacetnoi);

    if (jl(hero.money, 10)) {
        TextColor(0x0C);
        writeln(aDenegUTebqNe_2);

        if (hero.charizma < Random(10)) {

            TextColor(0x0D);
            writeln(aTebqZalovili_3);
            writeln(aVisadiliVKra_3);
            decrease_health(10, aKontroleriJi_4);
            current_place = 1;
            wait_for_key();
            ClrScr();
        }

    } else {
        dialog_start();
        dialog_case(aExatZaicem_2, -1);
        dialog_case(aCestnoZaplat_2, -2);
        let ax = dialog_run(1, 0x11);

        if (ax == -1) {
            hero.has_ticket = 0;

            if (hero.charizma < Random(10)) {
                GotoXY(1, 0x15);
                TextColor(0x0D);
                writeln(aTebqZalovili_3);
                decrease_health(10, aKontrolleriKon);
                writeln(aISoVsemirnovim);
                wait_for_key();
                ClrScr();
            }
        } else if (ax == -2) {
            hero.money -= 0xA;
            hero.has_ticket = 1;
        }
    }

    wait_for_key();
    sub_175A6();
}

let aVseminovM_a_Ux = 'Всеминов М.А. уходит.';
let aPoitiZaNimNaAl = 'Пойти за ним на электричку?';
let aDaQXocuEsePomu = 'Да, я хочу еще помучаться';
let aNuUjNetSpasibo = 'Ну уж нет, спасибо!';

function sub_17D20() {
    ClrScr();
    show_header_stats();
    TextColor(0x0C);
    GotoXY(1, 0x0C);
    writeln(aVseminovM_a_Ux);

    if (current_place != 1 || hero.subject[Algebra].tasks_done >= subjects[Algebra].tasks) {
        current_subject = -1;
        wait_for_key();
    } else {
        writeln(aPoitiZaNimNaAl);
        dialog_start();
        dialog_case(aDaQXocuEsePomu, -1);
        dialog_case(aNuUjNetSpasibo, -2);
        show_short_today_timesheet(0x0C);
        let result = dialog_run(1, 0x0F);

        if (result == -2) {
            current_place = 1;
            current_subject = -1;
        } else if (result == -1) {
            sub_17AA2();
        }
    }
}

function sub_17DD3(arg_0) {
    if (arg_0 == 0) {
        sub_17D20();
    } else {
        sub_171C4();
    }
}

let aTvoqZacetkaPop = 'Твоя зачетка пополнилась еще одной записью.';

function sub_17E1A() {
    writeln();
    TextColor(10);
    writeln(aTvoqZacetkaPop);
    TextColor(7);
    wait_for_key();
    ClrScr();
    show_header_stats();
}

let aVsemirnovMedle = 'Всемирнов медленно рисует минус ...';
let aITakJeMedlenno = 'И так же медленно пририсовывает к нему вертикальную палочку!';
let aUfNuISutockiUN = 'Уф! Ну и шуточки у него!';
let aXorosoXotZacet = 'Хорошо хоть, зачет поставил...';
let aVsemirnovM_a_I = 'Всемирнов М.А. изничтожил.';

function sub_17F12() {
    ClrScr();
    show_header_stats();
    GotoXY(1, 8);
    writeln(aVsemirnovMedle);
    Delay(0x3E8);
    writeln(aITakJeMedlenno);
    writeln(aUfNuISutockiUN);
    writeln(aXorosoXotZacet);
    decrease_health(Random(6), aVsemirnovM_a_I);
    wait_for_key();
    ClrScr();
    show_header_stats();
}

function sub_17FAD(arg_2) {
    TextColor(Random(6) + 9);
    writeln(arg_2);
    TextColor(7);
}

let aVlasenkoN_p_ = 'Влащенко Н.П.:';
let aZakroiteGlaza_ = '"Закройте глаза ..."';
let aTiPoslusnoZakr = 'Ты послушно закрываешь глаза.';
let aOktroiteGlaza_ = '"Октройте глаза ..."';
let aTiVidisVlasenk = 'Ты видишь Влащенко Н.П. в костюме сказочной феи.';
let aVlasenkoN_p_Ka = 'Влащенко Н.П. касается тебя указкой (она же - волшебная палочка ...)';
let aTiCuvstvuesCto = 'Ты чувствуешь, что с тобой происходит что-то сверхъестественное.';
let aTebeSilNoPoplo = 'Тебе сильно поплохело.';
let aFeqBilaQvnoNeV = 'Фея была явно не в настроении.';
let aTiPocuvstvoval = 'Ты почувствовал себя где-то в другом месте.';
let aTiCuvstvuesC_0 = 'Ты чувствуешь, что подзабыл алгебру...';
let aTiCuvstvuesC_1 = 'Ты чувствуешь, что анализ придется учить заново.';
let aVGolovuPostoqn = 'В голову постоянно лезут мысли о всяких феях...';
let aTiCuvstvuesC_2 = 'Ты чувствуешь, что все вокруг жаждут твоей смерти.';
let aKudaToPodevala = 'Куда-то подевалась твоя уверенность в себе.';
let aGolovaStalaRab = 'Голова стала работать заметно лучше.';
let aTiProniksqLubo = 'Ты проникся любовью к окружающему миру.';
let aTiGotovKLubimI = 'Ты готов к любым испытаниям.';
let aPokaTvoiGlazaB = 'Пока твои глаза были закрыты, кто-то утащил твои деньги!!!';
let aTiNaselVSvoemK = 'Ты нашел в своем кармане какие-то деньги!';
let aTiCuvstvuesC_3 = 'Ты чувствуешь, что от тебя сильно несет чесноком.';
let aNeZnauVivetrit = 'Не знаю, выветрится ли такой сильный запах...';
let aStrannoeCuvstv = 'Странное чувство быстро прошло.';

function sub_183A0() {
    colored_output(7, aVlasenkoN_p_);
    colored_output_ln(0x0F, aZakroiteGlaza_);
    writeln(aTiPoslusnoZakr);
    Delay(0x3E8);
    colored_output_ln(0x0F, aOktroiteGlaza_);
    sub_17FAD(aTiVidisVlasenk);
    sub_17FAD(aVlasenkoN_p_Ka);
    sub_17FAD(aTiCuvstvuesCto);

    let ax = Random(0x0F);

    if (ax == 0) {
        sub_17FAD(aTebeSilNoPoplo);
        decrease_health(0x1E, aFeqBilaQvnoNeV);
    } else if (ax == 1) {
        sub_17FAD(aTiPocuvstvoval);
        current_place = 2;
        current_subject = -1;
    } else if (ax == 2) {
        hero.subject[Algebra].knowledge = idiv(hero.subject[Algebra].knowledge, 2);
        sub_17FAD(aTiCuvstvuesC_0);
    } else if (ax == 3) {
        hero.subject[Matan].knowledge = idiv(hero.subject[Matan].knowledge, 2);
        sub_17FAD(aTiCuvstvuesC_1);
    } else if (ax == 4) {
        hero.brain -= Random(2) + 1;
        sub_17FAD(aVGolovuPostoqn);
    } else if (ax == 5) {
        hero.charizma -= Random(2) + 1;
        sub_17FAD(aTiCuvstvuesC_2);
    } else if (ax == 6) {
        hero.stamina -= Random(2) + 1;
        sub_17FAD(aKudaToPodevala);
    } else if (ax == 7) {
        hero.brain += Random(3) + 1;
        sub_17FAD(aGolovaStalaRab);
    } else if (ax == 8) {
        hero.charizma += Random(3) + 1;
        sub_17FAD(aTiProniksqLubo);
    } else if (ax == 9) {
        hero.stamina += Random(3) + 1;
        sub_17FAD(aTiGotovKLubimI);
    } else if (ax == 0xA) {
        if (!jle(hero.money, 0)) {
            hero.money = 0;
            sub_17FAD(aPokaTvoiGlazaB);
        } else {
            hero.money = 0x14;
            sub_17FAD(aTiNaselVSvoemK);
        }
    } else if (ax == 0xB || ax == 0xC || ax == 0xD) {
        sub_17FAD(aTiCuvstvuesC_3);
        sub_17FAD(aNeZnauVivetrit);
        hero.garlic = Random(4) + 1;
        hero.charizma -= idiv(hero.garlic, 2);
    } else if (ax == 0xE) {
        sub_17FAD(aStrannoeCuvstv);
    }

    wait_for_key();
    ClrScr();
    show_header_stats();

}

function sub_185C9(arg_0) {
    if (arg_0 == 4) {
        sub_183A0();
    } else if (arg_0 == 0) {
        sub_17F12();
    } else {
        sub_17E1A();
    }
}

let aMucaesSq____0 = 'Мучаешься ...';
let aPodkoritov = 'Подкорытов:';
let aCegoToQNePonim = '"Чего-то я не понимаю... Похоже, Вы меня лечите..."';
let aTvoiMuceniqB_0 = 'Твои мучения были напрасны.';
let aTebeZacliEse_0 = 'Тебе зачли еще ';
let aZamucil_0 = ' замучил';
let aA_0 = 'а';
let a__0 = '.';

function sub_18677() {
    GotoXY(1, 0x14);
    TextColor(0x0D);
    writeln(aMucaesSq____0);
    TextColor(7);
    writeln();

    let bp_var_4 = hero.subject[current_subject].knowledge - subjects[current_subject].member0xFA + Random(hero.brain);
    if (!jg(hero.health, 5)) {
        bp_var_4 -= Random(5 - hero.health);
    }

    if (!jle(bp_var_4, 0)) {
        bp_var_4 = Round(Math.sqrt(bp_var_4) / subjects[current_subject].member0x100);
    } else {
        bp_var_4 = 0;
    }

    if (!jle(hero.subject[current_subject].tasks_done + bp_var_4, subjects[current_subject].tasks)) {
        bp_var_4 = subjects[current_subject].tasks - hero.subject[current_subject].tasks_done;
    }

    let var_4 = Random(hero.stamina) - Random(subjects[current_subject].member0xFA);
    if (!jle(var_4, 0)) {
        var_4 = 0;
    }

    hero.subject[current_subject].knowledge += var_4;
    if (hero.subject[current_subject].knowledge < 0) {
        hero.subject[current_subject].knowledge = 0;
    }

    if (!jnz(current_subject, 2) && !jge(hero.charizma * 2 + 0x1A, hero.subject[current_subject].knowledge)) {
        GotoXY(1, 0x14);
        TextColor(7);
        write(aPodkoritov);
        TextColor(0x0F);
        writeln(aCegoToQNePonim);
        bp_var_4 = 0;
    }

    GotoXY(1, 0x15);
    if (!jnz(bp_var_4, 0)) {
        colored_output(0x0C, aTvoiMuceniqB_0);
    } else {
        colored_output(10, aTebeZacliEse_0);
        colored_output_white(bp_var_4);
        TextColor(10);
        zadanie_in_case(bp_var_4);
        write('!');
        TextColor(7);
    }


    hero.subject[current_subject].tasks_done += bp_var_4;
    let var_2 = Random(hero.stamina) - subjects[current_subject].member0xFC;

    if (var_2 > 0) {
        var_2 = 0;
    }

    hero.health += var_2;
    if (jle(hero.health, 0)) {
        is_end = 1;
        death_cause = subjects[current_subject].professor.name + aZamucil_0;
        if (!jnz(subjects[current_subject].professor.sex, 0)) {
            death_cause += aA_0;
        }
        death_cause += a__0;
    }

    hour_pass();
    wait_for_key();

}

let aUVasVseZacteno = 'У вас все зачтено, можете быть свободны.';
let aSeicasTebqIstq = 'Сейчас тебя истязает ';
let aKromeTebqZdesE = 'Кроме тебя, здесь еще сид';
let aIt = 'ит ';
let aQt = 'ят ';
let aI = ' и ';
let asc_18A07 = ', ';
let aUTebqEseNicego = 'У тебя еще ничего не зачтено.';
let aZacteno = 'Зачтено ';
let aZadacIz = ' задач из ';
let aUTebqUjeVseZac = 'У тебя уже все зачтено.';
let aMucatSqDalSe = 'Мучаться дальше';
let aBrositAtoDelo = 'Бросить это дело';

function scene_exam() {
    let var_15;
    let var_14;
    let var_12 = [];
    let var_6;
    let var_2;

    last_subject = current_subject;

    var_15 = 0;
    for (var_2 = 0; var_2 <= 0xB; ++var_2) {
        // #warning
        var_12.push(0);
    }
    var_14 = 0;


    if (!jnz(current_subject, -1)) {
        return;
    }

    if (jle(hero.health, 0) || is_end != 0) {
        return;
    }

    ClrScr();
    show_header_stats();

    if (!jl(hero.subject[current_subject].tasks_done, subjects[current_subject].tasks)) {

        writeln();
        TextColor(10);
        writeln(aUVasVseZacteno);
        TextColor(7);

        if (hero.subject[current_subject].passed == 0) {
            hero.subject[current_subject].pass_day = day_of_week;
            hero.subject[current_subject].passed = 1;
            --hero.exams_left;

            writeln();
            sub_185C9(current_subject);

            if (!jnz(current_subject, -1)) {
                return;
            }

            if (is_end != 0) {
                return;
            }
        }

    }

    if (!jg(timesheet[day_of_week][current_subject].to, time_of_day)) {
        sub_17DD3(current_subject);
        return;
    }

    GotoXY(1, 8);
    TextColor(0x0E);
    write(aSeicasTebqIstq);
    write(subjects[current_subject].professor.name);
    writeln('.');

    let var_4 = 0;
    for (var_2 = 0; var_2 <= 0xB; ++var_2) {
        if (classmates[var_2].current_subject === current_subject || !jnz(current_place, 3)) {
            if (!jnz(classmates[var_2].place, current_place)) {
                if (!jnb(var_2, 0x10)) {
                    var_6 |= 1 << var_2;
                }
                ++var_4;
            }
        }
    }

    if (jg(var_4, 0)) {

        TextColor(7);
        write(aKromeTebqZdesE);

        if (!jnz(var_4, 1)) {
            write(aIt);
        } else if (!jle(var_4, 1)) {
            write(aQt);
        }

        for (var_2 = 0; var_2 <= 0xB; ++var_2) {

            if (jb(var_2, 0x10)) {
                if (var_6 & (1 << var_2)) {

                    write(classmate_names[var_2]);

                    --var_4;

                    if (!jbe(WhereY(), 0x46)) {
                        writeln();
                    }

                    if (!jnz(var_4, 0)) {
                        writeln('.');
                    } else if (!jnz(var_4, 1)) {
                        write(aI);
                    } else {
                        write(asc_18A07);
                    }
                }
            }
        }
    }

    var_15 = 1;
    do {

        if (!jg(idiv(hero.charizma, 2), var_14)) {
            break;
        }

        if (!jle(var_14, 3)) {
            break;
        }

        for (var_2 = 0; var_2 <= 0xB; ++var_2) {

            if (var_12[var_2] === 0) {
                if (classmates[var_2].member0x32C - idiv(var_14, 2) - hero.garlic > Random(10)) {
                    if (!jnb(var_2, 0x10)) {
                        if (var_6 & (1 << var_2)) {
                            if (!jle(idiv(hero.charizma, 2), var_14)) {

                                var_12[var_2] = 1;

                                ++var_14;
                                sub_18FB2(var_2);

                                if (!jg(timesheet[day_of_week][current_subject].to, time_of_day)) {
                                    sub_17DD3(current_subject);
                                    return;
                                } else {
                                    check_exams_left_count();
                                    if (is_end !== 0) {
                                        return;
                                    } else {
                                        ClrScr();
                                        show_header_stats();
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    } while (jnz(Random(2), 0));


    GotoXY(1, 7);

    if (!jnz(hero.subject[current_subject].tasks_done, 0)) {
        colored_output_ln(7, aUTebqEseNicego);
    } else {
        if (!jge(hero.subject[current_subject].tasks_done, subjects[current_subject].tasks)) {
            colored_output(7, aZacteno);
            colored_output_white(hero.subject[current_subject].tasks_done);
            colored_output(7, aZadacIz);
            colored_output_white(subjects[current_subject].tasks);
            writeln();
        } else {
            colored_output_ln(10, aUTebqUjeVseZac);
        }
    }

    dialog_start();
    if (!jnz(hero.subject[current_subject].passed, 0)) {
        dialog_case(aMucatSqDalSe, -1);
    }

    for (var_2 = 0; var_2 <= 0xB; ++var_2) {
        if (!jnb(var_2, 0x10)) {
            if (var_6 & (1 << var_2)) {
                dialog_case_colored(classmate_names[var_2], var_2, 0xE);
            }
        }
    }

    dialog_case(aBrositAtoDelo, -2);
    show_short_today_timesheet(0x0C);
    var_2 = dialog_run(1, 0x0C);
    if (var_2 == -1) {
        sub_18677();
    } else if (var_2 == -2) {
        current_subject = -1;
    } else if (!jl(var_2, 0) && !jg(var_2, 0xB)) {
        talk_with_classmate(var_2);
    }
}

let aKTebePristaet = 'К тебе пристает ';
let a_CtoBudesDelat = '. Что будешь делать?';
let aPitatSqIgnorir = 'Пытаться игнорировать';
let aTebeKakToNexor = 'Тебе как-то нехорошо ...';
let aLucseIgnorirov = ' лучше игнорировать не надо.';

function sub_18FB2(arg_0) {
    let var_104;
    let var_4;
    let var_1;

    if (!(!jnz(arg_0, 3) && !jnz(current_place, 3))) {
        writeln();
        write(aKTebePristaet);
        write(classmate_names[arg_0]);

        writeln(a_CtoBudesDelat);

        dialog_start();
        dialog_case(aPitatSqIgnorir, -1);
        dialog_case(classmate_names[arg_0], -2);

        var_4 = WhereY() + 2;
        show_short_today_timesheet(var_4);
        let res = dialog_run(1, var_4);

        if (res == -1) {
            if (classmates[arg_0].member0x344 > 0) {
                GotoXY(1, 0x16);
                writeln(aTebeKakToNexor);
                decrease_health(classmates[arg_0].member0x344, classmate_names[arg_0] + aLucseIgnorirov);
            }

            var_1 = 0;
            wait_for_key();
            ClrScr();
        } else if (res == -2) {
            var_1 = 1;
            talk_with_classmate(arg_0);
        }

    }

    return var_1;
}

let aKolqSmotritNaT = 'Коля смотрит на тебя немного окосевшими глазами.';
let aUTebqOstalisNe = '"У тебя остались нерешенные задачи по Всемирнову? Давай сюда!"';
let aKolqResilTebeE = 'Коля решил тебе еще ';
let aZadaciPoAlgebr = ' задачи по алгебре!';
let aZnaesPivoKonec = '"Знаешь, пиво, конечно, хорошо, но настойка овса - лучше!"';
let aZakazatKoleNas = 'Заказать Коле настойку овса?';
let aDa = 'Да';
let aNet = 'Нет';
let aTvoiAlTruizmNa = 'Твой альтруизм навсегда останется в памяти потомков.';
let aZrqOiZrq___ = '"Зря, ой, зря ..."';
let aKolqDostaetTor = 'Коля достает тормозную жидкость, и вы распиваете еще по стакану.';
let aSpilsq_ = 'Спился.';

function sub_19259() {
    ClrScr();
    show_header_stats();
    GotoXY(1, 8);
    writeln(aKolqSmotritNaT);

    if (hero.charizma > Random(10) && subjects[Algebra].tasks - 2 >= hero.subject[Algebra].tasks_done) {
        current_color = 0x0F;
        writeln(aUTebqOstalisNe);
        hero.subject[Algebra].tasks_done += 2;
        output_with_highlighted_num(7, aKolqResilTebeE, 0x0F, 2, aZadaciPoAlgebr);
        wait_for_key();
        ClrScr();
        hour_pass();
        return;
    }

    current_color = 0x0F;
    writeln(aZnaesPivoKonec);

    if (hero.money <= 0x0F) {
        GotoXY(1, 0x0F);
        current_color = 0x0D;
        writeln(aKolqDostaetTor);
        --hero.brain;

        if (hero.brain <= 0) {
            hero.health = 0;
            is_end = 1;
            death_cause = aSpilsq_;
        }

    } else {

        current_color = 7;
        writeln(aZakazatKoleNas);
        dialog_start();
        dialog_case(aDa, -1);
        dialog_case(aNet, -2);
        show_short_today_timesheet(0x0C);
        let res = dialog_run(1, 0x0F);

        if (res == -1) {
            hero.money -= 0xF;
            GotoXY(1, 0x13);

            if (hero.charizma > Random(10) && hero.subject[Algebra].tasks_done + 1 < subjects[Algebra].tasks) {
                current_color = 0x0F;
                writeln(aUTebqOstalisNe);
                hero.subject[Algebra].tasks_done += 2;
                output_with_highlighted_num(7, aKolqResilTebeE, 0x0F, 2, aZadaciPoAlgebr);
                wait_for_key();
                ClrScr();
                hour_pass();
                return;
            } else {
                current_color = 7;
                writeln(aTvoiAlTruizmNa);
            }

        } else if (res == -2) {
            GotoXY(1, 0x13);
            current_color = 0x0F;
            writeln(aZrqOiZrq___);
            current_color = 0x0D;
            writeln(aKolqDostaetTor);
            --hero.brain;
            wait_for_key();
            ClrScr();
            return;
        }

    }

    wait_for_key();
    ClrScr();
}

let aWowTiTolKoCtoV = 'Wow! Ты только что встретил автора !';
let aDiamond_0 = 'Diamond:';
let aKolqPomojetSAl = '"Коля поможет с алгеброй."';
let aMisaRasskajetV = '"Миша расскажет всем, какой ты хороший."';
let aPasaTvoiStaros = '"Паша - твой староста."';
let aSDjugomLucseNe = '"С DJuGом лучше не сталкиваться."';
let aRaiNeOtstanetL = '"RAI не отстанет, лучше решить ему чего-нибудь."';
let aKolqVseVremqSi = '"Коля все время сидит в мавзолее и оттягивается."';
let aSlediZaSvoimZd = '"Следи за своим здоровьем!!!"';
let aEsliVstretisSa = '"Если встретишь Сашу - ОБЯЗАТЕЛЬНО заговори с ним."';
let aEsliPloxoDumae = '"Если плохо думается, попробуй поговорить с RAI."';
let aIdqKKoleBudUve = '"Идя к Коле, будь уверен, что можешь пить с ним."';
let aPolucaqZacetPo = '"Получая зачет по английскому, будь готов к неожиданностям."';
let aInogdaRazgovor = '"Иногда разговоры с Сержем приносят ощутимую пользу."';
let aAndruMojetPomo = '"Эндрю может помочь, но не всегда..."';
let aKuzMenkoInogda = '"Кузьменко иногда знает о Климове больше, чем сам Климов."';
let aNeSpesiSlatGne = '"Не спеши слать гневные письма о багах:';
let aZaglqniNaMmher = 'загляни на mmheroes.chat.ru,';
let aMojetBitVseUje = 'может быть, все уже в порядке!"';
let aSerjTojeInogda = '"Серж тоже иногда забегает в мавзолей."';
let aNePereuciTopol = '"Не переучи топологию, а то Подкорытов-младший не поймет."';
let aMojesUstroitSq = '"Можешь устроиться в ТЕРКОМ по знакомству."';
let aGrisaRabotaetV = '"Гриша работает ( ;*) ) в ТЕРКОМе."';
let aVTerkomeMojnoZ = '"В ТЕРКОМЕ можно заработать какие-то деньги."';
let aGrisaInogdaBiv = '"Гриша иногда бывает в Мавзолее."';
let aNeNravitsqRasp = '"Не нравится расписание? Подумай о чем-нибудь парадоксальном."';
let aNilDaetDenGiZa = '"NiL дает деньги за помощь, но..."';
let aCestnoNeZnauKo = '"Честно, не знаю, когда будет готов порт под Linux..."';
let aSrocnoNujniNov = '"Срочно! Нужны новые фишки для "Зачетной недели" !"';
let aPojelaniqIdeiB = '"Пожелания, идеи, bug report\'ы шлите на mmheroes@chat.ru !"';
let aVstretisKostuB = '"Встретишь Костю Буленкова - передай ему большой привет!"';
let aBolSoeSpasiboV = '"Большое спасибо Ване Павлику за mmheroes.chat.ru !"';
let aDiamondUbegaet = 'Diamond убегает по своим делам ...';
let aXocesPoTestitN = '"Хочешь по-тестить новую версию Heroes of MAT-MEX?"';
let aDaKonecnoOcenX = 'ДА, КОНЕЧНО, ОЧЕНЬ ХОЧУ!';
let aNetUMenqNetNaA = 'Нет, у меня нет на это времени...';
let aNuILaduskiVotT = '"Ну и ладушки! Вот тебе дискетка..."';
let aIzviniCtoPobes = '"Извини, что побеспокоил."';

function sub_19B20() {
    ClrScr();
    show_header_stats();
    GotoXY(1, 8);
    current_color = 0x0E;
    writeln(aWowTiTolKoCtoV);
    writeln();
    write(aDiamond_0);

    if (hero.has_mmheroes_disk == 0 && current_place == 3 && !ja(Random(8), 0)) {
        writeln(aXocesPoTestitN);
        dialog_start();
        dialog_case(aDaKonecnoOcenX, -1);
        dialog_case(aNetUMenqNetNaA, -2);
        show_short_today_timesheet(0x0C);
        let res = dialog_run(1, 0x0C);
        if (res == -1) {
            GotoXY(1, 0x10);
            writeln(aNuILaduskiVotT);
            hero.has_mmheroes_disk = 1;
            wait_for_key();
        } else if (res == -2) {
            GotoXY(1, 0x10);
            writeln(aIzviniCtoPobes);
            wait_for_key();
        }
        return;
    }

    current_color = 0x0F;
    writeln([aKolqPomojetSAl, aMisaRasskajetV, aPasaTvoiStaros, aSDjugomLucseNe, aRaiNeOtstanetL, aKolqVseVremqSi, aSlediZaSvoimZd, aEsliVstretisSa, aEsliPloxoDumae, aIdqKKoleBudUve, aPolucaqZacetPo, aInogdaRazgovor, aAndruMojetPomo, aKuzMenkoInogda, aNeSpesiSlatGne + '\n' + aZaglqniNaMmher + '\n' + aMojetBitVseUje, aSerjTojeInogda, aNePereuciTopol, aMojesUstroitSq, aGrisaRabotaetV, aVTerkomeMojnoZ, aGrisaInogdaBiv, aNeNravitsqRasp, aNilDaetDenGiZa, aCestnoNeZnauKo, aSrocnoNujniNov, aPojelaniqIdeiB, aVstretisKostuB, aBolSoeSpasiboV][Random(0x1C)]);
    current_color = 7;

    if (current_subject == -1) {
        if (Random(2) == 0) {
            writeln(aDiamondUbegaet);
            classmates[Diamond].place = 0;
            classmates[Diamond].current_subject = -1;
        }
    }

    wait_for_key();
}

let aRai_0 = 'RAI:';
let aTiMnePomojes = '"Ты мне поможешь?"';
let aDaKonecno = '"Да, конечно"';
let aNetIzvini___ = '"Нет, извини..."';
let aTiPomogRai_ = 'Ты помог RAI.';
let aNicegoNeVislo_ = 'Ничего не вышло.';
let aAxTakPolucaiPo = '"Ах, так! Получай! Получай!"';
let aRaiDelaetTebeB = 'RAI делает тебе больно ...';
let aRaiZamocil_ = 'RAI замочил.';
let aRaiNeReagiruet = 'RAI не реагирует на твои позывы.';

function sub_1A0A2() {
    if (current_subject >= 3 || current_subject == -1) {
        ClrScr();
        show_header_stats();
        GotoXY(1, 8);
        writeln(aRaiNeReagiruet);
    } else {

        dialog_start();
        ClrScr();
        show_header_stats();
        TextColor(7);
        GotoXY(1, 10);
        write(aRai_0);
        TextColor(0x0F);
        write(aTiMnePomojes);
        dialog_case(aDaKonecno, 1);
        dialog_case(aNetIzvini___, 2);
        show_short_today_timesheet(0x0C);
        let ax = dialog_run(1, 0x0C);

        if (ax == 1) {
            GotoXY(1, 0x0F);

            if (!jbe(Random(hero.subject[current_subject].knowledge), Random(subjects[current_subject].member0xFA))) {
                TextColor(10);
                writeln(aTiPomogRai_);
                ++hero.brain;
                TextColor(7);
            } else {
                writeln(aNicegoNeVislo_);
            }
            hour_pass();
        } else if (ax == 2) {
            GotoXY(1, 0x0F);
            TextColor(0x0D);
            writeln(aAxTakPolucaiPo);
            TextColor(7);
            writeln(aRaiDelaetTebeB);
            decrease_health(10, aRaiZamocil_);
        }

    }

    wait_for_key();
    ClrScr();
}

let aMisa_0 = 'Миша : ';
let aSlusaiXvatitMu = '"Слушай, хватит мучаться! Прервись!';
let aDavaiVKlopodav = 'Давай в клоподавку сыграем!"';
let aDavai = '"Давай!"';
let aNetNeBuduQVKlo = '"Нет, не буду я в клоподавку ..."';
let aTiSigralSMisei = 'Ты сыграл с Мишей партию в клоподавку.';
let aZrqOcenZrq = '"Зря, очень зря!"';
let aSlusaiAVedVTer = '"Слушай, а ведь в ТЕРКОМе есть столик для тенниса. Сыграем?"';
let aObqzatelNo = '"Обязательно!"';
let aIzviniPotom_ = '"Извини, потом."';
let aTiSigralSMis_0 = 'Ты сыграл с Мишей в теннис.';
let aZagonqlTebqMis = 'Загонял тебя Миша.';
let aNicegoQNaTebqN = '"Ничего, я на тебя не в обиде."';
let aMisa_1 = 'Миша:';
let aAxJalNegdeSigr = '"Эх, жаль, негде сыграть в клоподавку!"';
let aVsegdaSlediZaZ = '"Всегда следи за здоровьем!"';
let aMozgiVliqutNaP = '"Мозги влияют на подготовку и сдачу зачетов."';
let aCemBolSeVinosl = '"Чем больше выносливость, тем меньше здоровья ты тратишь."';
let aCemBolSeTvoqXa = '"Чем больше твоя харизма, тем лучше у тебя отношения с людьми."';
let aVajnostKonkret = '"Важность конкретного качества сильно зависит от стиля игры."';
let aXarizmaPomogae = '"Харизма помогает получить что угодно от кого угодно."';
let aCemBolSeXarizm = '"Чем больше харизма, тем чаще к тебе пристают."';
let aCemMenSeVinosl = '"Чем меньше выносливость, тем больнее учиться."';
let aCemBolSeMozgiT = '"Чем больше мозги, тем легче готовиться."';
let aSidenieVInetEI = '"Сидение в Inet\'e иногда развивает мозги."';
let aEsliTebeNadoel = '"Если тебе надоело умирать - попробуй другую стратегию."';
let aXocesXalqviNab = '"Хочешь халявы - набирай харизму."';
let aXocesDobitSqVs = '"Хочешь добиться всего сам - развивай мозги."';
let aVMavzoleeVajno = '"В "Мавзолее" важно знать меру..."';
let aOtRazdvoeniqLi = '"От раздвоения личности спасают харизма и выносливость."';
let aOtLubogoObseni = '"От любого общения с NiL ты тупеешь!"';
let aGrisaMojetPomo = '"Гриша может помочь с трудоустройством."';
let aPeremeseniqStu = '"Перемещения студентов предсказуемы."';

function sub_1A70A() {
    ClrScr();
    show_header_stats();

    if (!(current_place == 3 || current_subject == -1)) {
        GotoXY(1, 8);
        TextColor(7);
        write(aMisa_0);
        TextColor(0x0F);
        writeln(aSlusaiXvatitMu);
        writeln(aDavaiVKlopodav);
        dialog_start();
        dialog_case(aDavai, 1);
        dialog_case(aNetNeBuduQVKlo, 2);
        let res = dialog_run(1, 0x0C);

        if (res == 1) {
            GotoXY(1, 0x0F);
            TextColor(10);
            writeln(aTiSigralSMisei);
            TextColor(7);
            ++hero.charizma;
            wait_for_key();
            ClrScr();
            hour_pass();
        } else if (res == 2) {
            GotoXY(1, 0x0F);
            TextColor(0x0F);
            writeln(aZrqOcenZrq);
            hero.charizma -= Random(2);
            wait_for_key();
            TextColor(7);
            ClrScr();
        }
        return;

    }

    if (current_place == 1 && current_subject == -1 && hero.is_working_in_terkom) {

        if (hero.charizma > Random(8)) {

            GotoXY(1, 8);
            TextColor(7);
            write(aMisa_0);
            TextColor(0x0F);
            writeln(aSlusaiAVedVTer);
            dialog_start();
            dialog_case(aObqzatelNo, 1);
            dialog_case(aIzviniPotom_, 2);
            let res = dialog_run(1, 0x0C);

            if (res == 1) {
                GotoXY(1, 0x0F);
                TextColor(10);
                writeln(aTiSigralSMis_0);
                TextColor(7);
                ++hero.charizma;

                if (hero.charizma < Random(10)) {
                    decrease_health(Random(3) + 3, aZagonqlTebqMis);
                } else {
                    wait_for_key();
                    ClrScr();
                    hour_pass();
                }

            } else if (res == 2) {
                GotoXY(1, 0x0F);
                TextColor(0x0F);
                writeln(aNicegoQNaTebqN);
                wait_for_key();
                TextColor(7);
                ClrScr();
            }

            return;
        }
    }


    GotoXY(1, 8);
    TextColor(7);
    write(aMisa_1);
    TextColor(0x0F);

    write([
        aAxJalNegdeSigr,
        aVsegdaSlediZaZ,
        aMozgiVliqutNaP,
        aCemBolSeVinosl,
        aCemBolSeTvoqXa,
        aVajnostKonkret,
        aXarizmaPomogae,
        aCemBolSeXarizm,
        aCemMenSeVinosl,
        aCemBolSeMozgiT,
        aSidenieVInetEI,
        aEsliTebeNadoel,
        aXocesXalqviNab,
        aXocesDobitSqVs,
        aVMavzoleeVajno,
        aOtRazdvoeniqLi,
        aOtLubogoObseni,
        aGrisaMojetPomo,
        aPeremeseniqStu
    ][Random(0x13)]);

    wait_for_key();
    ClrScr();
}

let aSerj_0 = 'Серж: ';
let aNaGlotniKefirc = '"На, глотни кефирчику."';
let aQZnauGdeSrezat = '"Я знаю, где срезать в парке на физ-ре!"';
let aPomnitsqKogdaT = '"Помнится, когда-то была еще графическая версия mmHeroes..."';
let aQBilBetaTester = '"Я был бета-тестером первой версии mmHeroes (тогда еще CRWMM19)!"';
let aKakZdorovoCtoD = '"Как здорово, что Diamond написал новую версию!"';
let aTiUjePolucilDe = '"Ты уже получил деньги у Паши?"';
let aPoprobuiDlqNac = '"Попробуй для начала легкие зачеты."';
let aTiEseNePolucil = '"Ты еще не получил зачет по английскому?"';
let aXocesOtdixatGd = '"Хочешь отдыхать, где угодно? Заимей деньги!"';
let aNeVDenGaxScast = '"Не в деньгах счастье. Но они действуют успокаивающе."';
let aNaVsemirnoveVs = '"На Всемирнове всегда толпа народу."';
let aVlasenkoDamaVe = '"Влащенко - дама весьма оригинальная."';
let aInteresnoKogda = '"Интересно, когда будет готова следующая версия?"';
let aZdorovEVKafePo = '"Здоровье в кафе повышается в зависимости от наличия денег."';
let aEsliBiQZnalAdr = '"Если бы я знал адрес хорошего proxy..."';
let aStarVremennoNa = '"STAR временно накрылся. Хорошо бы узнать адрес другого proxy..."';
let aQPodozrevauCto = '"Я подозреваю, что Гриша знает адресок теркомовского proxy."';
let aADiamondVseSvo = '"А Diamond все свободное время дописывает свою игрушку!"';
let aVSleduusemSeme = '"В следующем семестре информатику будет вести Терехов-младший."';
let aDiamondXocetPe = '"Diamond хочет переписать это все на Java."';
let aMisaProkonsulT = '"Миша проконсультирует тебя о стратегии."';
let aPogovoriSDiamo = '"Поговори с Diamond\'ом, он много ценного скажет."';
let aBorisDoKonca = '"Борись до конца!"';
let aUDubcovaInogda = '"У Дубцова иногда бывает халява."';
let aSerjUxoditKuda = 'Серж уходит куда-то по своим делам ...';

function sub_1B09A() {
    ClrScr();
    show_header_stats();
    GotoXY(1, 8);
    TextColor(7);
    write(aSerj_0);
    TextColor(0x0F);

    if (!(!ja(Random(hero.charizma), Random(3) + 2)) && !jle(hero.charizma * 2 + 20, hero.health)) {

        writeln(aNaGlotniKefirc);
        hero.health += hero.charizma + Random(hero.charizma);

        if (current_subject !== -1) {
            if (hero.subject[current_subject].knowledge > 3) {
                hero.subject[current_subject].knowledge -= Random(3);
            }
        }

    } else {

        if (Random(hero.charizma) > Random(6) + 2 && hero.subject[Fizra].knowledge < 10) {
            writeln(aQZnauGdeSrezat);
            hero.subject[Fizra].knowledge += 30;
        } else {
            let ax = Random(22);
            writeln([
                aPomnitsqKogdaT,
                aQBilBetaTester,
                aKakZdorovoCtoD,
                aTiUjePolucilDe,
                aPoprobuiDlqNac,
                aTiEseNePolucil,
                aXocesOtdixatGd,
                aNeVDenGaxScast,
                aNaVsemirnoveVs,
                aVlasenkoDamaVe,
                aInteresnoKogda,
                aZdorovEVKafePo,
                aEsliBiQZnalAdr,
                aStarVremennoNa,
                aQPodozrevauCto,
                aADiamondVseSvo,
                aVSleduusemSeme,
                aDiamondXocetPe,
                aMisaProkonsulT,
                aPogovoriSDiamo,
                aBorisDoKonca,
                aUDubcovaInogda
            ][ax]);
        }

    }

    if (hero.charizma < Random(9)) {
        TextColor(7);
        writeln(aSerjUxoditKuda);
        classmates[Serzg].current_subject = -1;
        if (!jnz(classmates[Serzg].place, 5)) {
            classmates[Serzg].place = 0;
        } else {
            classmates[Serzg].place = 5;
        }
    }

    wait_for_key();
    TextColor(7);
    ClrScr();
}

let aPasaVrucaetTeb = 'Паша вручает тебе твою стипуху за май: ';
let aRub__2 = ' руб.';
let aPasaVoodusevlq = 'Паша воодушевляет тебя на великие дела.';
let aVmesteSAtimOnN = 'Вместе с этим он немного достает тебя.';

function sub_1B526() {
    ClrScr();
    show_header_stats();

    if (!jnz(hero.got_stipend, 0)) {
        hero.got_stipend = 1
        GotoXY(1, 8);
        output_with_highlighted_num(7, aPasaVrucaetTeb, 0x0F, 0x32, aRub__2);
        hero.money += 0x32;
    } else {
        GotoXY(1, 8);
        TextColor(10);
        writeln(aPasaVoodusevlq);
        TextColor(0x0C);
        writeln(aVmesteSAtimOnN);
        ++hero.stamina;

        for (let var_2 = 0; var_2 <= 5; ++var_2) {
            if (hero.subject[var_2].knowledge > 3) {
                hero.subject[var_2].knowledge -= Random(3);
            }
        }

    }

    wait_for_key();
    ClrScr();

}

let aTiVstretilSasu = 'Ты встретил Сашу! Говорят, у него классные конспекты ...';
let aNicegoNeNado = 'Ничего не надо';
let aCegoTebeNadoOt = 'Чего тебе надо от Саши?';
let aKakZnaes___ = 'Как знаешь...';
let aSasa_1 = 'Саша:';
let aDaUMenqSSoboiA = '"Да, у меня с собой этот конспект ..."';
let aOxIzviniKtoToD = '"Ох, извини, кто-то другой уже позаимствовал ..."';

function sub_1B6B7() {
    let var_2;

    ClrScr();
    show_header_stats();
    GotoXY(1, 8);
    TextColor(0x0E);
    writeln(aTiVstretilSasu);
    dialog_start();

    for (var_2 = 0; var_2 <= 2; ++var_2) {
        if (synopsis[var_2].hero_has == 0) {
            dialog_case(subjects[var_2].title, var_2);
        }
    }

    dialog_case(aNicegoNeNado, -1);
    GotoXY(1, 9);
    writeln(aCegoTebeNadoOt);
    var_2 = dialog_run(1, 0x0B);

    if (!jnz(var_2, -1)) {
        GotoXY(1, 0x0F);
        writeln(aKakZnaes___);
    } else {
        if (hero.charizma > Random(0x12) && synopsis[var_2].sasha_has !== 0) {
            GotoXY(1, 0x0F);
            TextColor(7);
            write(aSasa_1);
            TextColor(0x0F);
            writeln(aDaUMenqSSoboiA);
            synopsis[var_2].hero_has = 1;
            byte_2549F = 0;
        } else {
            GotoXY(1, 0x0F);
            TextColor(7);
            write(aSasa_1);
            TextColor(0x0F);
            writeln(aOxIzviniKtoToD);
            synopsis[var_2].sasha_has = 0;
        }
    }

    wait_for_key();
    ClrScr();
}

let aMaladoiCilavek = '"Маладой чилавек, вы мне не паможите решить задачу?';
let aAToQSigodnqNiV = 'А то я сигодня ни в зуб нагой ..."';
let aDaKonecno_0 = '"Да, конечно"';
let aIzviniVDrugoiR = '"Извини, в другой раз"';
let aOiSpasiboVotVa = '"Ой, спасибо! Вот вам ';
let aRub_ZaAto___ = ' руб. за это..."';
let aAlTruizmNeDove = 'Альтруизм не довел до добра.';
let aUTebqNicegoNeV = 'У тебя ничего не вышло.';
let aTiZavodisSNilS = 'Ты заводишь с NiL светскую беседу.';
let aTebePoploxelo_ = 'Тебе поплохело.';
let aObsenieSNilOka = 'Общение с NiL оказалось выше человеческих сил.';

function sub_1B986() {
    ClrScr();
    show_header_stats();

    if (!jnz(current_subject, -1)) {
        GotoXY(1, 8);
        TextColor(7);
        writeln(aTiZavodisSNilS);
        TextColor(0x0D);
        writeln(aTebePoploxelo_);
        decrease_health(10, aObsenieSNilOka);
    } else {
        GotoXY(1, 8);
        TextColor(0x0B);
        writeln(aMaladoiCilavek);
        writeln(aAToQSigodnqNiV);
        dialog_start();
        dialog_case(aDaKonecno_0, -1);
        dialog_case(aIzviniVDrugoiR, -2);
        let ax = dialog_run(1, 0x0B);

        if (ax == -1) {

            if (jg(hero.subject[current_subject].knowledge, subjects[current_subject].member0xFA)) {

                GotoXY(1, 0x0E);
                TextColor(0x0E);
                write(aOiSpasiboVotVa);
                write(hero.subject[current_subject].knowledge);
                writeln(aRub_ZaAto___);

                hero.money += hero.subject[current_subject].knowledge;
                hero.health -= subjects[current_subject].member0xFC;

                hero.subject[current_subject].knowledge -= subjects[current_subject].member0x100 + Random(subjects[current_subject].member0xFC);

                if (!jg(hero.health, 0)) {
                    is_end = 1;
                    death_cause = aAlTruizmNeDove;
                }

                hour_pass();

            } else {

                GotoXY(1, 0x0E);
                TextColor(0x0D);
                writeln(aUTebqNicegoNeV);
                hour_pass();
                hero.health -= subjects[current_subject].member0xFC;
                if (!jg(hero.health, 0)) {
                    is_end = 1;
                    death_cause = aAlTruizmNeDove;
                }
            }

        } else if (ax == -2) {
            hero.brain -= Random(2);
            hero.charizma -= Random(2);
            hero.stamina -= Random(2);
        }

    }

    wait_for_key();
    TextColor(7);
    ClrScr();
}

let aKuzMenko = 'Кузьменко:';
let a___Otformatiro = '"... отформатировать дискету так, чтобы 1ый сектор был 5ым ..."';
let aAViNigdeNeVide = '"А Вы нигде не видели литературы по фильтрам в Windows?"';
let a___NapisatVizu = '"... написать визуализацию байта на ассемблере за 11 байт ..."';
let aUVasOlegPlissV = '"У вас Олег Плисс ведет какие-нибудь занятия?"';
let aBillGatesMustD = '"Bill Gates = must die = кабысдох (рус.)."';
let aViCitaliJurnal = '"Вы читали журнал "Монитор"? Хотя вряд ли..."';
let aQSlisalCtoMmhe = '"Я слышал, что mmHeroes написана на BP 7.0."';
let aZapisivaitesNa = '"Записывайтесь на мой семинар по языку Си!"';
let aNaTretEmKurseQ = '"На третьем курсе я буду вести у вас спецвычпрактикум."';
let aInteresnoKog_0 = '"Интересно, когда они снова наладят STAR?"';
let aPoluciteSebeQs = '"Получите себе ящик rambler\'e или на mail.ru !"';
let aARazveTerexovS = '"А разве Терехов-старший ничего не рассказывает про IBM PC?"';

function sub_1BE39() {
    GotoXY(1, 8);
    TextColor(7);
    write(aKuzMenko);
    TextColor(0x0F);
    let ax = Random(12);
    writeln([
        a___Otformatiro,
        aAViNigdeNeVide,
        a___NapisatVizu,
        aUVasOlegPlissV,
        aBillGatesMustD,
        aViCitaliJurnal,
        aQSlisalCtoMmhe,
        aZapisivaitesNa,
        aNaTretEmKurseQ,
        aInteresnoKog_0,
        aPoluciteSebeQs,
        aARazveTerexovS
    ][ax]);
}

let aKuzMenko_0 = 'Кузьменко:';
let aViZnaeteKlimov = '"Вы знаете, Климова можно найти в компьютерном классе';
let aGoMaqS = '-го мая с ';
let aPo = ' по ';
let aC__ = 'ч.."';

function sub_1C02B() {
    let var_8;
    let var_6;
    let var_4;
    let var_1;

    ClrScr();
    show_header_stats();
    var_6 = 0;
    var_1 = 0;
    var_8 = day_of_week + 1;
    if (jge(5, var_8)) {
        for (var_4 = 5; var_4 >= var_8; --var_4) {
            if (hero.charizma > Random(0x12)) {
                if (!jnz(timesheet[var_4][Infa].where, 0)) {
                    if (var_1 == 0) {
                        var_1 = 1;
                        var_6 = var_4;
                        timesheet[var_6][Infa].where = 3;
                        timesheet[var_6][Infa].from = Random(5) + 0xA;
                        timesheet[var_6][Infa].to = timesheet[var_6][Infa].from + 1 + Random(2);
                    }
                }
            }
        }
    }


    if (var_1 && klimov_timesheet_was_modified < 2) {

        GotoXY(1, 8);
        ++klimov_timesheet_was_modified;
        TextColor(7);
        write(aKuzMenko_0);
        TextColor(0x0F);
        writeln(aViZnaeteKlimov);
        write(var_6 + 0x16);
        write(aGoMaqS);

        write(timesheet[var_6][Infa].from);
        write(aPo);
        write(timesheet[var_6][Infa].to);
        writeln(aC__);

    } else {
        sub_1BE39();

    }

    wait_for_key();
    TextColor(7);
    ClrScr();
}

let aDjug_0 = 'DJuG:';
let aUVasKakoiToSko = '"У Вас какой-то школьный метод решения задач..."';
let aNeObsaisqSTorm = 'Не общайся с тормозами!';

function sub_1C1FF() {
    ClrScr();
    show_header_stats();
    GotoXY(1, 8);
    TextColor(7);
    writeln(aDjug_0);
    TextColor(0x0F);
    writeln(aUVasKakoiToSko);

    if (hero.subject[GiT].knowledge > 5) {
        hero.subject[GiT].knowledge -= Random(5);
    }

    decrease_health(0x0F, aNeObsaisqSTorm);
    wait_for_key();
    TextColor(7);
    ClrScr();
}

let aAndru_1 = 'Эндрю: ';
let aSkajiDiamondUC = '"Скажи Diamond\'у, что маловато описалова!"';
let aAEseDiamondDum = '"А еще Diamond думал переписать это на JavaScript."';
let aAQZnauViigrisn = '"А я знаю выигрышную стратегию! Если только не замочат..."';
let aVoobseToVseAto = '"Вообще-то, все это происходит в мае 1998 г."';
let aQVidelNadpisNa = '"Я видел надпись на парте: ЗАКОН ВСЕМИРНОВА ТЯГОТЕНИЯ"';
let aZaglqniNaMmh_0 = '"Загляни на mmheroes.chat.ru!"';
let aTolKoNePredlag = '"Только не предлагай Diamond\'у переписать все на Прологе!"';
let aNuKogdaJeBudet = '"Ну когда же будет порт под Linux?"';
let aVmwareSuxx___N = '"VMWARE - SUXX... Но под ним идут Heroes of Mat & Mech!"';
let aPoxojeCtoMoqSt = '"Похоже, что моя стратегия обламывается..."';
let aUxTiGamma3_14V = '"Ух ты! Гамма 3.14 - в этом что-то есть."';
let aMojetBitDiamon = '"Может быть, Diamond\'а просто заклинило на многоточиях?"';
let aGovorqtMojnoZa = '"Говорят, можно зарабатывать деньги, почти ничего не делая."';
let aVotInogdaMnePr = '"Вот, иногда мне приходится тяжко - когда пристают всякие..."';
let aXorosoLiCtoMno = '"Хорошо ли, что многие реплики персонажей посвящены самой игре?"';
let aPomogiteMneXoc = '"Помогите мне! Хочу в Inet!"';
let aACto = '"А что? А ничего."';
let aEsliOnoCvetaBo = '"Если оно цвета бордо - значит, оно тебе снится."';
let aVsexSDnemMatMe = '"Всех с ДНЕМ МАТ-МЕХА!"';
let aPridumaiSvouFr = '"Придумай свою фразу для персонажа!"';
let a120kIsxodnikov = '"120К исходников - вот что такое mmHeroes!"';
let a120kVesMaKrivi = '"120К весьма кривых исходников - вот что такое mmHeroes!"';
let aQPodozrevauC_0 = '"Я подозреваю, что ';
let aNicegoTebeNeZa = ' ничего тебе не засчитает."';
let aZactetTebeZa1Z = ' зачтет тебе за 1 заход ';
let a__1 = '."';

function sub_1C6DC(/*arg_0*/) {
    TextColor(7);
    write(aAndru_1);
    TextColor(0x0F);

    if (Random(3) > 0) {
        writeln([
            aSkajiDiamondUC, aAEseDiamondDum, aAQZnauViigrisn, aVoobseToVseAto,
            aQVidelNadpisNa, aZaglqniNaMmh_0, aTolKoNePredlag, aNuKogdaJeBudet,
            aVmwareSuxx___N, aPoxojeCtoMoqSt, aUxTiGamma3_14V, aMojetBitDiamon,
            aGovorqtMojnoZa, aVotInogdaMnePr, aXorosoLiCtoMno, aPomogiteMneXoc,
            aACto,           aEsliOnoCvetaBo, aVsexSDnemMatMe, aPridumaiSvouFr,
            a120kIsxodnikov, a120kVesMaKrivi
        ][Random(0x16)]);

    } else {
        bp_var_6 = random_from_to(0, 5);
        bp_var_8 = hero.subject[current_subject].knowledge - subjects[current_subject].member0xFA + Random(hero.brain);

        if (!jg(hero.health, 5)) {
            bp_var_8 -= Random(5 - hero.health);
        }

        if (!jle(bp_var_8, 0)) {
            bp_var_8 = Round(Math.sqrt(bp_var_8) / subjects[current_subject].member0x100);
        } else {
            bp_var_8 = 0;
        }

        if (!jle(hero.subject[current_subject].tasks_done + bp_var_8, subjects[current_subject].tasks)) {
            bp_var_8 = subjects[current_subject].tasks - hero.subject[current_subject].tasks_done;
        }

        write(aQPodozrevauC_0);
        write(subjects[bp_var_6].professor.name);

        if (!jnz(bp_var_8, 0)) {
            writeln(aNicegoTebeNeZa);
        } else {
            write(aZactetTebeZa1Z);
            write(bp_var_8);
            zadanie_in_case(bp_var_8);
            writeln(a__1);
        }
    }

    TextColor(7);

}

let aObratitSqKAndr = 'Обратиться к Эндрю за помощью?';
let aDaCemQXujeDrug = 'Да, чем я хуже других?';
let aNetQUjKakNibud = 'Нет, я уж как-нибудь сам...';
let aAndruVglqdivae = 'Эндрю вглядывается в твои задачки,';
let aINacinaetDumat = 'и начинает думать очень громко...';
let aPokaAndruTakNa = 'Пока Эндрю так напрягается, ты не можешь ни на чем сосредоточиться!';
let aUAndruNicegoNe = 'У Эндрю ничего не вышло...';
let aAndruResilTebe = 'Эндрю решил тебе ';
let aNadoBudetPodoi = 'Надо будет подойти с зачеткой!';
let aAndruTebqIgnor = 'Эндрю тебя игнорирует!';
let aAndruTojeUmeet = 'Эндрю тоже умеет отбиваться от разных нехороших людей.';

function sub_1CC94() {
    let var_6;
    let var_4;

    ClrScr();
    show_header_stats();
    GotoXY(1, 8);

    if (current_subject == -1) {
        sub_1C6DC();
    } else {
        write(aObratitSqKAndr);
        dialog_start();
        dialog_case(aDaCemQXujeDrug, -1);
        dialog_case(aNetQUjKakNibud, -2);
        let ax = dialog_run(1, 10);

        if (ax == -1) {
            var_4 = Random(0x0E);
            if (jl(var_4, hero.charizma)) {
                GotoXY(1, 0x0D);
                writeln(aAndruVglqdivae);
                writeln(aINacinaetDumat);
                writeln(aPokaAndruTakNa);

                var_6 = Trunc(Math.sqrt(Random(subjects[current_subject].tasks - hero.subject[current_subject].tasks_done)));

                if (!jle(var_6, 2)) {
                    var_6 = 0;
                }

                hero.stamina -= Random(2);

                if (!jnz(var_6, 0)) {
                    writeln(aUAndruNicegoNe);
                } else {
                    TextColor(7);
                    write(aAndruResilTebe);
                    TextColor(0x0F);
                    write(var_6);
                    TextColor(7);
                    zadanie_in_case(var_6);
                    writeln('!');

                    hero.subject[current_subject].tasks_done += var_6;
                    if (!jl(hero.subject[current_subject].tasks_done, subjects[current_subject].tasks)) {
                        writeln(aNadoBudetPodoi);
                    }
                }

                hour_pass();

            } else {
                GotoXY(1, 0x0D);
                TextColor(0x0C);
                writeln(aAndruTebqIgnor);
                decrease_health(Random(5) + 2, aAndruTojeUmeet);
            }

        } else if (ax == -2) {
            GotoXY(1, 0x0D);
            sub_1C6DC();
        }

    }

    wait_for_key();
    TextColor(7);
    ClrScr();
}

let aATiNeXocesUstr = '"А ты не хочешь устроиться в ТЕРКОМ? Может, кое-чего подзаработаешь..."';
let aDaMneBiNePomes = 'Да, мне бы не помешало.';
let aNetQLucsePoucu = 'Нет, я лучше поучусь уще чуток.';
let aPozdravlquTepe = '"Поздравляю, теперь ты можешь идти в "контору"!"';
let aKakXoces_TolKo = '"Как хочешь. Только смотри, не заучись там ..."';
let aKstatiQTutZnau = '"Кстати, я тут знаю один качественно работающий прокси-сервер..."';
let aTiZapisivaesAd = 'Ты записываешь адрес. Вдруг пригодится?';
let aGrisa_1 = 'Гриша:';
let aXocuXalqvi = '"Хочу халявы!"';
let aPriidiJeOXalqv = '"Прийди же, о халява!"';
let aXalqvaEstEeNeM = '"Халява есть - ее не может не быть."';
let aDavaiOrganizue = '"Давай организуем клуб любетелей халявы!"';
let aCtobiPolucitDi = '"Чтобы получить диплом, учиться совершенно необязательно!"';
let aNuVotTiGotovil = '"Ну вот, ты готовился... Помогло это тебе?"';
let aNaTretEmKurseN = '"На третьем курсе на лекции уже никто не ходит. Почти никто."';
let aVotBeriPrimerS = '"Вот, бери пример с Коли."';
let aNenavijuLVaTol = '"Ненавижу Льва Толстого! Вчера "Войну и мир" <йк> ксерил..."';
let aAVPomiLucseVoo = '"А в ПОМИ лучше вообще не ездить!"';
let aImenaGlavnixXa = '"Имена главных халявчиков и алкоголиков висят на баобабе."';
let aPravilNoLucseP = '"Правильно, лучше посидим здесь и оттянемся!"';
let aKonspektirovat = '"Конспектировать ничего не надо. В мире есть ксероксы!"';
let aASCetvertogoKu = '"А с четвертого курса вылететь уже почти невозможно."';
let aVotUMexanikovU = '"Вот у механиков - у них халява!"';
let aIEsePoPivu___ = 'И еще по пиву...';
let aGubitLudeiNePi = 'Губит людей не пиво, а избыток пива.';
let aIEseOdinCasPro = 'И еще один час прошел в бесплодных разговорах...';

function sub_1D30D() {
    ClrScr();
    show_header_stats();
    GotoXY(1, 8);

    if (hero.is_working_in_terkom === 0 && hero.charizma > Random(0x14)) {

        TextColor(0x0E);
        write(aATiNeXocesUstr);

        dialog_start();
        dialog_case(aDaMneBiNePomes, -1);
        dialog_case(aNetQLucsePoucu, -2);
        let ax = dialog_run(1, 10);

        if (ax == -1) {
            hero.is_working_in_terkom = 1;
            GotoXY(1, 0x0E);
            writeln(aPozdravlquTepe);
        } else if (ax == -2) {
            GotoXY(1, 0x0E);
            writeln(aKakXoces_TolKo);
        }

    } else {

        if (hero.charizma > Random(0x14) && !jnz(hero.has_inet, 0)) {
            writeln(aKstatiQTutZnau);
            TextColor(7);
            writeln();
            writeln(aTiZapisivaesAd);
            hero.has_inet = 1;
        } else {

            GotoXY(1, 8);
            TextColor(7);
            write(aGrisa_1);
            TextColor(0x0E);

            let ax = Random(0x0F);
            if (ax == 0) {
                writeln(aXocuXalqvi);
            } else if (ax == 1) {
                writeln(aPriidiJeOXalqv);
            } else if (ax == 2) {
                writeln(aXalqvaEstEeNeM);
            } else if (ax == 3) {
                writeln(aDavaiOrganizue);
            } else if (ax == 4) {
                writeln(aCtobiPolucitDi);
            } else if (ax == 5) {
                writeln(aNuVotTiGotovil);
            } else if (ax == 6) {
                writeln(aNaTretEmKurseN);
            } else if (ax == 7) {
                writeln(aVotBeriPrimerS);
            } else if (ax == 8) {
                writeln(aNenavijuLVaTol);
            } else if (ax == 9) {
                writeln(aAVPomiLucseVoo);
            } else if (ax == 0xA) {
                writeln(aImenaGlavnixXa);
            } else if (ax == 0xB) {
                writeln(aPravilNoLucseP);
            } else if (ax == 0xC) {
                writeln(aKonspektirovat);
            } else if (ax == 0xD) {
                writeln(aASCetvertogoKu);
            } else if (ax == 0xE) {
                writeln(aVotUMexanikovU);
            }

            TextColor(7);
            if (!jbe(Random(3), 0)) {
                writeln(aIEsePoPivu___);
                hero.brain -= Random(2);
                if (!jg(hero.brain, 0)) {
                    hero.health = 0;
                    is_end = 1;
                    death_cause = aGubitLudeiNePi;
                }
                hero.charizma += Random(2);
            }

            if (!jnz(Random(3), 0)) {
                writeln(aIEseOdinCasPro);
                hour_pass();
            }
        }
    }

    wait_for_key();
    ClrScr();
}

function talk_with_classmate(i) {
    [
        sub_19259,
        sub_1B526,
        sub_19B20,
        sub_1A0A2,
        sub_1A70A,
        sub_1B09A,
        sub_1B6B7,
        sub_1B986,
        sub_1C02B,
        sub_1C1FF,
        sub_1CC94,
        sub_1D30D
    ][i]();
}

let aRozovieSloniki = 'Розовые слоники с блестящими крылышками';
let aZelenieCelovec = 'Зеленые человечки с длинными антеннами';
let aOveckiSOslepit = 'Овечки с ослепительно-белой шерстью';
let aSidqtSOkosevsi = 'сидят с окосевшими глазами в Мавзолее';
let aIScitautOprede = 'и считают определитель матрицы 10 на 10';
let aIIsutJordanovu = 'и ищут Жорданову форму матрицы';
let aIVozvodqtMatri = 'и возводят матрицы в 239-ю степень';
let aIResautLineinu = 'и решают линейную систему уравнений с параметрами';
let aIDokazivautNep = 'и доказывают неприводимость многочлена 10-й степени над Z';
let aIDokazivautSxo = 'и доказывают сходимость неопределенного интеграла с параметрами';
let aIScitautSummuR = 'и считают сумму ряда с параметрами';
let aIDifferenciruu = 'и дифференцируют, дифференцируют, дифференцируют';
let aIBerutIntergal = 'и берут интергалы не отдают их';
let aIResautZadaciP = 'и решают задачи по математической болтологии';
let a____7 = '...';
let aGospodiNuIPris = 'Господи! Ну и присниться же такое!';
let aZaToTeperTiToc = 'За то теперь ты точно знаешь,';
let aCtoSnitsqStude = 'что снится студентам-математикам,';
let aKogdaOniVneKon = 'когда они вне кондиции';

function sub_1DA3D() {
    ClrScr();
    TextColor(0x0D);

    let ax = Random(3);
    let beginning = [
        aRozovieSloniki,
        aZelenieCelovec,
        aOveckiSOslepit
    ][ax];
    writeln(beginning);

    writeln(aSidqtSOkosevsi);

    ax = Random(10);
    let action = [
        aIScitautOprede,
        aIIsutJordanovu,
        aIVozvodqtMatri,
        aIResautLineinu,
        aIDokazivautNep,
        aIDokazivautSxo,
        aIScitautSummuR,
        aIDifferenciruu,
        aIBerutIntergal,
        aIResautZadaciP
    ][ax];
    writeln(action);

    writeln(a____7);
    ReadKey();
    writeln();
    writeln(aGospodiNuIPris);
    writeln(aZaToTeperTiToc);
    writeln(aCtoSnitsqStude);
    writeln(aKogdaOniVneKon);
    writeln(a____7);
    ReadKey();
    hero.health = Random(10) + 10;
}

let aTiSlisisMqgkii = 'Ты слышишь мягкий, ненавязчивый голос:';
let aAViDeistvitelN = '"А Вы действительно правильно выбрали';
let aSebeSpecialNos = ' себе специальность?"';
let aIntegral___ = '"Интеграл..."';
let aKakoiIntegral = '"Какой интеграл?"';
let aDaVotJeOnMiEgo = '"Да вот же он, мы его только что стерли!"';
let aViKonecnoVelik = '"Вы, конечно, великий парильщик.';
let aNoAtuZadacuQVa = ' Но эту задачу я Вам засчитаю."';
let aACtoUNasSegodn = '"А что, у нас сегодня разве аудиторное занятие?"';
let aWellLastTimeIF = '"Well, last time I found a pencil left by one of you.';
let aIWillReturnItT = ' I will return it to the owner, if he or she';
let aCanTellMeSomeN = ' can tell me some nice and pleasant words.';
let aIAmALadyNotYou = ' I am a lady, not your computer!"';
let aVSleduusemSe_0 = '"В следующем семестре вы должны будете написать реферат';
let aNaTemuBegVMiro = ' на тему "Бег в мировой литературе". В качестве первоисточника';
let aMojeteVzqtOdno = ' можете взять одноименный роман Булгакова."';
let aNuVsePoxojeZau = 'Ну все, похоже, заучился - если преподы по ночам снятся...';

function sub_1DF40() {
    ClrScr();
    TextColor(0x0D);

    if (last_subject == 0) {
        writeln(aTiSlisisMqgkii);
        writeln(aAViDeistvitelN);
        writeln(aSebeSpecialNos);
    } else if (last_subject == 1) {
        writeln(aIntegral___);
        writeln(aKakoiIntegral);
        writeln(aDaVotJeOnMiEgo);
    } else if (last_subject == 2) {
        writeln(aViKonecnoVelik);
        writeln(aNoAtuZadacuQVa);
    } else if (last_subject == 3) {
        writeln(aACtoUNasSegodn);
    } else if (last_subject == 4) {
        writeln(aWellLastTimeIF);
        writeln(aIWillReturnItT);
        writeln(aCanTellMeSomeN);
        writeln(aIAmALadyNotYou);
    } else if (last_subject == 5) {
        writeln(aVSleduusemSe_0);
        writeln(aNaTemuBegVMiro);
        writeln(aMojeteVzqtOdno);
    }

    writeln();
    writeln(aNuVsePoxojeZau);
    ReadKey();
}

let aZdravstvuite__ = '"Здравствуйте!" ...';
let aOnoBolSoe___ = 'Оно большое ...';
let aOnoPixtit___ = 'Оно пыхтит! ...';
let aOnoMedlennoPol = 'Оно медленно ползет прямо на тебя!!! ...';
let aOnoGovoritCelo = 'Оно говорит человеческим голосом:';
let aMolodoiCelovek = '"Молодой человек. Когда-нибудь Вы вырастете';
let aIBudeteRabotat = 'и будете работать на большой машине.';
let aVamNadoBudetNa = 'Вам надо будет нажать кнопку жизни,';
let aAViNajmeteKnop = 'а Вы нажмете кнопку смерти ..."';
let aAtoVSredneveko = '"Это в средневековье ученые спорили,';
let aSkolKoCerteiMo = 'сколько чертей может поместиться';
let aNaKoncikeIgli_ = 'на кончике иглы..."';
let aZadaciMojnoRes = '"Задачи можно решать по-разному.';
let aMojnoUstnoMojn = 'Можно устно, можно на бумажке,';
let aMojnoIgraqVKre = 'можно - играя в крестики-нолики...';
let aAMojnoProstoSp = 'А можно - просто списать ответ в конце задачника!"';
let a____8 = '...';
let aUfff___CtoToSe = 'Уффф... Что-то сегодня опять какие-то гадости снятся.';
let aVsePoraZavqziv = 'Все, пора завязывать с этим. Нельзя так много учиться.';

function sub_1E37C() {
    ClrScr();
    TextColor(0x0D);
    writeln(aZdravstvuite__);
    ReadKey();
    writeln(aOnoBolSoe___);
    ReadKey();
    writeln(aOnoPixtit___);
    ReadKey();
    writeln(aOnoMedlennoPol);
    ReadKey();
    writeln(aOnoGovoritCelo);
    TextColor(7);

    let ax = Random(3);
    if (ax == 0) {
        writeln(aMolodoiCelovek);
        writeln(aIBudeteRabotat);
        writeln(aVamNadoBudetNa);
        writeln(aAViNajmeteKnop);
    } else if (ax == 1) {
        writeln(aAtoVSredneveko);
        writeln(aSkolKoCerteiMo);
        writeln(aNaKoncikeIgli_);
    } else if (ax == 2) {
        writeln(aZadaciMojnoRes);
        writeln(aMojnoUstnoMojn);
        writeln(aMojnoIgraqVKre);
        writeln(aAMojnoProstoSp);
    }

    TextColor(0x0D);
    writeln(a____8);
    ReadKey();
    writeln();
    writeln(aUfff___CtoToSe);
    writeln(aVsePoraZavqziv);
    ReadKey();
    hero.health = Random(10) + 0xA;
}

let aPrevratilsqVOv = 'Превратился в овощ.';

function sub_1E5A3() {
    let var_4 = 0;

    for (let var_2 = 0; var_2 <= 2; ++var_2) {
        synopsis[var_2].sasha_has = 1;
    }

    hero.is_invited = 0;
    if (!jg(hero.brain, 2)) {
        hero.brain = 2;
        var_4 = 1;
    }

    if (!jg(hero.stamina, 0)) {
        is_end = 1;
        hero.health = 0;
        death_cause = aPrevratilsqVOv;
    }

    if (hero.knows_djug != 0) {
        var_4 = 2;
    }

    if (!jnz(Random(2), 0)) {
        if (var_4 == 1) {
            sub_1DA3D();
        } else if (var_4 == 2) {
            sub_1E37C();
        } else {
            if (!jnz(Random(3), 0)) {
                sub_1DF40();
            }
        }
    }

    hero.knows_djug = 0;
}

function rest_in_obschaga() {
    hero.health += 7 + Random(8);
    hour_pass();
}

function request_exit() {
    prompt_exit();
}

let aVremqVislo_ = 'Время вышло.';

function goto_sleep() {
    let var_4;
    let var_2;

    current_subject = -1;
    current_place = 4;

    if (!jle(day_of_week, 5)) {
        is_end = 1;
        death_cause = aVremqVislo_;
        return;
    }

    if (!jle(hero.health, 0x28)) {
        hero.health = 0x28;
    }

    var_2 = hero.health + 0xF + Random(0x14);

    if (!jle(var_2, 0x32)) {
        var_2 = 0x32;
    }

    var_2 -= hero.health;
    hero.health += var_2;
    var_4 = Random(idiv(var_2, 4)) + 7;
    time_of_day += var_4;

    if (time_of_day > 23) {
        time_of_day %= 24;
        ++day_of_week;

        if (day_of_week > 5) {
            is_end = 1;
            death_cause = aVremqVislo_;
        } else {
            send_replay();
        }
    }

    sub_1E5A3();

    if (time_of_day <= 4) {
        time_of_day = 5;
    }

    if (hero.garlic > 0) {
        --hero.garlic;
        hero.charizma += Random(2);
    }

}

let aTiGlqdisNaCasi = 'Ты глядишь на часы и видишь: уже полночь!';
let aNaPosledneiAle = 'На последней электричке ты едешь домой, в общагу.';
let aZasnulVAlektri = 'Заснул в электричке и не проснулся.';

function sub_1E7F8() {
    ClrScr();
    TextColor(7);
    writeln(aTiGlqdisNaCasi);
    writeln(aNaPosledneiAle);
    hero.health -= 4;

    if (!jge(hero.health, 1)) {
        is_end = 1;
        death_cause = aZasnulVAlektri;
    }

    current_place = 4;
    current_subject = -1;
    wait_for_key();
    ClrScr();
}

let aVaxtersaGlqdit = 'Вахтерша глядит на тебя странными глазами:';
let aCtoMojetDelatB = 'что может делать бедный студент в университете в полночь?';
let aNeZnaqOtvetNaA = 'Не зная ответ на этот вопрос, ты спешишь в общагу.';

function sub_1E907() {
    ClrScr();
    TextColor(7);
    writeln(aVaxtersaGlqdit);
    writeln(aCtoMojetDelatB);
    writeln(aNeZnaqOtvetNaA);
    current_place = 4;
    current_subject = -1;
    wait_for_key();
    ClrScr();
}

let aMavzoleiZakriv = 'Мавзолей закрывается.';
let aPoraDomoi = 'Пора домой!';

function sub_1E993() {
    ClrScr();
    TextColor(7);
    writeln(aMavzoleiZakriv);
    writeln(aPoraDomoi);
    current_place = 4;
    current_subject = -1;
    wait_for_key();
    ClrScr();
}

function midnight() {
    if (current_place == 2) {
        sub_1E7F8();
    } else if (current_place == 1) {
        sub_1E907();
    } else if (current_place == 5) {
        sub_1E993();
    } else if (current_place == 4) {
        goto_sleep();
    }
}

let aDjugAtoSmertel = 'DJuG - это смертельно!';
let aBurnoProgressi = 'Бурно прогрессирующая паранойя.';

function hour_pass() {
    terkom_has_places = 1;
    sub_1F184();
    ++time_of_day;

    if (current_subject == 2 && current_place == 2) {
        decrease_health(6, aDjugAtoSmertel);
        hero.knows_djug = 1;
    }

    if (hero.charizma <= 0) {
        hero.health = 0;
        is_end = 1;
        death_cause = aBurnoProgressi;
    }

    if (time_of_day == 24) {
        ++day_of_week;
        send_replay();
        time_of_day = 0;
        midnight();
    }

    if (hero.charizma > Random(10)) {
        byte_254A4 = 0;
    }
}

let aNuMojetNeNadoT = 'Ну, может не надо так резко...';
let aTiCtoSerEznoXo = 'Ты что, серьезно хочешь закончить игру?';
let aNetNeXocu = 'Нет, не хочу!';
let aQJeSkazalSMenq = 'Я же сказал: с меня хватит!';
let aViselSam_ = 'Вышел сам.';

function prompt_exit() {
    ClrScr();
    writeln(aNuMojetNeNadoT);
    writeln(aTiCtoSerEznoXo);
    dialog_start();
    dialog_case(aNetNeXocu, -1);
    dialog_case(aQJeSkazalSMenq, -2);
    if (dialog_run(1, 4) == -2) {
        is_end = 1;
        death_cause = aViselSam_;
    }
    ClrScr();
}

function is_professor_here(subj) {
    let ts = timesheet[day_of_week][subj];
    return time_of_day >= ts.from && time_of_day < ts.to && ts.where == current_place;
}

function is_professor_here_today(subj) {
    return timesheet[day_of_week][subj].where == current_place;
}

function time_between_9_and_19() {
    return time_of_day > 8 && time_of_day < 20;
}

function sub_1EC97() {
    if (time_between_9_and_19()) {
        classmates[Kolya].place = 5;
    } else {
        classmates[Kolya].place = 0;
    }
    classmates[Kolya].current_subject = -1;
}

function sub_1ECBC() {
    let bp_var_2 = [0, 0];

    if (time_between_9_and_19()) {
        classmates[Pasha].place = 1;
    } else {
        classmates[Pasha].place = 0;
    }

    classmates[Pasha].current_subject = -1;

    do {
        for (let var_2 = 0; var_2 <= 2; ++var_2) {
            if (is_professor_here_today(var_2) !== 0) {
                bp_var_2[0] = 1;
                if (!jbe(Random(10), 5)) {
                    bp_var_2[1] = 1;
                    classmates[Pasha].place = timesheet[day_of_week][var_2].where;
                    classmates[Pasha].current_subject = var_2;
                }
            }
        }
    } while (!jnz(bp_var_2[1], 0) && jnz(bp_var_2[0], 0));
}

function sub_1ED56() {
    let bp_var_2 = [0, 0];

    if (time_between_9_and_19()) {
        classmates[Diamond].place = 3;
    } else {
        classmates[Diamond].place = 0;
    }

    classmates[Diamond].current_subject = -1;

    for (let var_2 = 5; var_2 >= 0; --var_2) {
        if (is_professor_here_today(var_2) != 0) {
            if (bp_var_2[1] == 0) {

                if (!jbe(Random(10), 5)) {
                    classmates[Diamond].place = timesheet[day_of_week][var_2].where;
                    classmates[Diamond].current_subject = var_2;
                }
            }
        }
    }

}

function sub_1EDCC() {
    if (is_professor_here(Algebra) != 0) {
        classmates[Rai].place = timesheet[day_of_week][Algebra].where;
        classmates[Rai].current_subject = 0;
        return;
    }

    if (is_professor_here(Matan) != 0) {
        classmates[Rai].place = timesheet[day_of_week][Matan].where;
        classmates[Rai].current_subject = 1;
        return;
    }

    if (time_between_9_and_19()) {
        classmates[Rai].place = 3;
    } else {
        classmates[Rai].place = 0;
    }

    classmates[Rai].current_subject = -1;
}

function sub_1EE2C() {
    let bp_var_2 = [0, 0];

    if (time_between_9_and_19()) {
        classmates[Misha].place = 1;
    } else {
        classmates[Misha].place = 0;
    }

    classmates[Misha].current_subject = -1;

    do {
        for (let var_2 = 4; var_2 >= 0; --var_2) {
            if (is_professor_here_today(var_2) !== 0) {
                if (var_2 !== 3) {
                    bp_var_2[0] = 1;

                    if (!jbe(Random(10), 5)) {
                        bp_var_2[1] = 1;
                        classmates[Misha].place = timesheet[day_of_week][var_2].where;
                        classmates[Misha].current_subject = var_2;
                    }
                }
            }
        }
    } while (!jnz(bp_var_2[1], 0) && jnz(bp_var_2[0], 0));
}

function sub_1EECC() {
    let bp_var_2 = [0, 0];

    if (time_between_9_and_19()) {
        classmates[Serzg].place = 1;
    } else {
        classmates[Serzg].place = 0;
    }

    classmates[Serzg].current_subject = -1;

    do {
        for (let var_2 = 5; var_2 >= 0; --var_2) {
            if (is_professor_here_today(var_2) !== 0) {
                bp_var_2[0] = 1;
                if (!jbe(Random(10), 5)) {
                    bp_var_2[1] = 1;
                    classmates[Serzg].place = timesheet[day_of_week][var_2].where;
                    classmates[Serzg].current_subject = var_2;
                }
            }
        }
    } while (!jnz(bp_var_2[1], 0) && jnz(bp_var_2[0], 0));
}

function sub_1EF66(/*arg_0*/) {
    classmates[Sasha].current_subject = -1;
    if (time_between_9_and_19()) {
        if (!jnz(Random(4), 0)) {
            classmates[Sasha].place = 1;
        } else {
            classmates[Sasha].place = 0;
        }
    } else {
        classmates[Sasha].place = 0;
    }
}

function sub_1EF9E(/*arg_0*/) {
    // #warning arg_0, [arg_0 + var_2 + 0|1]
    let bp_var_2 = [0, 0];

    classmates[Nil].place = 0;
    classmates[Nil].current_subject = -1;

    do {
        for (let var_2 = 0; var_2 <= 2; ++var_2) {
            if (is_professor_here_today(var_2) !== 0) {
                bp_var_2[0] = 1;
                if (!jbe(Random(10), 5)) {
                    bp_var_2[1] = 1;
                    classmates[Nil].place = timesheet[day_of_week][var_2].where;
                    classmates[Nil].current_subject = var_2;
                }
            }
        }
    } while (!jnz(bp_var_2[1], 0) && jnz(bp_var_2[0], 0));

}

function sub_1F025(/*arg_0*/) {
    if (time_between_9_and_19() && !jnz(Random(4), 0)) {
        classmates[Kuzmenko].place = 3;
        classmates[Kuzmenko].current_subject = -1;
    } else {
        classmates[Kuzmenko].place = 0;
        classmates[Kuzmenko].current_subject = -1;
    }
}

function sub_1F05B() {
    classmates[Djug].place = 2;
    classmates[Djug].current_subject = 2;
}

function sub_1F06D() {
    classmates[Endryu].place = 1;
    classmates[Endryu].current_subject = 1;

    for (let var_2 = 0; var_2 <= 2; ++var_2) {
        if (is_professor_here_today(var_2) !== 0) {
            if (!jbe(Random(10), 5)) {
                classmates[Endryu].place = timesheet[day_of_week][var_2].where;
                classmates[Endryu].current_subject = var_2;
            }
        }
    }

}

function sub_1F0C6() {
    classmates[Grisha].current_subject = -1;
    if (!jnz(Random(3), 0)) {
        classmates[Grisha].place = 5;
    } else {
        classmates[Grisha].place = 0;
    }
}

function sub_1F0EA(arg_0) {
    if (arg_0 == 0) {
        sub_1EC97();
    } else if (arg_0 == 2) {
        sub_1ED56();
    } else if (arg_0 == 1) {
        sub_1ECBC();
    } else if (arg_0 == 3) {
        sub_1EDCC();
    } else if (arg_0 == 4) {
        sub_1EE2C();
    } else if (arg_0 == 5) {
        sub_1EECC();
    } else if (arg_0 == 6) {
        sub_1EF66();
    } else if (arg_0 == 7) {
        sub_1EF9E();
    } else if (arg_0 == 8) {
        sub_1F025();
    } else if (arg_0 == 9) {
        sub_1F05B();
    } else if (arg_0 == 0xA) {
        sub_1F06D();
    } else if (arg_0 == 0xB) {
        sub_1F0C6();
    }
}

function sub_1F184() {
    for (let var_2 = 0; var_2 <= 0xB; ++var_2) {
        sub_1F0EA(var_2);
    }
}

// =============================================================================

let aZadanie = ' задание';
let aZadaniq = ' задания';
let aZadanii = ' заданий';

function zadanie_in_case(number) {
    if (number == 1) {
        write(aZadanie);
    } else if (number >= 2 && number <= 4) {
        write(aZadaniq);
    } else {
        write(aZadanii);
    }
}

function colored_output(color, str) {
    current_color = color;
    write(str);
    current_color = 7;
}

function colored_output_ln(color, str) {
    current_color = color;
    writeln(str);
    current_color = 7;
}

function output_with_highlighted_num(color, before, color_hi, number, after) {
    current_color = color;
    write(before);
    current_color = color_hi;
    write(number);
    current_color = color;
    write(after);
    current_color = 7;
}

function colored_output_white(number) {
    current_color = 0x0F;
    write(number);
    current_color = 7;
}

let aSegodnq = 'Сегодня ';
let aEMaq = 'е мая; ';
let asc_1F36E = '';
let a00 = ':00';
let aVersiq_0 = 'Версия ';
let aSamocuvstvie = 'Самочувствие: ';
let aJivoiTrup = 'живой труп';
let aPoraPomirat___ = 'пора помирать ...';
let aPloxoe = 'плохое';
let aTakSebe = 'так себе';
let aSrednee = 'среднее';
let aXorosee = 'хорошее';
let aOtlicnoe = 'отличное';
let aPloxo = 'Плохо';
let aUdovl_ = 'Удовл.';
let aXoroso = 'Хорошо';
let aOtlicno = 'Отлично';
let aFinansi = 'Финансы: ';
let aRub__3 = ' руб.';
let aNadoPolucitDen = 'Надо получить деньги за май...';
let aTiUspelPotrati = 'Ты успел потратить все деньги.';
let aKliniceskaqSme = 'Клиническая смерть мозга';
let aGolovaProstoNi = 'Голова просто никакая';
let aDumatPraktices = 'Думать практически невозможно';
let aDumatTrudno = 'Думать трудно';
let aGolovaPoctiVNo = 'Голова почти в норме';
let aGolovaVNorme = 'Голова в норме';
let aGolovaSvejaq = 'Голова свежая';
let aLegkostVMislqx = 'Легкость в мыслях необыкновенная';
let aObratitesKRazr = 'Обратитесь к разработчику ;)';
let aMamaRodiMenqOb = 'Мама, роди меня обратно!';
let aOkoncatelNoZau = 'Окончательно заучился';
let aQTakBolSeNemog = 'Я так больше немогууу!';
let aSkoreeBiVseAto = 'Скорее бы все это кончилось...';
let aEseNemnogoIPor = 'Еще немного и пора отдыхать';
let aNemnogoUstal = 'Немного устал';
let aGotovKTruduIOb = 'Готов к труду и обороне';
let aNasJdutVelikie = 'Нас ждут великие дела';
let aOcenZamknutiiT = 'Очень замкнутый товарищ';
let aPredpocitaesOd = 'Предпочитаешь одиночество';
let aTebeTrudnoObsa = 'Тебе трудно общаться с людьми';
let aTebeNeprostoOb = 'Тебе непросто общаться с людьми';
let aTiNormalNoOtno = 'Ты нормально относишься к окружающим';
let aUTebqMnogoDruz = 'У тебя много друзей';
let aUTebqOcenMnogo = 'У тебя очень много друзей';

function show_header_stats() {
    ClrScr();
    GotoXY(1, 1);
    output_with_highlighted_num(7, aSegodnq, 0xF, day_of_week + 0x16, aEMaq);
    output_with_highlighted_num(0xF, asc_1F36E, 0xF, time_of_day, a00);
    GotoXY(0x1A, 1);

    colored_output(0xD, aVersiq_0 + aGamma3_14);
    GotoXY(1, 2);
    write(aSamocuvstvie);

    let health_line = [1, 9, 17, 0x19, 0x21, 0x29];
    let health_str = [aJivoiTrup, aPoraPomirat___, aPloxoe, aTakSebe, aSrednee, aXorosee, aOtlicnoe];
    let health_col = [5, 4, 4, 14, 14, 10, 0xA];
    let health_i = _upper_bound(health_line, hero.health);
    colored_output(health_col[health_i], health_str[health_i]);


    let knowledge_line = [6, 0xD, 0x15, 0x1F];
    let knowledge_col = [3, 7, 0xF, 10, 0xE];
    let knowledge_subj_line = [
        [0xB, 0x15, 0x33],
        [9, 0x13, 0x29],
        [6, 0xB, 0x1F],
        [10, 0x10, 0x1F],
        [5, 9, 0x10],
        [5, 9, 0x10]
    ];
    let knowledge_subj_str = [aPloxo, aUdovl_, aXoroso, aOtlicno];
    let knowledge_subj_col = [3, 7, 0xF, 0xE];

    for (let subj = 0; subj <= 5; ++subj) {
        GotoXY(0x2D, subj + 1);
        colored_output(0xB, subjects[subj].title);

        GotoXY(0x43, subj + 1);
        let ax = hero.subject[subj].knowledge;
        current_color = knowledge_col[_upper_bound(knowledge_line, ax)];
        write(hero.subject[subj].knowledge);

        GotoXY(0x47, subj + 1);
        let k_i = _upper_bound(knowledge_subj_line[subj], ax);
        colored_output(knowledge_subj_col[k_i], knowledge_subj_str[k_i]);

        current_color = 7;
    }


    GotoXY(1, 3);
    colored_output(7, aFinansi);


    if (!jle(hero.money, 0)) {
        TextColor(0x0F);
        write(hero.money);
        TextColor(7);
        write(aRub__3);
    } else if (hero.got_stipend == 0) {
        colored_output(0x0C, aNadoPolucitDen);
    } else {
        write(aTiUspelPotrati);
    }

    GotoXY(1, 4);
    let brain_line = [0, 1, 2, 3, 4, 5, 6, 0x65];
    let brain_str = [aKliniceskaqSme, aGolovaProstoNi, aDumatPraktices, aDumatTrudno, aGolovaPoctiVNo, aGolovaVNorme, aGolovaSvejaq, aLegkostVMislqx, aObratitesKRazr];
    let brain_col = [5, 5, 12, 12, 14, 14, 10, 10, 0xB];
    let brain_i = _upper_bound(brain_line, hero.brain);
    colored_output(brain_col[brain_i], brain_str[brain_i]);


    GotoXY(1, 5);
    let stamina_line = [0, 1, 2, 3, 4, 5, 6];
    let stamina_str = [aMamaRodiMenqOb, aOkoncatelNoZau, aQTakBolSeNemog, aSkoreeBiVseAto, aEseNemnogoIPor, aNemnogoUstal, aGotovKTruduIOb, aNasJdutVelikie];
    let stamina_col = [5, 5, 12, 12, 14, 14, 10, 0xA];
    let stamina_i = _upper_bound(stamina_line, hero.stamina);
    colored_output(stamina_col[stamina_i], stamina_str[stamina_i]);

    GotoXY(1, 6);
    let charizma_line = [1, 2, 3, 4, 5, 6];
    let charizma_str = [aOcenZamknutiiT, aPredpocitaesOd, aTebeTrudnoObsa, aTebeNeprostoOb, aTiNormalNoOtno, aUTebqMnogoDruz, aUTebqOcenMnogo];
    let charizma_col = [5, 5, 12, 12, 14, 10, 0xA];
    let charizma_i = _upper_bound(charizma_line, hero.charizma);
    colored_output(charizma_col[charizma_i], charizma_str[charizma_i]);
}

let asc_1FD4D = '------';

function show_timesheet_day(day_color, day, subj) {
    TextColor(hero.subject[subj].passed ? 1 : day_color);

    let ts = timesheet[day][subj];
    if (ts.where != 0) {
        GotoXY(day * 7 + 0x18, subj * 3 + 2);
        write(places[ts.where].title);
        GotoXY(day * 7 + 0x18, subj * 3 + 3);
        write(ts.from);
        write('-');
        write(ts.to);
    } else {
        TextColor(day_color > 8 ? 6 : 8);
        GotoXY(day * 7 + 0x18, subj * 3 + 2);
        write(asc_1FD4D);
        GotoXY(day * 7 + 0x18, subj * 3 + 3);
        write(asc_1FD4D);
    }

    // #warning only use
    //TextBackground(0);
}

let aOstalos = 'Осталось';
let aPodoitiS = 'Подойти с';
let aZacetkoi = 'зачеткой';
let aZacet = 'ЗАЧЕТ';
let a_05 = '.05';
let aVseUjeSdano = 'Все уже сдано!';
let aOstalsq = 'Остался ';
let aZacet_0 = ' зачет!';
let aOstalos_0 = 'Осталось ';
let aZaceta_ = ' зачета.';
let aZacetov_ = ' зачетов.';

function show_timesheet() {
    for (let subj = 0; subj <= 5; ++subj) {
        TextColor(7);
        GotoXY(1, subj * 3 + 2);
        colored_output(10, subjects[subj].professor.name);
        GotoXY(1, subj * 3 + 3);
        colored_output(0xB, subjects[subj].title);

        for (let day = 0; day <= 5; ++day) {
            show_timesheet_day(day == day_of_week ? 0xE : 7, day, subj);
        }
    }

    for (let day = 0; day <= 5; ++day) {
        TextColor(7);
        GotoXY(day * 7 + 0x18, 1);
        colored_output(0xB, days[day]);
    }

    for (let subj = 0; subj <= 5; ++subj) {
        if (hero.subject[subj].passed == 0) {
            if (subjects[subj].tasks > hero.subject[subj].tasks_done) {
                TextColor(7);
                GotoXY(0x46, subj * 3 + 2);
                write(aOstalos);
                GotoXY(0x46, subj * 3 + 3)
                colored_output_white(subjects[subj].tasks - hero.subject[subj].tasks_done);
                zadanie_in_case(subjects[subj].tasks - hero.subject[subj].tasks_done);
            } else {
                TextColor(7);
                GotoXY(0x46, subj * 3 + 2);
                writeln(aPodoitiS);
                GotoXY(0x46, subj * 3 + 3);
                writeln(aZacetkoi);
            }
        } else {
            TextColor(0);
            GotoXY(0x46, subj * 3 + 2);
            write(aZacet);
            GotoXY(0x46, subj * 3 + 3);
            write(hero.subject[subj].pass_day + 22);
            write(a_05);
        }
    }

    TextColor(7);
    GotoXY(1, 0x17);

    if (hero.exams_left == 0) {
        colored_output(0, aVseUjeSdano);
    } else if (hero.exams_left == 1) {
        output_with_highlighted_num(7, aOstalsq, 0xD, 1, aZacet_0);
    } else if (hero.exams_left < 5) {
        output_with_highlighted_num(7, aOstalos_0, 14, hero.exams_left, aZaceta_);
    } else {
        output_with_highlighted_num(7, aOstalos_0, 14, hero.exams_left, aZacetov_);
    }

    GotoXY(1, 7);
}

function show_short_today_timesheet(y) {
    for (let subj = 0; subj <= 5; ++subj) {
        let ts = timesheet[day_of_week][subj];

        TextColor(hero.subject[subj].passed ? 1 : 0xB);
        GotoXY(0x32, y + subj);
        write(subject_short_titles[subj]);

        TextColor(hero.subject[subj].passed ? 5 : 0xC);
        GotoXY(0x3A, y + subj);
        write(places[ts.where].title);

        if (ts.where != 0) {
            TextColor(hero.subject[subj].passed ? 8 : 0xF);
            GotoXY(0x40, y + subj);
            write(ts.from);
            write('-');
            write(ts.to);
        }

        GotoXY(0x48, y + subj);
        if (hero.subject[subj].tasks_done == 0) {
            TextColor(7);
        } else if (hero.subject[subj].tasks_done < subjects[subj].tasks) {
            TextColor(0xA);
        } else {
            TextColor(0xE);
        }
        write(hero.subject[subj].tasks_done);
        write('/');
        write(subjects[subj].tasks);
    }

    TextColor(7);
}

function init_timesheet() {
    for (let subj = 0; subj <= 5; ++subj) {
        for (let day = 0; day <= 5; ++day) {
            timesheet[day][subj].from =
                timesheet[day][subj].to =
                timesheet[day][subj].where = 0;
        }
    }

    for (let subj = 0; subj <= 5; ++subj) {
        let day_used = [0, 0, 0, 0, 0, 0];
        if (subjects[subj].exam_days >= 1) {
            for (let i = 1; i <= subjects[subj].exam_days; ++i) {
                let day;
                do {
                    day = random_from_to(0, 5);
                } while (day_used[day]);

                timesheet[day][subj].from =
                    random_from_to(9, 18 - subjects[subj].exam_max_time);

                let exam_time = random_from_to(
                    subjects[subj].exam_min_time,
                    subjects[subj].exam_max_time);

                timesheet[day][subj].to = timesheet[day][subj].from + exam_time;
                timesheet[day][subj].where = subjects[subj].exam_places[Random(3)];

                day_used[day] = 1;
            }
        }
    }
}

function inception_reinit_timesheet() {
    // Тут deep copy
    let old_timesheet = [];
    for (let i = 0; i < 6; ++i) {
        old_timesheet.push([]);
        for (let j = 0; j < 6; ++j) {
            old_timesheet[i].push({from: timesheet[i][j].from, to: timesheet[i][j].to, where: timesheet[i][j].where});
        }
    }
    init_timesheet();
    for (let i = 0; i <= day_of_week; ++i) {
        timesheet[i] = old_timesheet[i];
    }
}

let aViberiNacalNie = 'Выбери начальные параметры своего "героя":';
let aSlucainiiStude = 'Случайный студент';
let aSibkoUmnii = 'Шибко умный';
let aSibkoNaglii = 'Шибко наглый';
let aSibkoObsitelNi = 'Шибко общительный';
let aGodRejim = 'GOD-режим';

function init_hero_interactive() {
    ClrScr();

    dialog_start();
    writeln(aViberiNacalNie);
    dialog_case(aSlucainiiStude, -1);
    dialog_case(aSibkoUmnii, -2);
    dialog_case(aSibkoNaglii, -3);
    dialog_case(aSibkoObsitelNi, -4);
    dialog_case(aGodRejim, -100);

    is_god_mode = 0;

    let res = dialog_run(1, 3);
    if (res == -1) {
        hero.brain = Random(3) + 4;
        hero.stamina = Random(3) + 4;
        hero.charizma = Random(3) + 4;
    } else if (res == -2) {
        hero.brain = Random(5) + 5;
        hero.stamina = Random(3) + 2;
        hero.charizma = Random(3) + 2;
    } else if (res == -3) {
        hero.brain = Random(3) + 2;
        hero.stamina = Random(5) + 5;
        hero.charizma = Random(3) + 2;
    } else if (res == -4) {
        hero.brain = Random(3) + 2;
        hero.stamina = Random(3) + 2;
        hero.charizma = Random(5) + 5;
    } else if (res == -100) {
        is_god_mode = 1;
        hero.brain = 30;
        hero.stamina = 30;
        hero.charizma = 30;
    }

    ClrScr();
}

function init_hero() {
    hero.garlic = 0;
    hero.money = 0;
    hero.inception = 0;
    hero.got_stipend = 0;
    hero.knows_djug = 0;
    hero.has_mmheroes_disk = 0;
    hero.is_working_in_terkom = 0;

    // #warning no refs
    byte_2549F = 0;

    init_hero_interactive();

    // #warning no refs
    word_256CE = hero.brain;
    asc_256D2 = hero.stamina;
    word_256D0 = hero.charizma;

    day_of_week = 0;
    time_of_day = 8;
    current_place = 4;
    current_subject = -1;

    hero.health = Random(hero.stamina * 2) + 0x28;

    // #warning no refs
    word_2559A = hero.health;

    hero.exams_left = 6;
    hero.has_ticket = 0;
    is_end = 0;
    death_cause = 0;
    klimov_timesheet_was_modified = 0;
    hero.is_invited = 0;

    // #warning no refs
    byte_254A4 = 0;

    hero.has_inet = 0;
}

let aBad_cred_count = 'bad_cred_count';

function check_exams_left_count() {
    let exams_left = 6;
    for (let i = 0; i <= 5; ++i) {
        if (hero.subject[i].passed) {
            --exams_left;
        }
    }
    if (exams_left != hero.exams_left) {
        bug_report(aBad_cred_count);
    }
}

function init_knowledge_synopsis_classmate() {
    for (let subj = 0; subj <= 5; ++subj) {
        hero.subject[subj] = {
            tasks_done: 0,
            pass_day: -1,
            knowledge: Random(hero.brain),
            passed: 0
        };
    }

    for (let subj = 0; subj <= 2; ++subj) {
        synopsis[subj].sasha_has = 1;
        synopsis[subj].hero_has = 0;
    }

    for (let i = 0; i <= 0xB; ++i) {
        classmates[i].current_subject = -1;
    }
}

function init_game() {
    init_hero();
    init_timesheet();
    init_knowledge_synopsis_classmate();

    send_replay();
}

let aNajmiLubuuKlav = 'Нажми любую клавишу ...';

function wait_for_key() {
    GotoXY(1, 0x18);
    current_color = 0x0E;
    write(aNajmiLubuuKlav);
    current_color = 7;
    ReadKey();
}

let aVProgrammeBuga = 'В программе буга! Код : ';
let aSrocnoObratite = 'Срочно обратитесь к разработчику ;)';
let aRazdavlenBezja = 'Раздавлен безжалостной ошибкой в программе.';

function bug_report(bug_str) {
    ClrScr();
    current_color = 0x8F;
    write(aVProgrammeBuga);
    writeln(bug_str);
    writeln(aSrocnoObratite);
    is_end = 1;
    hero.health = -100;
    death_cause = aRazdavlenBezja;
    wait_for_key();
}

function random_from_to(from, to) {
    return from + Random(to - from + 1);
}

function decrease_health(num, death_str) {
    hero.health -= num;

    if (hero.health <= 0) {
        is_end = 1;
        death_cause = death_str;
    }
}

function dialog_start() {
    dialog_case_count = 0;
}

function dialog_case_colored(str, num, color) {
    dialog[dialog_case_count++] = {
        str: str,
        num: num,
        color: color
    };
}

function dialog_case(str, num) {
    dialog_case_colored(str, num, 11);
}

function dialog_show(x, y) {
    current_color = 11;
    for (let i = 0; i <= dialog_case_count - 1; ++i) {
        GotoXY(x, y + i);
        current_color = dialog[i].color;
        write(dialog[i].str);
    }
    current_color = 7;
}

function report_bug() {
    let s = JSON.stringify(Replay.data);
    alert('Send this string to developer and tell him what happened\r\n\r\n' + s);
}

function dev_replay() {
    Replay.data = JSON.parse(prompt('Paste string from tester'));
    Main();
}

</script>
<script type="text/javascript">
    $(function() {
        $(document.body).keydown(event => {
            if (event.keyCode != 116) {
                _update_key(event.keyCode);
            }
        });
        Main();
    });
</script>
</head>
<body>
    <div id="content"></div>
    <div id="bug">
        <a href="#" onclick="report_bug(); return false;">Bugreport</a><br>
        <a href="#" onclick="dev_replay(); return false;">Replay</a>
    </div>
</body>
</html>
